<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>NOTHING</title>
  <icon>https://www.gravatar.com/avatar/d9ace8a0b4d76d8e8802cb1b2b061cad</icon>
  <subtitle>NOTHING IS EVERYTHING.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://charlesblog.site/"/>
  <updated>2018-05-22T01:28:27.385Z</updated>
  <id>http://charlesblog.site/</id>
  
  <author>
    <name>Charles</name>
    <email>2275572017@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>为你的UIView添加一个动画Layer</title>
    <link href="http://charlesblog.site/2018/05/21/%E4%B8%BA%E4%BD%A0%E7%9A%84UIView%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%8A%A8%E7%94%BBLayer/"/>
    <id>http://charlesblog.site/2018/05/21/为你的UIView添加一个动画Layer/</id>
    <published>2018-05-21T14:37:00.000Z</published>
    <updated>2018-05-22T01:28:27.385Z</updated>
    
    <content type="html"><![CDATA[<p>我想你一定用过UIView， 我想你也一定知道CALayer是什么，具体细节的东西请自行谷歌，我们今天要用Layer搞一点事情；</p><a id="more"></a><p>[TOC]</p><h2 id="总结几点性质"><a href="#总结几点性质" class="headerlink" title="总结几点性质"></a>总结几点性质</h2><blockquote><ol><li>UIView继承自<code>UIResponder</code>，用于交互，那么这么看来师承自事件流，属于动作学派；</li><li>UIView有一个<code>CALayer</code>的属性，且CALayer继承自<code>NSObject</code>，并且根据苹果文档描述”The base layer class”，看来应该是一个layer体系，且layer用于渲染，属于CA阵营，属于图像学派；</li><li>layer的代理是view，这样看来真正用于显示的应该是CALayer，鬼知道CALayer是不是跟OpenGL有关系；</li><li>所以如果你要是想做动画，那我给你的建议就是，最好在layer层上做；</li><li>对于，你知道layer是有个叫做<code>anchorPoint</code>属性的，做过cocos2dx的应该知道，你说layer的display里难道没有点opengl的痕迹？</li><li>还记得仿射变换吗，平移+线性变换，layer完全是可以做到的；</li><li>layer自身是有绘制能力的，只不过不支持事件响应，但有一点它可以做的到：layer遵从了一个<code>CAMediaTiming</code>的协议，而这个协议就厉害了，配合<code>CACurrentMediaTime</code>，跟系统时钟挂上勾，CPU的时钟周期<code>mach_absolute_time</code>转化成秒数的结果，是一个绝对时间；</li></ol></blockquote><h2 id="上面的结论是瞎扯淡"><a href="#上面的结论是瞎扯淡" class="headerlink" title="上面的结论是瞎扯淡"></a>上面的结论是瞎扯淡</h2><h2 id="我们来搞点看的见的"><a href="#我们来搞点看的见的" class="headerlink" title="我们来搞点看的见的"></a>我们来搞点看的见的</h2><ul><li>声明一个View:</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleView</span>: <span class="title">UIView</span> </span>&#123;</span><br><span class="line">    <span class="comment">//我要做一个绕圈的动画</span></span><br><span class="line">    <span class="comment">//我不会告诉你我是谷歌过的</span></span><br><span class="line">    <span class="comment">//我觉得你也应该学会</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>添加两个Layer，如果不够，那就多来几个：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> backgroundLayer: <span class="type">CAShapeLayer</span>?</span><br><span class="line"><span class="keyword">var</span> animationLayer: <span class="type">CAShapeLayer</span>?</span><br><span class="line"><span class="comment">//我觉得你应该知道把它们放在哪</span></span><br><span class="line"><span class="comment">//好吧我还是给你代码对齐吧，这很python</span></span><br></pre></td></tr></table></figure></li><li><p>工厂一个方法啊哟喂，设计模式就出来了：</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给我点颜色，我给你想要的</span></span><br><span class="line"><span class="comment">//当然，我给你的并不多；</span></span><br><span class="line"><span class="comment">//我只是一个CAShapeLayer，有形状的框框；</span></span><br><span class="line"><span class="comment">//有边，有填充；</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">layer</span><span class="params">(lineColor: UIColor)</span></span> -&gt; <span class="type">CAShapeLayer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> layer = <span class="type">CAShapeLayer</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> lineWidth: <span class="type">CGFloat</span> = <span class="number">5</span></span><br><span class="line">    <span class="keyword">let</span> rect = <span class="type">CGRect</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="keyword">self</span>.bounds.width, height: <span class="keyword">self</span>.bounds.height)</span><br><span class="line">    layer.bounds = rect</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//这是个圆</span></span><br><span class="line">    <span class="keyword">let</span> path = <span class="type">UIBezierPath</span>(roundedRect: rect, cornerRadius: rect.width / <span class="number">2</span>)</span><br><span class="line">    layer.lineWidth = lineWidth</span><br><span class="line">    layer.position = <span class="type">CGPoint</span>(x: rect.width / <span class="number">2</span>, y: rect.height / <span class="number">2</span>)</span><br><span class="line">    </span><br><span class="line">    layer.path = path.cgPath</span><br><span class="line">    layer.fillColor = <span class="type">UIColor</span>.clear.cgColor</span><br><span class="line">    layer.strokeColor = lineColor.cgColor</span><br><span class="line">    </span><br><span class="line">    layer.strokeStart = <span class="number">0</span></span><br><span class="line">    layer.strokeEnd = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> layer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>加到view上来</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="keyword">init</span>(frame: <span class="type">CGRect</span>) &#123;</span><br><span class="line">    <span class="keyword">super</span>.<span class="keyword">init</span>(frame: frame)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> bgLayer = <span class="keyword">self</span>.layer(lineColor: <span class="type">UIColor</span>.green)</span><br><span class="line">    <span class="keyword">self</span>.layer.addSublayer(bgLayer)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.backgroundLayer = bgLayer</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> animationLayer = <span class="keyword">self</span>.layer(lineColor: <span class="type">UIColor</span>.orange)</span><br><span class="line">    <span class="keyword">self</span>.layer.addSublayer(animationLayer)</span><br><span class="line">    animationLayer.isHidden = <span class="literal">true</span></span><br><span class="line">    <span class="comment">//关于这个层，我们呆会还要做点其他事情；</span></span><br><span class="line">    <span class="comment">//暂时，它是不被看的到的；</span></span><br><span class="line">    <span class="comment">//所以你可以看到，一个View上是可以添加好多层的；</span></span><br><span class="line">    <span class="comment">//如果你把这些层分区块排列出来，那么我便不加那么多view了；</span></span><br><span class="line">    <span class="comment">//哈哈哈，上面这行我开个玩笑；</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.animationLayer = animationLayer</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.backgroundColor = <span class="type">UIColor</span>.black</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">required</span> <span class="keyword">init</span>?(coder aDecoder: <span class="type">NSCoder</span>) &#123;</span><br><span class="line">    <span class="built_in">fatalError</span>(<span class="string">"init(coder:) has not been implemented"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="我们来加一个动画吧！"><a href="#我们来加一个动画吧！" class="headerlink" title="我们来加一个动画吧！"></a>我们来加一个动画吧！</h2><ul><li>添加动画</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="type">PLAY_ANIMATION_KEY</span> = <span class="string">"animation_key"</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startAnimation</span><span class="params">(totalTime: CGFloat)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> totalTime &gt; <span class="number">0</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">guard</span> ((<span class="keyword">self</span>.animationLayer?.animation(forKey: <span class="type">PLAY_ANIMATION_KEY</span>)) == <span class="literal">nil</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> animation = <span class="type">CABasicAnimation</span>(keyPath: <span class="string">"strokeEnd"</span>)</span><br><span class="line">    animation.duration = <span class="type">CFTimeInterval</span>(totalTime)</span><br><span class="line">    </span><br><span class="line">    animation.delegate = <span class="keyword">self</span>   <span class="comment">//转到它开始动了</span></span><br><span class="line">    </span><br><span class="line">    animation.fromValue = <span class="number">0</span></span><br><span class="line">    animation.toValue = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    animation.isRemovedOnCompletion = <span class="literal">true</span></span><br><span class="line">    animation.fillMode = kCAFillModeForwards</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.add(animation, forKey: <span class="type">PLAY_ANIMATION_KEY</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>上面的我们解释一下，首先我们说一个动画是有名字的，用key表示，像上面的<code>PLAY_ANIMATION_KEY</code>；</li><li>layer添加的动画是<code>CAAnimation</code>类型的，就是说，所有它的子类都可以添加为layer的动画，你可以去挖掘一下<code>CAAnimation</code>一族；</li><li><code>CABasicAnimation</code>添加的动画是需要一个<code>keyPath</code>的，你还需要通过-setFromValue 和-setToValue 来指定一个开始值和结束值，这有点像一个补间动画，输入了起始帧和结束帧，其它马由动画帮你；<blockquote><p><img src="http://static.zybuluo.com/usiege/cy71tbwdl9q3ckokbr8hbqhb/image_1ce1gopv01m4lbd41tjr1nel6e39.png" alt="image_1ce1gopv01m4lbd41tjr1nel6e39.png-165.6kB"></p></blockquote></li><li>我们可以指定CALayer的某个属性名为keyPath，并且对CALayer的这个属性的值进行修改，达到相应的动画效果，随着动画的进行，在长度为duration的持续时间内，keyPath相应属性的值从fromValue渐渐地变为toValue，keyPath内容是CALayer的可动画Animatable属性，关于这个可动画属性，我觉得我还可以去谷歌一车，回头再说吧；</li><li>如果<code>fillMode == kCAFillModeForwards</code>同时<code>removedOnComletion == false</code>，那么在动画执行完毕后，图层会保持显示动画执行后的状态。但在实质上，图层的属性值还是动画执行前的初始值，并没有真正被改变；</li></ol><h2 id="它开始动了"><a href="#它开始动了" class="headerlink" title="它开始动了"></a>它开始动了</h2><p>加入到layer中它会自动开始，并且这开始和结束都有回调哦；<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">CircleView</span>: <span class="title">CAAnimationDelegate</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">animationDidStart</span><span class="params">(<span class="number">_</span> anim: CAAnimation)</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.startTime = <span class="type">CACurrentMediaTime</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">animationDidStop</span><span class="params">(<span class="number">_</span> anim: CAAnimation, finished flag: Bool)</span></span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="暂停和恢复"><a href="#暂停和恢复" class="headerlink" title="暂停和恢复"></a>暂停和恢复</h2><p>我们来记录两个时间：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> startTime: <span class="type">CFTimeInterval</span>!  <span class="comment">//动画开始时系统时钟</span></span><br><span class="line"><span class="keyword">var</span> pastTime: <span class="type">CFTimeInterval</span>!   <span class="comment">//动画运行过的时间（除去暂停的时间）</span></span><br></pre></td></tr></table></figure></p><ul><li>暂停一下<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pauseAnimation</span><span class="params">(layer: CALayer)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pausetime = layer.convertTime(<span class="type">CACurrentMediaTime</span>(), from: <span class="literal">nil</span>)</span><br><span class="line">    layer.timeOffset = pausetime</span><br><span class="line">    layer.speed = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(#function)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"start time: <span class="subst">\(startTime)</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"pause time: <span class="subst">\(pausetime)</span>"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"系统时钟： <span class="subst">\(CACurrentMediaTime()</span>)"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"以GMT为标准的，2001年一月一日00：00：00这一刻的时间绝对值: <span class="subst">\(CFAbsoluteTimeGetCurrent()</span>)"</span>)</span><br><span class="line">    <span class="keyword">let</span> pasttime = pausetime - startTime</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"past time: <span class="subst">\(pasttime)</span>"</span>)</span><br><span class="line">    <span class="keyword">self</span>.pastTime = pasttime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>所以你只需要搞清楚<code>timeOffset</code>，<code>speed</code>以及<code>convertTime</code>就可以了；<br>按我说的做，自己跑一跑，对比下时间，马上清楚，不要再记些什么公式了；</p><ul><li>恢复动画<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">func resumeAnimation(layer: CALayer) &#123;</span><br><span class="line">    let pausetime = layer.timeOffset</span><br><span class="line">    </span><br><span class="line">    layer.timeOffset = 0</span><br><span class="line">    layer.beginTime = 0</span><br><span class="line">    layer.speed = 1</span><br><span class="line">    </span><br><span class="line">    let begintime = layer.convertTime(CACurrentMediaTime(), to: nil) - pausetime</span><br><span class="line">    layer.beginTime = begintime</span><br><span class="line">    </span><br><span class="line">    print(#function)</span><br><span class="line">    print(&quot;系统时钟： \(CACurrentMediaTime())&quot;)</span><br><span class="line">    print(&quot;begin time: \(begintime)&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>那么上面说的需要知道的属性还需要添加一个<code>beginTime</code>；</p><ul><li>最后你需要把动画移除掉吗？<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">stopAnimation</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">self</span>.animationLayer?.animation(forKey: <span class="type">PLAY_ANIMATION_KEY</span>) != <span class="literal">nil</span> <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">CATransaction</span>.begin()</span><br><span class="line">    <span class="type">CATransaction</span>.setDisableActions(<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.timeOffset = <span class="number">0</span></span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.speed = <span class="number">1</span></span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.beginTime = <span class="type">CACurrentMediaTime</span>()</span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.strokeStart = <span class="number">0</span></span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.strokeEnd = <span class="number">1</span></span><br><span class="line">    <span class="type">CATransaction</span>.commit()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.animationLayer?.removeAnimation(forKey: <span class="type">PLAY_ANIMATION_KEY</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>移除我们能看的懂，那么<code>CATransaction</code>呢？</p><h2 id="CATransaction？"><a href="#CATransaction？" class="headerlink" title="CATransaction？"></a>CATransaction？</h2><p>再去谷歌一车吧！！！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我想你一定用过UIView， 我想你也一定知道CALayer是什么，具体细节的东西请自行谷歌，我们今天要用Layer搞一点事情；&lt;/p&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="iOS" scheme="http://charlesblog.site/tags/iOS/"/>
    
      <category term="swift" scheme="http://charlesblog.site/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>我们来探讨一下函数式编程</title>
    <link href="http://charlesblog.site/2018/05/16/%E6%88%91%E4%BB%AC%E6%9D%A5%E6%8E%A2%E8%AE%A8%E4%B8%80%E4%B8%8B%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    <id>http://charlesblog.site/2018/05/16/我们来探讨一下函数式编程/</id>
    <published>2018-05-16T14:08:45.000Z</published>
    <updated>2018-05-17T02:05:22.294Z</updated>
    
    <content type="html"><![CDATA[<p>看了一本叫swift函数式编程的书，第一章就问题引入讨论了一下这个思想，我们来自己理解一下；首先上图，写一下传统做法；<br><a id="more"></a></p><h2 id="首先我们按照书中的定义"><a href="#首先我们按照书中的定义" class="headerlink" title="首先我们按照书中的定义"></a>首先我们按照书中的定义</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Position</span> = <span class="type">CGPoint</span></span><br><span class="line"><span class="keyword">typealias</span> <span class="type">Distance</span> = <span class="type">CGFloat</span></span><br></pre></td></tr></table></figure><p>不懂<em>typealias</em>的请自行查阅；</p><h2 id="我们总是这样做"><a href="#我们总是这样做" class="headerlink" title="我们总是这样做"></a>我们总是这样做</h2><ol><li><p>图1所示，我们现在要表示一个未知点point是否在图中黑色圈圈内，很自然的，我们传入point参数，返回一个bool值，来解决这个问题，通常我们都会这样思考；<br><img src="http://static.zybuluo.com/usiege/ku12muk4e3itce31patxdjdu/291212487821245.png" alt="inRange1"></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inRange1</span><span class="params">(target: Position, range: Distance)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> sqrt(target.x * target.x + target.y * target.y) &lt;= range</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>那么如果我们的圆心不在(0,0)点呢，需要做坐标系仿射变换（线性变换加上一个平移变换）对吧，或者理解仿射有点吃力，我们只做平移变换，就是说现在我们原点不是(0,0)了：<br><img src="http://static.zybuluo.com/usiege/flzxd5sm0yjsedvsaiuwo31p/291235402204895.png" alt="inRange2"></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inRange2</span><span class="params">(target: Position, ownPosition: Position, range: Distance)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> dx = ownPosition.x - target.x</span><br><span class="line">    <span class="keyword">let</span> dy = ownPosition.y - target.y</span><br><span class="line">    <span class="keyword">let</span> targetDistance = sqrt(pow(dx, <span class="number">2.0</span>) + pow(dy, <span class="number">2.0</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> targetDistance &lt;= range</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>其实就是空间中的两个点得出一个相对距离，也很简单对吧，我们继续；</p><ol start="3"><li>现在我们又有新需求了，我们要挖去中间的这个圆，因为我们的点现在要在这个环上运动了：<br><img src="http://static.zybuluo.com/usiege/40zqog5p3vesuuk375hzg7iz/291247102209096.png" alt="inRange34"><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> minimumDistance: <span class="type">Distance</span> = <span class="number">2.0</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inRange3</span><span class="params">(target: Position, ownPosition: Position, range: Distance)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> dx = ownPosition.x - target.x</span><br><span class="line">    <span class="keyword">let</span> dy = ownPosition.y - target.y</span><br><span class="line">    <span class="keyword">let</span> targetDistance = sqrt(pow(dx, <span class="number">2.0</span>) + pow(dy, <span class="number">2.0</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> targetDistance &lt;= range &amp;&amp; targetDistance &gt;= minimumDistance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>就是需要我们挖去以原点为中心，半径为<code>minimumDistance</code>的圆，也还好；</p><ol start="4"><li>我们还要考虑如果有一个圆，让这个圆在小圆环之外；<br>如上图中<code>Friendly</code>所示；<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inRange4</span><span class="params">(target: Position, ownPosition: Position, friendly:Position, range: Distance)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> dx = ownPosition.x - target.x</span><br><span class="line">    <span class="keyword">let</span> dy = ownPosition.y - target.y</span><br><span class="line">    <span class="keyword">let</span> targetDistance = sqrt(dx * dx + dy * dy)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> friendlyDx = friendly.x - target.x</span><br><span class="line">    <span class="keyword">let</span> friendlyDy = friendly.y - target.y</span><br><span class="line">    <span class="keyword">let</span> friendlyDistance = sqrt(pow(friendlyDx, <span class="number">2.0</span>) + pow(friendlyDy, <span class="number">2.0</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> targetDistance &lt;= range</span><br><span class="line">        &amp;&amp; targetDistance &gt;= minimumDistance</span><br><span class="line">        &amp;&amp; friendlyDistance &gt;= minimumDistance</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="我们还可以这样做"><a href="#我们还可以这样做" class="headerlink" title="我们还可以这样做"></a>我们还可以这样做</h2><p>的确如书上所说，我做了好多重复的工作，而且从代码复制粘贴的情况来看，我似乎做了不少工作；太你太臃肿了，需要重构！<br>于是我们定义了这样一个关系，它是一个关系，也是一个值，作者说函数要当作是值来看待的；<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">Region</span> = (<span class="type">Position</span>) -&gt; <span class="type">Bool</span></span><br></pre></td></tr></table></figure></p><p>理解起来也很容易：我是一个函数，我接受一个参数，你可以将Position的点让我来帮你验证，如果你通过我的验证，那你就是我要表达的Region，我会告诉你你的参数是不是我要的结果；<br>很顺畅对吧！接下来我们用它来写几个函数：</p><ul><li><p>inRange1重写</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">circle</span><span class="params">(radius: Distance)</span></span> -&gt; <span class="type">Region</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; position <span class="keyword">in</span></span><br><span class="line">        sqrt(pow(position.x, <span class="number">2.0</span>) + pow(position.y, <span class="number">2.0</span>)) &lt;= radius <span class="comment">//这不加 return 竟然也可以</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>inRange2重写，平移变换圆</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">shift</span><span class="params">(offset: Position, region: @escaping Region)</span></span> -&gt; <span class="type">Region</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; position <span class="keyword">in</span></span><br><span class="line">        <span class="keyword">return</span> region(<span class="type">Position</span>(x: position.x + offset.x, y: position.y + offset.y))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>写一个不是我范围的Region</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">invert</span><span class="params">(region: @escaping Region)</span></span> -&gt; <span class="type">Region</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; position <span class="keyword">in</span></span><br><span class="line">        !region(position)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>来一个相交的区域</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">intersection</span><span class="params">(region1: Region, region2: Region)</span></span> -&gt; <span class="type">Region</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; point <span class="keyword">in</span></span><br><span class="line">        region1(point) &amp;&amp; region2(point)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>来一个并集的区域</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">union</span><span class="params">(region1: Region, region2: Region)</span></span> -&gt; <span class="type">Region</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; point <span class="keyword">in</span></span><br><span class="line">        region1(point) || region2(point)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>再来一个差集</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数表示在region中，而属于minusRegion的部分</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">difference</span><span class="params">(region: Region, minusRegion: Region)</span></span> -&gt; <span class="type">Region</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> intersection(region1: region, region2: invert(region: minusRegion))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>一时间发现把集合的性质写了一个遍，那如果把这个东西写成一个泛型，用的岂不是更多？<br>先不考虑，我们来重新写一下之前的那个<code>inRange4</code>吧！</p><h2 id="最终inRange版本"><a href="#最终inRange版本" class="headerlink" title="最终inRange版本"></a>最终inRange版本</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">inRange</span><span class="params">(ownPosition: Position, target: Position, friendly: Position, range: Distance)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="comment">//表示灰色的圆环，顶点为(0,0)的圆环</span></span><br><span class="line">    <span class="keyword">let</span> rangeRegion = difference(region: circle(radius: range), minusRegion: circle(radius: minimumDistance))</span><br><span class="line">    <span class="comment">//发生了平移变换后的圆环</span></span><br><span class="line">    <span class="keyword">let</span> targetRegion = shift(offset: ownPosition, region: rangeRegion)</span><br><span class="line">    <span class="comment">//发生了平移变换后的朋友圈</span></span><br><span class="line">    <span class="keyword">let</span> friendlyRegion = shift(offset: friendly, region: circle(radius: minimumDistance))</span><br><span class="line">    <span class="comment">//最终结果为在目标圆环中，而不在朋友圈的区域</span></span><br><span class="line">    <span class="keyword">let</span> resultRegion = difference(region: targetRegion, minusRegion: friendlyRegion)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> resultRegion(target)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>我不知道这过程中我做了什么，总的来说我貌似理解的更清晰了，改天再研究吧！你有什么想法，我们可以探讨一下啊！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;看了一本叫swift函数式编程的书，第一章就问题引入讨论了一下这个思想，我们来自己理解一下；首先上图，写一下传统做法；&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="swift" scheme="http://charlesblog.site/tags/swift/"/>
    
      <category term="functional" scheme="http://charlesblog.site/tags/functional/"/>
    
  </entry>
  
  <entry>
    <title>Mac下安装OpenMP并完成编译</title>
    <link href="http://charlesblog.site/2018/05/13/Mac%E4%B8%8B%E5%AE%89%E8%A3%85OpenMP%E5%B9%B6%E5%AE%8C%E6%88%90%E7%BC%96%E8%AF%91/"/>
    <id>http://charlesblog.site/2018/05/13/Mac下安装OpenMP并完成编译/</id>
    <published>2018-05-12T16:47:28.000Z</published>
    <updated>2018-05-14T03:19:31.502Z</updated>
    
    <content type="html"><![CDATA[<p>OpenMP在Mac上的安装，涉及到一些编译器的历史。。。<br><a id="more"></a></p><h2 id="OpenMP环境添加-Mac"><a href="#OpenMP环境添加-Mac" class="headerlink" title="OpenMP环境添加(Mac)"></a>OpenMP环境添加(Mac)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ brew reinstall gcc --without-multilib</span><br><span class="line"><span class="comment"># 安装支持openmp的clang</span></span><br><span class="line">$ brew install clang-omp <span class="comment">#有错</span></span><br></pre></td></tr></table></figure><h2 id="安装错误"><a href="#安装错误" class="headerlink" title="安装错误"></a>安装错误</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Problem: No available formula <span class="keyword">with</span> the name <span class="string">"clang-omp"</span></span><br><span class="line"></span><br><span class="line">ruby -e <span class="string">"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"</span> &lt; <span class="regexp">/dev/</span><span class="literal">null</span> <span class="number">2</span>&gt; <span class="regexp">/dev/</span><span class="literal">null</span></span><br></pre></td></tr></table></figure><p><a href="http://macappstore.org/clang-omp/" target="_blank" rel="noopener">安装错误参考</a>，用以上方法发现未解决问题；</p><blockquote><p>fatal: unable to access <a href="https://github.com/Homebrew/homebrew-core/" target="_blank" rel="noopener">https://github.com/Homebrew/homebrew-core</a>:<br>LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54<br>Error: Fetching /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core failed!<br>Error: Could not link:<br>/usr/local/share/man/man1/brew.1</p></blockquote><blockquote><p>Please delete these paths and run <code>brew update</code>.<br>Error: Could not link:<br>/usr/local/share/doc/homebrew</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除  /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-core 文件夹</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> brew install clang-omp</span></span><br></pre></td></tr></table></figure><blockquote><p>fatal: unable to access ‘<a href="https://github.com/Homebrew/homebrew-core/&#39;" target="_blank" rel="noopener">https://github.com/Homebrew/homebrew-core/&#39;</a>: LibreSSL SSL_read: SSL_ERROR_SYSCALL, errno 54<br>Error: Failure while executing: git clone <a href="https://github.com/Homebrew/homebrew-core" target="_blank" rel="noopener">https://github.com/Homebrew/homebrew-core</a> /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core –depth=1<br>Error: Failure while executing: /usr/local/bin/brew tap homebrew/core</p></blockquote><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>doctor</span><br></pre></td></tr></table></figure><blockquote><p>Error: No available formula with the name “clang-omp”<br>==&gt; Searching for a previously deleted formula (in the last month)…<br>Warning: homebrew/core is shallow clone. To get complete history run:<br>  git -C “$(brew –repo homebrew/core)” fetch –unshallow</p></blockquote><blockquote><p>Error: No previously deleted formula found.<br>==&gt; Searching for similarly named formulae…<br>==&gt; Searching local taps…<br>Error: No similarly named formulae found.<br>==&gt; Searching taps…<br>==&gt; Searching taps on GitHub…<br>Error: No formulae found in taps.</p></blockquote><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">'''</span><br><span class="line">You need a recent version of llvm and libomp which you can get with</span><br><span class="line">'''</span><br><span class="line">$ brew install llvm</span><br><span class="line"># brew install libomp</span><br></pre></td></tr></table></figure><blockquote><p>On Apple Clang, you need to add several options to use OpenMP’s front end<br>instead of the standard driver option. This usually looks like<br>  -Xpreprocessor -fopenmp -lomp</p></blockquote><blockquote><p>You might need to make sure the lib and include directories are discoverable<br>if /usr/local is not searched:<br>-L/usr/local/opt/libomp/lib -I/usr/local/opt/libomp/include</p></blockquote><blockquote><p>For CMake, the following flags will cause the OpenMP::OpenMP_CXX target to<br>be set up correctly:<br>-DOpenMP_CXX_FLAGS=”-Xpreprocessor -fopenmp -I/usr/local/opt/libomp/include”<br>-DOpenMP_CXX_LIB_NAMES=”omp”<br>-DOpenMP_omp_LIBRARY=/usr/local/opt/libomp/lib/libomp.dylib</p></blockquote><p>接下来发现libomp已经在我的lib库里了，定位：<em>/usr/local/opt/libomp</em>；<br>下面要做的事情就是终端到你写的.c文件下，输入以下命令编译；<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -Xclang -fopenmp openmp_test.c -I /usr/local/opt/libom/<span class="keyword">include</span> -L /usr/local/opt/libomp/<span class="class"><span class="keyword">lib</span> -<span class="title">lomp</span></span></span><br></pre></td></tr></table></figure></p><p>上面这个命令会链接头文件和动态库，我们想办法把这两个路径添加到环境变量里，每次都写路径很麻烦；</p><h2 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> OMP_NUM_THREADS=4</span><br><span class="line">$ gcc -fopenmp filename.c</span><br></pre></td></tr></table></figure><p>因为我们要用clang来编译，所以上面的这个编译过程应该写为；</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> OMP_NUM_THREADS=4</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> clang -fopenmp filename.c -o filename</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> clang: error: unsupported option <span class="string">'-fopenmp'</span></span></span><br></pre></td></tr></table></figure><p>最终解决方案，Homebrew安装的GCC存放在 /usr/local/bin/gcc-5 中（GCC5.2.0版）。此时，系统中依然有 /usr/bin/gcc ，然而这个GCC是clang的链接。所以在编译时，需要使用类似 gcc-5 xxx.c -o xxx -fopenmp 进行编译，而不是使用默认的gcc。</p><p>所以只要我们用下面的编译方法就可以了：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> gcc-6 -fopenmp filename.c -o filename</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./filename <span class="comment">#执行吧！</span></span></span><br></pre></td></tr></table></figure></p><p>真的是绕了一圈，原来是llvm 与 gcc的历史问题；</p><h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><p>附1：测试程序</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;omp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> omp parallel</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"Hello from thread %d, nthreads %d\n"</span>, omp_get_thread_num(), omp_get_num_threads());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>附2： 继续找发现一个在Xcode上安装clang-omp安装的方法，未测试通过，慎用；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew install llvm</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/llvm/bin:$PATH"'</span> &gt;&gt; ~/.bash_profile</span><br></pre></td></tr></table></figure><p><img src="http://static.zybuluo.com/usiege/voi9cducaj6qxf9gyj22j7o5/image_1cdaaol7q1a32nov11t4108hg4vm.png" alt="image_1cdaaol7q1a32nov11t4108hg4vm.png-115.1kB"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;OpenMP在Mac上的安装，涉及到一些编译器的历史。。。&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="Mac" scheme="http://charlesblog.site/tags/Mac/"/>
    
      <category term="OpenMP" scheme="http://charlesblog.site/tags/OpenMP/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://charlesblog.site/2018/05/07/hello-world/"/>
    <id>http://charlesblog.site/2018/05/07/hello-world/</id>
    <published>2018-05-07T02:17:42.733Z</published>
    <updated>2018-05-07T02:17:42.733Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.<br><a id="more"></a></p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&quot;https://hexo.io/docs/troubleshooting.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&quot;https://github.com/hexojs/hexo/issues&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GitHub&lt;/a&gt;.&lt;br&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>你一定不知道Swift源码怎么看？</title>
    <link href="http://charlesblog.site/2018/05/03/%E4%BD%A0%E4%B8%80%E5%AE%9A%E4%B8%8D%E7%9F%A5%E9%81%93Swift%E6%BA%90%E7%A0%81%E6%80%8E%E4%B9%88%E7%9C%8B%EF%BC%9F/"/>
    <id>http://charlesblog.site/2018/05/03/你一定不知道Swift源码怎么看？/</id>
    <published>2018-05-03T15:19:00.000Z</published>
    <updated>2018-05-07T02:17:42.734Z</updated>
    
    <content type="html"><![CDATA[<p>我想你一定是在开玩笑。<br>源码怎么看，打开看呗！说这话的时候请收下我的轻蔑，哈哈。不过就这个问题我今天在知乎搜索了一通。不要问我为什么在知乎搜索，鬼知道知乎什么都有。<br>那么，请收下我的提问：<br><a id="more"></a></p><blockquote><p><a href="https://www.zhihu.com/question/38215419" target="_blank" rel="noopener">如何阅读Swift源码</a></p></blockquote><p>知乎果然没有让我失望，结果教程如下；</p><blockquote><p><a href="http://swift.gg/2016/12/30/how-to-read-the-swift-standard-libray-source/" target="_blank" rel="noopener"># <a href="http://swift.gg/2016/12/30/how-to-read-the-swift-standard-libray-source/" title="如何阅读 Swift 标准库中的源码" target="_blank" rel="noopener">如何阅读 Swift 标准库中的源码</a></a></p></blockquote><p>顺便提一下，这次搜索还让我发现了一个比较不错的swift网站，有心的同学请收下：<a href="http://swift.gg" target="_blank" rel="noopener">swift.gg</a></p><p>于是今天搞了下源码的编译，并了解到一个叫做 <em>GYB</em> 的东西，这个东西今天先放一下。源碼編譯的過程無非就是用 <em>brew</em> 下了一些命令行軟件，然後使用 <em>build</em> 腳本跑一下過程，在此也不多說。但是今天的重點當然是我們要從源碼出發搞一些事情。<br>续：今天又build，发现也并没有得出什么重要的东西，只是把gyb文件生成为swift文件，其他过程不知道它经历了什么，对我想看源码没有任何作用，还跑了整整一个下午；对于只是想看代码的同学，还是用官网给出的gyb.py脚本做处理吧；</p><ol><li>hashable</li></ol><p>前两天写Dictionary时发现想用枚举做key，自定义一个Dictionary，value是#selector，但是在写的过程中发现说key值需要遵循hashable协议。可以看源码来理解一下。<br>首先要找到Hashable文件，发现swift的标准核心库被放在 <strong>stdlib/public/core</strong> 下，有一个 <strong>Hashable.swift</strong> 文件，打开文件先是一大段的描述，大体内容就是hashable协议作用的场景，以及给出了一个小例子；</p><p>一个Hash类型，提供了一个 hashValue 的属性，它是一个整型常量， 如果有两个相同类型的a，b，如果 a == b，那么 a.hashValue == b.hashValue；但是反过来，如果两个hash值相同，并不表示a 就一定等于 b；<br>还有一点非常重要，就是在两次不同的程序执行中hash值并不保证相等，所以不要把hash值用在你的程序中；<br>Hashable协议可用于struct, enum, class，它继承于 Equatable，所以遵循Hashable协议需要同时实现Hashable协议方法，以及 Equatable 协议方法；</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// A point in an x-y coordinate system.</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">GridPoint</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> x: <span class="type">Int</span></span><br><span class="line">        <span class="keyword">var</span> y: <span class="type">Int</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="class"><span class="keyword">extension</span> <span class="title">GridPoint</span>: <span class="title">Hashable</span> </span>&#123;</span><br><span class="line">         <span class="keyword">var</span> hashValue: <span class="type">Int</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x.hashValue ^ y.hashValue &amp;* <span class="number">16777619</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: GridPoint, rhs: GridPoint)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> lhs.x == rhs.x &amp;&amp; lhs.y == rhs.y</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">var</span> tappedPoints: <span class="type">Set</span> = [<span class="type">GridPoint</span>(x: <span class="number">2</span>, y: <span class="number">3</span>), <span class="type">GridPoint</span>(x: <span class="number">4</span>, y: <span class="number">1</span>)]</span><br><span class="line">       <span class="keyword">let</span> nextTap = <span class="type">GridPoint</span>(x: <span class="number">0</span>, y: <span class="number">1</span>)</span><br><span class="line">       <span class="keyword">if</span> tappedPoints.<span class="built_in">contains</span>(nextTap) &#123;</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">"Already tapped at (<span class="subst">\(nextTap.x)</span>, <span class="subst">\(nextTap.y)</span>)."</span>)</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          tappedPoints.insert(nextTap)</span><br><span class="line">          <span class="built_in">print</span>(<span class="string">"New tap detected at (<span class="subst">\(nextTap.x)</span>, <span class="subst">\(nextTap.y)</span>)."</span>)</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="comment">// Prints "New tap detected at (0, 1).")</span></span><br></pre></td></tr></table></figure><p>在实现的代码里有一些奇怪的符号，暂时还有点摸不清头脑，有些是一些编译符号，大体能看懂点意思，但有些像<code>@_silgen_name(&quot;_swift_stdlib_Hashable_isEqual_indirect&quot;)</code>就完全看不懂，回头找人再请教；<br>这里还要说的一个就是一个<code>UnsafePointer&lt;T&gt;</code>:</p><blockquote><p>在 Swift 中，指针都使用一个特殊的类型来表示，那就是 UnsafePointer<t>。遵循了 Cocoa 的一贯不可变原则，UnsafePointer<t> 也是不可变的。当然对应地，它还有一个可变变体，UnsafeMutablePointer<t>。绝大部分时间里，C 中的指针都会被以这两种类型引入到 Swift 中：C 中 const 修饰的指针对应 UnsafePointer (最常见的应该就是 C 字符串的 const char * 了)，而其他可变的指针则对应 UnsafeMutablePointer。除此之外，Swift 中存在表示一组连续数据指针的 UnsafeBufferPointer<t>，表示非完整结构的不透明指针 COpaquePointer 等等。另外你可能已经注意到了，能够确定指向内容的指针类型都是泛型的 struct，我们可以通过这个泛型来对指针指向的类型进行约束以提供一定安全性。</t></t></t></t></p></blockquote><p>需要具体了解的看这篇：<a href="https://onevcat.com/2015/01/swift-pointer/" target="_blank" rel="noopener">UnsafePointe<t></t></a></p><p>顺便吐槽句哈，apple的代码也还有这种东西，也不知道是修改过的没有；<br><img src="https://upload-images.jianshu.io/upload_images/1429775-225ee3ef5a38e747.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="FIXME"></p><ol start="2"><li>Equatable</li></ol><ul><li>它是一种可用于值比较的类型；</li><li>在序列和集合操作中，可以将一个遵循了<code>Equatable</code>协议的对象传递给<code>contaions(_:)</code>方法，来确定是否包含，用法如下：</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = [<span class="string">"Nora"</span>, <span class="string">"Fern"</span>, <span class="string">"Ryan"</span>, <span class="string">"Rainer"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nameToCheck = <span class="string">"Ryan"</span></span><br><span class="line"><span class="keyword">if</span> students.<span class="built_in">contains</span>(nameToCheck) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(nameToCheck)</span> is signed up!"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"No record of <span class="subst">\(nameToCheck)</span>."</span>)</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">// Prints "Ryan is signed up!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// Conforming to the Equatable Protocol</span></span><br></pre></td></tr></table></figure><ul><li>本地类型继承自<code>Equatable</code>协议需要注意：<ol><li>对于一个<code>struct</code>类型，它的所有存储属性都需要遵循<code>Equatable</code>协议；</li><li>对于一个<code>enum</code>类型，它的所有关联值都需要遵循<code>Equatable</code>协议；</li><li>如果上述标准不符合，需要在扩展中实现<code>==</code>静态方法；<br>例如：</li></ol></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreetAddress</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> number: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> street: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> unit: <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> number: <span class="type">String</span>, <span class="number">_</span> street: <span class="type">String</span>, unit: <span class="type">String</span>? = <span class="literal">nil</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.number = number</span><br><span class="line">        <span class="keyword">self</span>.street = street</span><br><span class="line">        <span class="keyword">self</span>.unit = unit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">StreetAddress</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: StreetAddress, rhs: StreetAddress)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">            lhs.number == rhs.number &amp;&amp;</span><br><span class="line">            lhs.street == rhs.street &amp;&amp;</span><br><span class="line">            lhs.unit == rhs.unit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> addresses = [<span class="type">StreetAddress</span>(<span class="string">"1490"</span>, <span class="string">"Grove Street"</span>),</span><br><span class="line">                 <span class="type">StreetAddress</span>(<span class="string">"2119"</span>, <span class="string">"Maple Avenue"</span>),</span><br><span class="line">                 <span class="type">StreetAddress</span>(<span class="string">"1400"</span>, <span class="string">"16th Street"</span>)]</span><br><span class="line"><span class="keyword">let</span> home = <span class="type">StreetAddress</span>(<span class="string">"1400"</span>, <span class="string">"16th Street"</span>)</span><br><span class="line"><span class="built_in">print</span>(addresses[<span class="number">0</span>] == home)</span><br><span class="line"><span class="comment">// Prints "false"</span></span><br><span class="line"><span class="built_in">print</span>(addresses.<span class="built_in">contains</span>(home))</span><br><span class="line"><span class="comment">// Prints "true"</span></span><br></pre></td></tr></table></figure><ul><li>另外我在这个实现里面看到了以前数学课知识的身影：</li></ul><ul><li><code>a == a</code> is always <code>true</code> (Reflexivity)   # 自反性</li><li><code>a == b</code> implies <code>b == a</code> (Symmetry)  # 对称性</li><li><code>a == b</code> and <code>b == c</code> implies <code>a == c</code> (Transitivity)  # 传递性<br>所以我们定义的<code>==</code>(两对象相等)完全取决于我们自己实现的静态方法：</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IntegerRef</span>: <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">init</span>(<span class="number">_</span> value: <span class="type">Int</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.value = value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: IntegerRef, rhs: IntegerRef)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lhs.value == rhs.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> a = <span class="type">IntegerRef</span>(<span class="number">100</span>)</span><br><span class="line"><span class="keyword">let</span> b = <span class="type">IntegerRef</span>(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(a == a, a == b, separator: <span class="string">", "</span>)</span><br><span class="line"><span class="comment">// Prints "true, true"</span></span><br></pre></td></tr></table></figure><p>而不相等的定义则完全是，自实现的相等操作取反：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">extension</span> <span class="selector-tag">Equatable</span> &#123;</span><br><span class="line">  <span class="comment">/// Returns a Boolean value indicating whether two values are not equal.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Inequality is the inverse of equality. For any values `a` and `b`, `a != b`</span></span><br><span class="line">  <span class="comment">/// implies that `a == b` is `false`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// This is the default implementation of the not-equal-to operator (`!=`)</span></span><br><span class="line">  <span class="comment">/// for any type that conforms to `Equatable`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - lhs: A value to compare.</span></span><br><span class="line">  <span class="comment">///   - rhs: Another value to compare.</span></span><br><span class="line">  <span class="variable">@inlinable</span> <span class="comment">// FIXME(sil-serialize-all)</span></span><br><span class="line">  <span class="variable">@_transparent</span></span><br><span class="line">  public static func != (<span class="attribute">lhs</span>: Self, <span class="attribute">rhs</span>: Self) -&gt; Bool &#123;</span><br><span class="line">    <span class="selector-tag">return</span> !(lhs == rhs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个实现是已经定义好的！！!</p><ul><li><code>==</code>与<code>===</code>的区别<br>看一下这两者的区别：</li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">protocol</span> <span class="title">Equatable</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// Returns a Boolean value indicating whether two values are equal.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// Equality is the inverse of inequality. For any values `a` and `b`,</span></span><br><span class="line">  <span class="comment">/// `a == b` implies that `a != b` is `false`.</span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// - Parameters:</span></span><br><span class="line">  <span class="comment">///   - lhs: A value to compare.</span></span><br><span class="line">  <span class="comment">///   - rhs: Another value to compare.</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> == <span class="params">(lhs: <span class="keyword">Self</span>, rhs: <span class="keyword">Self</span>)</span></span> -&gt; <span class="type">Bool</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@inlinable <span class="comment">// FIXME(sil-serialize-all)</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> === <span class="params">(lhs: AnyObject?, rhs: AnyObject?)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (lhs, rhs) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="keyword">let</span> (l?, r?):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ObjectIdentifier</span>(l) == <span class="type">ObjectIdentifier</span>(r)</span><br><span class="line">  <span class="keyword">case</span> (<span class="literal">nil</span>, <span class="literal">nil</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从以上可以看出，<code>==</code>只是由实现好的静态函数决定，而<code>===</code>则是可以判断两个对象是否完全相等，这有点像判断两个指针相等一样，同样，我们要注意，如果两个可选对象都是nil，则也是<code>===</code>的；</p><ol start="3"><li>搞清楚两个问题</li></ol><ul><li><p>UTC 与 GMT<br>UTC(Coordinated Universal Time)标准时间参照，协调时间时，世界标准时间;<br>GMT(Greenwich Mean Time)时区，即格林尼治时间，位于本初子午线的标界处时间，世界计算时间和经度的起点，GMT是个时区，等同于世界时，所以GMT = UTC + 0，我们国家所在时间均以北京时间计算，北京位于东八区，所以时区为GMT + 8；</p></li><li><p>Locale<br>网上找了一圈，最后还是swift源码文档里给出的解释最靠谱：<code>Locale</code>封装了有关语言，文化和技术规范和标准的信息。由语言环境封装的信息示例包括，用于数字中小数点分隔符的符号以及格式化日期的方式。区域设置通常用于根据用户的习俗和偏好提供，格式化和解释信息。它们经常与格式化程序一起使用。虽然可以使用很多语言环境，但通常使用与当前用户关联的语言环境。<br>语言环境跟系统的环境设置有关，会涉及到操作系统语言环境设置，个人理解就是一个国际化的东西。<br>区域设置中的概念 LANGID &amp; LCID：<br><img src="https://upload-images.jianshu.io/upload_images/1429775-04ff650284a51b6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="LANGID &amp; LCID"></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我想你一定是在开玩笑。&lt;br&gt;源码怎么看，打开看呗！说这话的时候请收下我的轻蔑，哈哈。不过就这个问题我今天在知乎搜索了一通。不要问我为什么在知乎搜索，鬼知道知乎什么都有。&lt;br&gt;那么，请收下我的提问：&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="swift" scheme="http://charlesblog.site/tags/swift/"/>
    
      <category term="UTC" scheme="http://charlesblog.site/tags/UTC/"/>
    
  </entry>
  
  <entry>
    <title>本行三件事：猎龙 训龙 调教龙</title>
    <link href="http://charlesblog.site/2018/04/27/%E6%9C%AC%E8%A1%8C%E4%B8%89%E4%BB%B6%E4%BA%8B%EF%BC%9A%E7%8C%8E%E9%BE%99%20%E8%AE%AD%E9%BE%99%20%E8%B0%83%E6%95%99%E9%BE%99/"/>
    <id>http://charlesblog.site/2018/04/27/本行三件事：猎龙 训龙 调教龙/</id>
    <published>2018-04-27T12:45:00.000Z</published>
    <updated>2018-05-07T02:17:42.737Z</updated>
    
    <content type="html"><![CDATA[<p>大家好，我是花木兰。<br><a id="more"></a></p><h2 id="第一件"><a href="#第一件" class="headerlink" title="第一件"></a>第一件</h2><p>今天在<strong>Nothing</strong>项目中添加了一个小的功能，就是按压屏幕出现一个有弹出效果的<em>Label</em>，涉及到的点；</p><ol><li>thereis</li></ol><ul><li>touches</li></ul><p>我们知道，UIResponder处理函数，根据不同的触摸状态会调用不同的函数，以下：<br><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-<span class="params">(void)</span>touchesBegan:<span class="params">(NSSet *)</span>touches withEvent:<span class="params">(UIEvent *)</span>event;</span><br><span class="line"></span><br><span class="line">-<span class="params">(void)</span>touchesMoved:<span class="params">(NSSet *)</span>touches withEvent:<span class="params">(UIEvent *)</span>event;</span><br><span class="line"></span><br><span class="line">-<span class="params">(void)</span>touchesEnded:<span class="params">(NSSet *)</span>touches withEvent:<span class="params">(UIEvent *)</span>event;</span><br><span class="line"></span><br><span class="line">-<span class="params">(void)</span>touchesCancelled:<span class="params">(NSSet *)</span>touches withEvent:<span class="params">(UIEvent *)</span>event;</span><br></pre></td></tr></table></figure></p><p>注意第四个取消函数，调用时机是触摸被取消，一定要注意是被取消，自己主动点击然后结束这不叫取消，举个例子如在触摸过程中被来电打断，这种情况才算；<br>回调中可以通过<em>UITouch</em>来操作点击次数和手指数，<em>UIEvent</em>可以操作屏幕点信息，这样就把手指与屏幕的交互处理完成。</p><ul><li>transform<br>这里出现了一个现象，原代码如下：<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进入时的设置</span></span><br><span class="line">        <span class="comment">//向x y轴方向平移 0 0</span></span><br><span class="line">        self.transform = CGAffineTransform(<span class="string">translationX:</span> <span class="number">0</span>, <span class="string">y:</span> <span class="number">0</span>) <span class="comment">//(1)</span></span><br><span class="line">        self.transform = CGAffineTransform(<span class="string">rotationAngle:</span> <span class="number">0</span>) <span class="comment">// (2)</span></span><br><span class="line">        </span><br><span class="line">        self.transform = CGAffineTransform(<span class="string">scaleX:</span> <span class="number">0.1</span>, <span class="string">y:</span> <span class="number">0.1</span>) <span class="comment">//(3)</span></span><br><span class="line">        <span class="comment">//transform scale 改变中间不能添加其他变换</span></span><br><span class="line">        <span class="comment">//动画播放</span></span><br><span class="line">        UIView.animate(<span class="string">withDuration:</span> <span class="number">0.5</span>, <span class="string">delay:</span> <span class="number">0</span>, <span class="string">options:</span> .curveEaseOut, <span class="string">animations:</span> &#123;</span><br><span class="line">            self.transform = CGAffineTransform(<span class="string">scaleX:</span> <span class="number">1</span>, <span class="string">y:</span> <span class="number">1</span>)</span><br><span class="line">        &#125;, <span class="string">completion:</span> nil) <span class="comment">//(4)</span></span><br></pre></td></tr></table></figure></li></ul><p>如上代码<em>(2)</em>如果放在<em>(3)</em>和<em>(4)</em>的中间，则动画会不执行，直接形成动画后的结果，天知道这其中发生了什么，怕是动画函数做了某些优化，如果你知道，还请赐教。</p><ul><li>Another Problem<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIView.animate(<span class="string">withDuration:</span> <span class="number">1</span>, <span class="string">delay:</span> <span class="number">0</span>, </span><br><span class="line"><span class="string">usingSpringWithDamping:</span> <span class="number">0.5</span>, </span><br><span class="line"><span class="string">initialSpringVelocity:</span> <span class="number">0.5</span>, <span class="string">options:</span> .curveEaseIn, <span class="string">animations:</span> &#123;</span><br><span class="line">           self.transform = CGAffineTransform(<span class="string">scaleX:</span> <span class="number">1</span>, <span class="string">y:</span> <span class="number">1</span>)</span><br><span class="line">&#125;, <span class="string">completion:</span> nil)</span><br><span class="line"><span class="comment">// 抗阻尼 以及 弹簧 的问题</span></span><br><span class="line"><span class="comment">// 涉及到了一些物理知识，不细究</span></span><br><span class="line"><span class="comment">// 只是贴出这个api 注意用法</span></span><br></pre></td></tr></table></figure></li></ul><ol start="2"><li>仿射变换</li></ol><p><a href="http://www.fuzihao.org/blog/2014/10/23/%E4%BB%BF%E5%B0%84%E7%A9%BA%E9%97%B4%E4%B8%8E%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2/" target="_blank" rel="noopener">仿射空间和仿射变换</a><br>关于仿射变换的先看这篇文章了解一下吧，它是计算机图形学中一个很重要的概念，简单的理解就是线性变换加上平移变换，当然看到这里你得先知道什么是线性变换和平移变换，好了，这个概念先不多说了。</p><ol start="3"><li>currying function</li></ol><p>经过了一系列的实验，最终得出了一个函数链的方案，虽然跟柯里化没有什么关系，代码如下，细细品味一下：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">maybe</span><span class="params">(noDate: NODate, <span class="number">_</span> some: <span class="params">()</span></span></span> -&gt; ()) -&gt; <span class="type">ThereIs</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> noDate &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .<span class="type">April</span>(date):</span><br><span class="line">            <span class="keyword">let</span> myDate = date.toDate()</span><br><span class="line">            <span class="keyword">let</span> currentDate = <span class="type">Date</span>()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">let</span> myDate = myDate &#123;</span><br><span class="line">                <span class="keyword">if</span> myDate.compare(currentDate) == .orderedSame &#123;</span><br><span class="line">                    some()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>其实也没有多么深奥，只是函数在调用外部传进的闭包后又返回了自身，然而，就是一个这样简单的设计，在调用时你会发现是多么的便利；<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">_</span> = thereis?.<span class="built_in">maybe</span>(noDate: dates[<span class="number">0</span>]) &#123;</span><br><span class="line">                self.noLabel.appear()</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="built_in">maybe</span>(noDate: dates[<span class="number">1</span>]) &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p><p>上图中的<em>maybe</em>函数可以无限调用，这样根据传进来的参数可以实现一个小功能，如果将本方法的类似方法分散在不同的函数中调用，那么我们可以用传进不同参数来区分调用的时机，这样可以将某一次的逻辑调用统一在一个地方处理，说的有点绕，用一张图来理一下思路：<br><img src="https://upload-images.jianshu.io/upload_images/1429775-e58a9faeb3c885d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="maybe函数思维导图"></p><h2 id="第二件"><a href="#第二件" class="headerlink" title="第二件"></a>第二件</h2><p>此时我面前有一个作业，叫做文献综述，今天跟老铁聊天中发现自己在面对困难问题时拖延的问题。朋友说当你有一大堆的事情不知道做哪件时，挑最难的那件事情做。<br>于是把每天最棘手的问题做为首要，比方说难做的作业，比方说写一篇文章。<br><img src="http://upload-images.jianshu.io/upload_images/1429775-1aea7d4c63680f89.jpg" alt="轻课听力"><br>上图是昨晚在轻课群的口语练习，留作复习用。</p><h2 id="第三件"><a href="#第三件" class="headerlink" title="第三件"></a>第三件</h2><p>已经很久没有写日志了，这么些年断断续续的，从来没把它当作一个习惯来做。在github上看到一个学习库，有所启发，想来该培养一个习惯来让自己保持一个学习的状态。完成的并不一定要完美，完成就好，记录下心情，记录下问题，记录下昨天那个“愚蠢”的自己。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;大家好，我是花木兰。&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="iOS" scheme="http://charlesblog.site/tags/iOS/"/>
    
      <category term="paradigm" scheme="http://charlesblog.site/tags/paradigm/"/>
    
  </entry>
  
  <entry>
    <title>朴素贝叶斯使用Python进行文本分类</title>
    <link href="http://charlesblog.site/2018/04/17/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E4%BD%BF%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB/"/>
    <id>http://charlesblog.site/2018/04/17/朴素贝叶斯使用Python进行文本分类/</id>
    <published>2018-04-17T15:08:00.000Z</published>
    <updated>2018-05-07T02:17:42.737Z</updated>
    
    <content type="html"><![CDATA[<p>这是我第一篇关于机器学习的文章。<br><a id="more"></a></p><ol><li>从文本中创建词向量bayes.py</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!usr/bin/python</span></span><br><span class="line"><span class="comment">#-*-encoding:utf-8-*-</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">该函数返回实验样本，该样本被切分成词条集合；</span></span><br><span class="line"><span class="string">第二个变量返回类别，该类别由人工标注，用于训练程序以便自动检查侮辱性留言；</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadDataSet</span><span class="params">()</span>:</span></span><br><span class="line">postingList = [</span><br><span class="line">[<span class="string">'my'</span>,<span class="string">'dog'</span>,<span class="string">'has'</span>,<span class="string">'flea'</span>,<span class="string">'problems'</span>,<span class="string">'help'</span>,<span class="string">'please'</span>],</span><br><span class="line">[<span class="string">'maybe'</span>,<span class="string">'not'</span>,<span class="string">'take'</span>,<span class="string">'him'</span>,<span class="string">'to'</span>,<span class="string">'dog'</span>,<span class="string">'park'</span>,<span class="string">'stupid'</span>],</span><br><span class="line">[<span class="string">'my'</span>,<span class="string">'dalmation'</span>,<span class="string">'is'</span>,<span class="string">'so'</span>,<span class="string">'cute'</span>,<span class="string">'I'</span>,<span class="string">'love'</span>,<span class="string">'him'</span>],</span><br><span class="line">[<span class="string">'stop'</span>,<span class="string">'posting'</span>,<span class="string">'stupid'</span>,<span class="string">'worthless'</span>,<span class="string">'garbage'</span>],</span><br><span class="line">[<span class="string">'mr'</span>,<span class="string">'licks'</span>,<span class="string">'ate'</span>,<span class="string">'my'</span>,<span class="string">'steak'</span>,<span class="string">'how'</span>,<span class="string">'to'</span>,<span class="string">'stop'</span>,<span class="string">'him'</span>],</span><br><span class="line">[<span class="string">'quit'</span>,<span class="string">'buying'</span>,<span class="string">'worthless'</span>,<span class="string">'dog'</span>,<span class="string">'food'</span>,<span class="string">'stupid'</span>]</span><br><span class="line">]</span><br><span class="line">classVec = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>] <span class="comment"># 1代表侮辱性文字 0代表正常</span></span><br><span class="line"><span class="keyword">return</span> postingList, classVec</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">createVocabList</span><span class="params">(dataSet)</span>:</span></span><br><span class="line">vocabSet = set([])<span class="comment">#创建一个空集</span></span><br><span class="line"><span class="keyword">for</span> document <span class="keyword">in</span> dataSet:</span><br><span class="line">vocabSet = vocabSet | set(document) <span class="comment">#创建两集合并集</span></span><br><span class="line"><span class="keyword">return</span> list(vocabSet)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">该函数输入参数为词汇表及某个文档，输出的是文档向量，向量每一元素为1or0，分别表示词汇表中的单词在输入文档中是否出现</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setOfWords2Vec</span><span class="params">(vocabList, inputSet)</span>:</span></span><br><span class="line">returnVec = [<span class="number">0</span>] * len(vocabList)</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> inputSet:</span><br><span class="line"><span class="keyword">if</span> word <span class="keyword">in</span> vocabList:</span><br><span class="line">returnVec[vocabList.index(word)] = <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">"the word: %s is not in my Vocabulary!"</span> % word)</span><br><span class="line"><span class="keyword">return</span> returnVec</span><br></pre></td></tr></table></figure><p><img src="http://static.zybuluo.com/usiege/08jgn0fh17i3tesytmd39qsl/image_1cb7dhd105761rg11lkq1mgjpt19.png" alt="image_1cb7dhd105761rg11lkq1mgjpt19.png-132.9kB"></p><ol start="2"><li>朴素贝叶斯训练函数</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#朴素贝叶斯训练函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trainNB0</span><span class="params">(trainMatrix, trainCategory)</span>:</span></span><br><span class="line">numTrainDocs = len(trainMatrix)</span><br><span class="line">numWords = len(trainMatrix[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">pAbusive = sum(trainCategory)/float(numTrainDocs) </span><br><span class="line"></span><br><span class="line"><span class="comment">#某词出现次数</span></span><br><span class="line">p0Num = zeros(numWords)</span><br><span class="line">p1Num = zeros(numWords)</span><br><span class="line"><span class="comment">#在所有的文档中，出现某词的文档的总词数</span></span><br><span class="line">p0Denom = <span class="number">0.0</span></span><br><span class="line">p1Denom = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(numTrainDocs):</span><br><span class="line"><span class="keyword">if</span> trainCategory[i] == <span class="number">1</span>:</span><br><span class="line">p1Num += trainMatrix[i]</span><br><span class="line">p1Denom += sum(trainMatrix[i])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p0Num += trainMatrix[i]</span><br><span class="line">p0Denom += sum(trainMatrix[i])</span><br><span class="line"></span><br><span class="line">p1Vect = p1Num/p1Denom</span><br><span class="line">p0Vect = p0Num/p0Denom</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> p0Vect, p1Vect, pAbusive</span><br></pre></td></tr></table></figure><p><img src="http://static.zybuluo.com/usiege/41wgod8054yss08dj5zcae5d/image_1cb7gr8l6tli1gq8515ev19i013.png" alt="image_1cb7gr8l6tli1gq8515ev19i013.png-368.4kB"></p><p><img src="http://static.zybuluo.com/usiege/vw73jzr2d42s7l5us6duu8d8/image_1cb7gs04bmv319kp11841cvq73i1g.png" alt="image_1cb7gs04bmv319kp11841cvq73i1g.png-125.3kB"></p><ol start="3"><li>修改分类器</li></ol><ul><li>Problem1:计算多个概率的乘积以获得文档属于某个类别概率，如果其中有一个概率值为0，那最后乘积也为0；为降低这种影响，可以将所有词出现初始化为1，并将分母初始化为2</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p0Num = ones(numWords); </span><br><span class="line">p1Num = ones(numWords)</span><br><span class="line">p0Denom = <span class="number">2.0</span>;</span><br><span class="line">p1Denom = <span class="number">2.0</span></span><br></pre></td></tr></table></figure><ul><li>Problem2: 下溢出，太多很小的数相乘会造成下溢出，解决办法是取自然对数，把乘法转换成加法，通过求对数避免下溢出或者浮点数舍入导致错误</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p1Vect = log(p1Num/p1Denom)</span><br><span class="line">p0Vect = log(p0Num/p0Denom)</span><br></pre></td></tr></table></figure><ol start="4"><li>分类器编写</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#构建朴素贝叶斯分类函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">classityNB</span><span class="params">(vec2Classify, p0Vec, p1Vec, pClass1)</span>:</span></span><br><span class="line">p1 = sum(vec2Classify * p1Vec) + log(pClass1)</span><br><span class="line">p0 = sum(vec2Classify * p0Vec) + log(<span class="number">1.0</span> - pClass1)</span><br><span class="line"><span class="keyword">if</span> p1 &gt; p0: </span><br><span class="line"><span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">testingNB</span><span class="params">()</span>:</span></span><br><span class="line">listOPosts, listClasses = loadDataSet()</span><br><span class="line">myVocabList = createVocabList(listOPosts)</span><br><span class="line">trainMat = []</span><br><span class="line"><span class="keyword">for</span> postinDoc <span class="keyword">in</span> listOPosts:</span><br><span class="line">trainMat.append(setOfWords2Vec(myVocabList, postinDoc))</span><br><span class="line">p0V, p1V, pAb = trainNB0(array(trainMat), array(listClasses))</span><br><span class="line"></span><br><span class="line">testEntry = [<span class="string">'love'</span>, <span class="string">'my'</span>, <span class="string">'dalmation'</span>]</span><br><span class="line">thisDoc = array(setOfWords2Vec(myVocabList, testEntry))</span><br><span class="line">print(testEntry, <span class="string">'classified as:'</span>, classityNB(thisDoc, p0V, p1V, pAb))</span><br><span class="line"></span><br><span class="line">testEntry = [<span class="string">'stupid'</span>, <span class="string">'garbage'</span>]</span><br><span class="line">thisDoc = array(setOfWords2Vec(myVocabList, testEntry))</span><br><span class="line">print(testEntry, <span class="string">'classified as:'</span>, classityNB(thisDoc, p0V, p1V, pAb))</span><br></pre></td></tr></table></figure><p>通过训练器分类得出结果：<br><img src="http://static.zybuluo.com/usiege/qfnldhvk83es60qqfapx4kn4/image_1cba21hoeuca2kt17n5bdu3e9p.png" alt="image_1cba21hoeuca2kt17n5bdu3e9p.png-38.4kB"></p><ol start="5"><li>文档词袋模型</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#文档词袋模型</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bagofWords2VecMN</span><span class="params">(vocabList, inputSet)</span>:</span></span><br><span class="line">returnVec = [<span class="number">0</span>] * len(vocabList)</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> inputSet:</span><br><span class="line"><span class="keyword">if</span> word <span class="keyword">in</span> vocabList:</span><br><span class="line">returnVec[vocabList.index(word)] += <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> returnVec</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是我第一篇关于机器学习的文章。&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="Python" scheme="http://charlesblog.site/tags/Python/"/>
    
      <category term="Mechine-Learning" scheme="http://charlesblog.site/tags/Mechine-Learning/"/>
    
  </entry>
  
  <entry>
    <title>MGJRouter代码分析</title>
    <link href="http://charlesblog.site/2018/01/07/MGJRouter%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90/"/>
    <id>http://charlesblog.site/2018/01/07/MGJRouter代码分析/</id>
    <published>2018-01-07T09:21:00.000Z</published>
    <updated>2018-05-07T02:17:42.730Z</updated>
    
    <content type="html"><![CDATA[<p>今天来聊聊组件化，之前一直听说大厂在搞，什么淘宝架构，什么蘑菇街，既然谈到了架构的问题，那必属重中之重。接下来分析一下蘑菇街开源的代码，自己做个总结。<br><a id="more"></a></p><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>类书本的文章个人感觉还是写不来的，再搬到自己写的东西这来也不合适，所以直接上一链接，通过链接文章大致可了解下它的前身后世，产生原因，以及整体宏观架构设计，而我接下来要做的是细化，以及转化，便于自己吸收<br>———&gt; <a href="https://www.jianshu.com/p/67a6004f6930" target="_blank" rel="noopener">组件化架构漫谈</a></p><ol><li>话不多说，先看入口：</li></ol><p><img src="http://static.zybuluo.com/usiege/f0dci325k3jmmrh2l9uy51s4/image_1c25qj3m5ejq111g1v5lvkgjek9.png" alt="image_1c25qj3m5ejq111g1v5lvkgjek9.png-7.7kB"><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MGJRouter</span> ()</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  保存了所有已注册的 URL</span></span><br><span class="line"><span class="comment"> *  结构类似 @&#123;@"beauty": @&#123;@":id": &#123;@"_", [block copy]&#125;&#125;&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSMutableDictionary</span> *routes;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">instancetype</span>)sharedInstance</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> MGJRouter *instance = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        instance = [[<span class="keyword">self</span> alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>很明显，蘑菇街架构（以下简称MGJ）通过该单例作管理，统一进行调配，而该单例仅有一个变量，就是<strong>routes</strong>，实际上它仅仅是管理了一个字典的结构，具体字典内有哪些内容，我们慢慢看；</p><ol start="2"><li>回调Block的定义</li></ol><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  routerParameters 里内置的几个参数会用到上面定义的 string</span><br><span class="line"> */</span><br><span class="line">typedef void (^<span class="type">MGJRouterHandler</span>)(<span class="type">NSDictionary</span> *routerParameters);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  需要返回一个 object，配合 objectForURL: 使用</span><br><span class="line"> */</span><br><span class="line">typedef id (^<span class="type">MGJRouterObjectHandler</span>)(<span class="type">NSDictionary</span> *routerParameters);</span><br></pre></td></tr></table></figure><p>上面这两个block定义是MGJ注册URL的回调，一个带返回值，另一个不带，在这里我们说一下<strong>带返回值的block用法</strong>；如下举例 ——&gt;<br><img src="http://static.zybuluo.com/usiege/xn1r7ergmr6xr6msy2p5tyrh/WX20180107-134538@2x.png" alt="WX20180107-134538@2x.png-37.5kB"><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">UIViewController</span> *(^ViewControllerHandler)();</span><br><span class="line"></span><br><span class="line"><span class="comment">//作参数</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DemoListViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)registerWithTitle:(<span class="built_in">NSString</span> *)title handler:(ViewControllerHandler)handler;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DemoListViewController</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)registerWithTitle:(<span class="built_in">NSString</span> *)title handler:(ViewControllerHandler)handler</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UIViewController</span>* vc = handler()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在别处调用</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">DemoDetailViewController</span></span></span><br><span class="line">[DemoListViewController registerWithTitle:<span class="string">@"基本使用"</span> handler:^<span class="built_in">UIViewController</span> *&#123;</span><br><span class="line">        <span class="keyword">return</span> DemoDetailViewController();</span><br><span class="line">&#125;];</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p><p>如上，我们把<code>ViewControllerHandler</code>的运行延迟到了实际调用的时刻，并且我们可以在这个handler的实现中带入很多信息；</p><ol start="3"><li>MGJ数据结构管理</li></ol><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> MGJRouterParameterURL;</span><br><span class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> MGJRouterParameterCompletion;</span><br><span class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> *<span class="keyword">const</span> MGJRouterParameterUserInfo;</span><br><span class="line"><span class="comment">//*************************************************</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> MGJ_ROUTER_WILDCARD_CHARACTER = <span class="string">@"~"</span>;  <span class="comment">//这是一个占位符</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> *specialCharacters = <span class="string">@"/?&amp;."</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> MGJRouterParameterURL = <span class="string">@"MGJRouterParameterURL"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> MGJRouterParameterCompletion = <span class="string">@"MGJRouterParameterCompletion"</span>;</span><br><span class="line"><span class="built_in">NSString</span> *<span class="keyword">const</span> MGJRouterParameterUserInfo = <span class="string">@"MGJRouterParameterUserInfo"</span>;</span><br></pre></td></tr></table></figure><p>从这里我们可以看出，MGJ的路由管理，实际上是一个解析url以及对应的管理，我们举几个URL来看一下：<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@"mgj:<span class="comment">//"</span></span><br><span class="line">@"mgj:<span class="comment">//foo/bar/none/exists"</span></span><br><span class="line">@"mgj:<span class="comment">//foo/bar" </span></span><br><span class="line">@"mgj:<span class="comment">//category/家居"</span></span><br><span class="line">@"mgj:<span class="comment">//category/travel"</span></span><br><span class="line">@"mgj:<span class="comment">//search/:query"</span></span><br><span class="line">@"mgj:<span class="comment">//detail"</span></span><br><span class="line">@"mgj:<span class="comment">//search/:keyword"</span></span><br><span class="line">@"mgj:<span class="comment">//search_top_bar"</span></span><br></pre></td></tr></table></figure></p><p>通过上面的URL我们可以看出，路由的管理实际上就是url的解析过程，下面我们来具体看一下解析过程；</p><ol start="4"><li>URL解析</li></ol><ul><li>route url</li></ul><p><img src="http://static.zybuluo.com/usiege/wr5j4jwfcaov7yfmx3u82nyk/WX20180107-150437@2x.png" alt="WX20180107-150437@2x.png-59.1kB"><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray*)<span class="string">pathComponentsFromURL:</span>(NSString*)URL</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray *pathComponents = [NSMutableArray array];</span><br><span class="line">    <span class="keyword">if</span> ([URL <span class="string">rangeOfString:</span>@<span class="string">"://"</span>].location != NSNotFound) &#123;</span><br><span class="line">        NSArray *pathSegments = [URL <span class="string">componentsSeparatedByString:</span>@<span class="string">"://"</span>];</span><br><span class="line">        <span class="comment">// 如果 URL 包含协议，那么把协议作为第一个元素放进去</span></span><br><span class="line">        [pathComponents <span class="string">addObject:</span>pathSegments[<span class="number">0</span>]];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果只有协议，那么放一个占位符</span></span><br><span class="line">        URL = pathSegments.lastObject;</span><br><span class="line">        <span class="keyword">if</span> (!URL.length) &#123;</span><br><span class="line">            [pathComponents <span class="string">addObject:</span>MGJ_ROUTER_WILDCARD_CHARACTER];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (NSString *pathComponent <span class="keyword">in</span> [[NSURL <span class="string">URLWithString:</span>URL] pathComponents]) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([pathComponent <span class="string">isEqualToString:</span>@<span class="string">"/"</span>]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> ([[pathComponent <span class="string">substringToIndex:</span><span class="number">1</span>] <span class="string">isEqualToString:</span>@<span class="string">"?"</span>]) <span class="keyword">break</span>;</span><br><span class="line">        [pathComponents <span class="string">addObject:</span>pathComponent];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [pathComponents copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><p>key-value<br><img src="http://static.zybuluo.com/usiege/j23e7t541u0wcoohza0ktqmb/WX20180107-151956@2x.png" alt="WX20180107-151956@2x.png-111.8kB"></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableDictionary</span> *)addURLPattern:(<span class="built_in">NSString</span> *)URLPattern</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSArray</span> *pathComponents = [<span class="keyword">self</span> pathComponentsFromURL:URLPattern];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span>* subRoutes = <span class="keyword">self</span>.routes;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span>* pathComponent <span class="keyword">in</span> pathComponents) &#123;</span><br><span class="line">        <span class="keyword">if</span> (![subRoutes objectForKey:pathComponent]) &#123;</span><br><span class="line">            subRoutes[pathComponent] = [[<span class="built_in">NSMutableDictionary</span> alloc] init];</span><br><span class="line">        &#125;</span><br><span class="line">        subRoutes = subRoutes[pathComponent];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> subRoutes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>核心url解析</p></li></ul><p><img src="http://static.zybuluo.com/usiege/cbn7v2xkwlfy3c19m322o7mg/WX20180107-160319@2x.png" alt="WX20180107-160319@2x.png-147.8kB"><br><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">NSMutableDictionary</span> *)extractParametersFromURL:(<span class="built_in">NSString</span> *)url</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span>* parameters = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    </span><br><span class="line">    parameters[MGJRouterParameterURL] = url;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSMutableDictionary</span>* subRoutes = <span class="keyword">self</span>.routes;</span><br><span class="line">    <span class="built_in">NSArray</span>* pathComponents = [<span class="keyword">self</span> pathComponentsFromURL:url];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">BOOL</span> found = <span class="literal">NO</span>;</span><br><span class="line">    <span class="comment">// borrowed from HHRouter(https://github.com/Huohua/HHRouter)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span>* pathComponent <span class="keyword">in</span> pathComponents) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 对 key 进行排序，这样可以把 ~ 放到最后</span></span><br><span class="line">        <span class="built_in">NSArray</span> *subRoutesKeys =[subRoutes.allKeys sortedArrayUsingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="built_in">NSString</span> *obj1, <span class="built_in">NSString</span> *obj2) &#123;</span><br><span class="line">            <span class="keyword">return</span> [obj1 compare:obj2];</span><br><span class="line">        &#125;];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">NSString</span>* key <span class="keyword">in</span> subRoutesKeys) &#123;</span><br><span class="line">            <span class="keyword">if</span> ([key isEqualToString:pathComponent] || [key isEqualToString:MGJ_ROUTER_WILDCARD_CHARACTER]) &#123;</span><br><span class="line">                found = <span class="literal">YES</span>;</span><br><span class="line">                subRoutes = subRoutes[key];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ([key hasPrefix:<span class="string">@":"</span>]) &#123;</span><br><span class="line">                found = <span class="literal">YES</span>;</span><br><span class="line">                subRoutes = subRoutes[key];</span><br><span class="line">                <span class="built_in">NSString</span> *newKey = [key substringFromIndex:<span class="number">1</span>];</span><br><span class="line">                <span class="built_in">NSString</span> *newPathComponent = pathComponent;</span><br><span class="line">                <span class="comment">// 再做一下特殊处理，比如 :id.html -&gt; :id</span></span><br><span class="line">                <span class="keyword">if</span> ([<span class="keyword">self</span>.class checkIfContainsSpecialCharacter:key]) &#123;</span><br><span class="line">                    <span class="built_in">NSCharacterSet</span> *specialCharacterSet = [<span class="built_in">NSCharacterSet</span> characterSetWithCharactersInString:specialCharacters];</span><br><span class="line">                    <span class="built_in">NSRange</span> range = [key rangeOfCharacterFromSet:specialCharacterSet];</span><br><span class="line">                    <span class="keyword">if</span> (range.location != <span class="built_in">NSNotFound</span>) &#123;</span><br><span class="line">                        <span class="comment">// 把 pathComponent 后面的部分也去掉</span></span><br><span class="line">                        newKey = [newKey substringToIndex:range.location - <span class="number">1</span>];</span><br><span class="line">                        <span class="built_in">NSString</span> *suffixToStrip = [key substringFromIndex:range.location];</span><br><span class="line">                        newPathComponent = [newPathComponent stringByReplacingOccurrencesOfString:suffixToStrip withString:<span class="string">@""</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                parameters[newKey] = newPathComponent;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果没有找到该 pathComponent 对应的 handler，则以上一层的 handler 作为 fallback</span></span><br><span class="line">        <span class="keyword">if</span> (!found &amp;&amp; !subRoutes[<span class="string">@"_"</span>]) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Extract Params From Query.</span></span><br><span class="line">    <span class="built_in">NSArray</span>&lt;<span class="built_in">NSURLQueryItem</span> *&gt; *queryItems = [[<span class="built_in">NSURLComponents</span> alloc] initWithURL:[[<span class="built_in">NSURL</span> alloc] initWithString:url] resolvingAgainstBaseURL:<span class="literal">false</span>].queryItems;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSURLQueryItem</span> *item <span class="keyword">in</span> queryItems) &#123;</span><br><span class="line">        parameters[item.name] = item.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (subRoutes[<span class="string">@"_"</span>]) &#123;</span><br><span class="line">        parameters[<span class="string">@"block"</span>] = [subRoutes[<span class="string">@"_"</span>] <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ (void)openURL:(NSString *)URL withUserInfo:(NSDictionary *)userInfo completion:(void (^)(id result))completion</span><br><span class="line">&#123;</span><br><span class="line">    URL = [URL stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSMutableDictionary *<span class="keyword">parameters</span> = [[self <span class="comment">sharedInstance] extractParametersFromURL:URL]</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">parameters</span> enumerateKeysAndObjectsUsingBlock:^(id <span class="comment">key, NSString *obj, BOOL *stop) &#123;</span></span><br><span class="line">        if <span class="comment">([obj isKindOfClass:[NSString class]]) &#123;</span></span><br><span class="line">            <span class="keyword">parameters</span>[key] = [obj <span class="comment">stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding]</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">parameters</span>) &#123;</span><br><span class="line">        MGJRouterHandler <span class="comment">handler = parameters[@</span><span class="comment">"block"</span><span class="comment">]</span>;</span><br><span class="line">        <span class="keyword">if</span> (completion) &#123;</span><br><span class="line">            <span class="keyword">parameters</span>[MGJRouterParameterCompletion] = completion;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userInfo) &#123;</span><br><span class="line">            <span class="keyword">parameters</span>[MGJRouterParameterUserInfo] = userInfo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//所以注册路由时的回调是在这里才调用到的</span></span><br><span class="line">        <span class="comment">//也就是openURL响应了register的回调</span></span><br><span class="line">        <span class="keyword">if</span> (handler) &#123;</span><br><span class="line">            [<span class="keyword">parameters</span> removeObjectForKey:@<span class="string">"block"</span>];</span><br><span class="line">            handler(<span class="keyword">parameters</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>后续？</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天来聊聊组件化，之前一直听说大厂在搞，什么淘宝架构，什么蘑菇街，既然谈到了架构的问题，那必属重中之重。接下来分析一下蘑菇街开源的代码，自己做个总结。&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="iOS" scheme="http://charlesblog.site/tags/iOS/"/>
    
      <category term="modularization" scheme="http://charlesblog.site/tags/modularization/"/>
    
  </entry>
  
  <entry>
    <title>Swift Currying(柯里化)</title>
    <link href="http://charlesblog.site/2018/01/06/Swift%20Currying%EF%BC%88%E6%9F%AF%E9%87%8C%E5%8C%96%EF%BC%89/"/>
    <id>http://charlesblog.site/2018/01/06/Swift Currying（柯里化）/</id>
    <published>2018-01-06T08:34:00.000Z</published>
    <updated>2018-05-07T02:17:42.732Z</updated>
    
    <content type="html"><![CDATA[<p>Currying<br><a id="more"></a></p><ol><li>函数式编程思想</li></ol><p>先举一个小例子：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addOne</span><span class="params">(<span class="built_in">count</span>: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">count</span> + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//上面这个代码我们是返回一个加和，和是使参数增加1；</span></span><br><span class="line"><span class="comment">//一个更加灵活的方法，我们可以取消上面的硬编码1；</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="built_in">count</span>: Int, addition: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">count</span> + addition</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//然而这个函数还并不是那么友好，我们用另外一种方法实现看一下：</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(<span class="number">_</span> addition: Int)</span></span> -&gt; (<span class="type">Int</span>) -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="built_in">count</span> <span class="keyword">in</span> </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">count</span> + addition</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用一下以上方法，看看有什么区别：</span></span><br><span class="line"><span class="keyword">let</span> number = add(<span class="built_in">count</span>: <span class="number">10</span>, addition: <span class="number">2</span>)    <span class="comment">//函数2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> add2 = add(<span class="number">2</span>)           <span class="comment">//函数3</span></span><br><span class="line"><span class="keyword">let</span> number = add2(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> number = add(<span class="number">2</span>)(<span class="number">10</span>)     <span class="comment">//函数3调用连起来是</span></span><br><span class="line"><span class="comment">//是不是觉得这种调用方式很熟悉，有点类似于</span></span><br><span class="line"><span class="comment">//classname.property.subproperty，点语法链</span></span><br></pre></td></tr></table></figure></p><p>显然这种编程方式更加灵活，所展现的内容更加直观，可以减少函数写N多的参数；当然函数式编程有的可不只是这些，更多内容不在本篇所讨论之内；</p><p>基于上例我们来写一个方法：<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func greaterThan<span class="function"><span class="params">(_ comparer: Int)</span> -&gt;</span> <span class="function"><span class="params">(Int)</span> -&gt;</span> Bool &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; $<span class="number">0</span> &gt; comparer &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> compareResult = greaterThan(<span class="number">10</span>)(<span class="number">11</span>)</span><br></pre></td></tr></table></figure></p><p>很明显下面这个式子的调用直观的表达了参数10和参数11的大小；</p><ol start="2"><li>target-action例子</li></ol><p>我们来看国外网上的一个例子：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">TargetAction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">performAction</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TargetActionWrapper</span>&lt;<span class="title">T</span>: <span class="title">AnyObject</span>&gt;: <span class="title">TargetAction</span> </span>&#123;</span><br><span class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> target: <span class="type">T</span>?</span><br><span class="line">    <span class="keyword">let</span> action: (<span class="type">T</span>) -&gt; () -&gt; (<span class="type">Void</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">performAction</span><span class="params">()</span></span> -&gt; (<span class="type">Void</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> t = target &#123;</span><br><span class="line">            action(t)()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ControlEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">TouchUpInside</span></span><br><span class="line">    <span class="keyword">case</span> <span class="type">ValueChanged</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;              </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Control</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> actions = [<span class="type">ControlEvent</span>: <span class="type">TargetAction</span>]()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">convenience</span> <span class="keyword">init</span>&lt;<span class="type">T</span>: <span class="type">AnyObject</span>&gt;(<span class="number">_</span> target: <span class="type">T</span>, action: @escaping (<span class="type">T</span>) -&gt; () -&gt; (<span class="type">Void</span>), controlEvent: <span class="type">ControlEvent</span>) &#123;</span><br><span class="line">        actions[controlEvent] = <span class="type">TargetActionWrapper</span>(</span><br><span class="line">            target: target, action: action)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setTarget</span>&lt;T: AnyObject&gt;<span class="params">(target: T, action: @escaping <span class="params">(T)</span></span></span> -&gt; () -&gt; (<span class="type">Void</span>), controlEvent: <span class="type">ControlEvent</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            actions[controlEvent] = <span class="type">TargetActionWrapper</span>(target: target, action: action)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">removeTargetForControlEvent</span><span class="params">(controlEvent: ControlEvent)</span></span> &#123;</span><br><span class="line">        actions[controlEvent] = <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">performActionForControlEvent</span><span class="params">(controlEvent: ControlEvent)</span></span> &#123;</span><br><span class="line">        actions[controlEvent]?.performAction()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//我们来使用一下我们的模板</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">Control</span>().setTarget(<span class="keyword">self</span>, action: <span class="type">ViewController</span>.tapAction, controlEvent: .touchUpInside)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">tapAction</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"单击了"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果我们不是用实例方法调用而是自定义构造函数的话</span></span><br><span class="line"><span class="comment">//我们能看到更好的表现方式</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="type">Control</span>.<span class="keyword">init</span>(<span class="keyword">self</span>, action: <span class="type">ViewController</span>.tapAction controlEvent: .touchUpInside)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当然这个便利构造函数的例子用在这里并不是很合逻辑，但是我们只是想展现一下柯里化的内容</span></span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Currying&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="swift" scheme="http://charlesblog.site/tags/swift/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins 构建之脚本篇</title>
    <link href="http://charlesblog.site/2017/12/12/Jenkins%20%E6%9E%84%E5%BB%BA%E4%B9%8B%E8%84%9A%E6%9C%AC%E7%AF%87/"/>
    <id>http://charlesblog.site/2017/12/12/Jenkins 构建之脚本篇/</id>
    <published>2017-12-12T12:53:00.000Z</published>
    <updated>2018-05-07T02:17:42.730Z</updated>
    
    <content type="html"><![CDATA[<p>之前一直纠结Xcode 9之后用Jenkins导出.ipa文件失败，后经朋友指点终于成功，在此结出终级解决之法；<br><a id="more"></a></p><p>大致思路是这样的：Jenkins在网页中的配置大多会在之后进行整理，最终在终端生成shell脚本，然后每完成一项就会在构建结果中显示成功，如有一步错，则整个构建过程将会失败，所以这就解释了之前构建一直卡在了Achiver成功之后。</p><p>基于上面的思路，则弃用之前的Jenkins配置，取消Jenkins项目中构建过程，Xcode配置全部清空，使用脚本配置，以下我会具体贴出，并适当讲解：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash -l</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANG</span>=en_US.UTF-8</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANGUAGE</span>=en_US.UTF-8</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LC_ALL</span>=en_US.UTF-8</span><br><span class="line"></span><br><span class="line"><span class="comment">#以下PROJECT_NAME为项目工程名称</span></span><br><span class="line">pod install --verbose --no-repo-update</span><br><span class="line">open PROJECT_NAME.xcworkspace</span><br><span class="line"></span><br><span class="line"><span class="comment">#以下USER_NAME为用户名</span></span><br><span class="line"><span class="attribute">project_path</span>=<span class="string">"/Users/USER_NAME/.jenkins/workspace/PROJECT_NAME"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定项目地址</span></span><br><span class="line"><span class="attribute">workspace_path</span>=<span class="string">"<span class="variable">$project_path</span>/PROJECT_NAME.xcworkspace"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#取当前时间字符串添加到文件夹结尾</span></span><br><span class="line"><span class="attribute">now</span>=$(date +<span class="string">"%Y_%m_%d_%H_%M_%S"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#指定项目的scheme名称</span></span><br><span class="line"><span class="attribute">scheme</span>=<span class="string">"PROJECT_NAME"</span></span><br><span class="line"><span class="comment">#指定要打包的配置名</span></span><br><span class="line"><span class="attribute">configuration</span>=<span class="string">"Release"</span></span><br><span class="line"><span class="comment">#指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development, 和developer-id，即xcodebuild的method参数</span></span><br><span class="line"><span class="attribute">export_method</span>=<span class="string">'enterprise'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定输出路径</span></span><br><span class="line"><span class="attribute">output_path</span>=<span class="string">"<span class="variable">$project_path</span>/build/PROJECT_NAME&#123;now&#125;"</span></span><br><span class="line"><span class="comment">#指定输出归档文件地址</span></span><br><span class="line"><span class="attribute">archive_path</span>=<span class="string">"<span class="variable">$output_path</span>/PROJECT_NAME.xcarchive"</span></span><br><span class="line"><span class="comment">#指定输出ipa名称</span></span><br><span class="line"><span class="attribute">ipa_name</span>=<span class="string">"PROJECT_NAME&#123;now&#125;.ipa"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定输出ipa地址</span></span><br><span class="line"><span class="attribute">ipa_path</span>=<span class="string">"<span class="variable">$output_path</span>/<span class="variable">$&#123;ipa_name&#125;</span>"</span></span><br><span class="line"><span class="comment">#指定打包配置</span></span><br><span class="line"><span class="attribute">export_plist_path</span>=<span class="string">"<span class="variable">$project_path</span>/ExportOptions.plist"</span></span><br><span class="line"><span class="comment">#获取执行命令时的commit message</span></span><br><span class="line"><span class="comment">#commit_msg="$(cat $project_path/build_log.txt)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#输出设定的变量值</span></span><br><span class="line">echo <span class="string">"===workspace path: <span class="variable">$&#123;workspace_path&#125;</span>==="</span></span><br><span class="line">echo <span class="string">"===archive path: <span class="variable">$&#123;archive_path&#125;</span>==="</span></span><br><span class="line">echo <span class="string">"===ipa path: <span class="variable">$&#123;ipa_path&#125;</span>==="</span></span><br><span class="line">echo <span class="string">"===export method: <span class="variable">$&#123;export_method&#125;</span>==="</span></span><br><span class="line"><span class="comment">#echo "===commit msg: $&#123;commit_msg&#125;==="</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#先清空前一次build</span></span><br><span class="line">xcodebuild clean -workspace <span class="variable">$&#123;workspace_path&#125;</span> -scheme <span class="variable">$&#123;scheme&#125;</span> -configuration <span class="variable">$&#123;configuration&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#归档</span></span><br><span class="line">xcodebuild archive -workspace <span class="variable">$&#123;workspace_path&#125;</span> -scheme <span class="variable">$&#123;scheme&#125;</span> -archivePath <span class="variable">$&#123;archive_path&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#导出</span></span><br><span class="line">xcodebuild -exportArchive -archivePath <span class="variable">$&#123;archive_path&#125;</span> -exportPath <span class="variable">$&#123;output_path&#125;</span> -exportOptionsPlist <span class="variable">$&#123;export_plist_path&#125;</span></span><br></pre></td></tr></table></figure><p>依此上秘法，会获得Xcode 9下构建成功之案例，.ipa文件也会导出，至于之后上传到平台上，请到各平台下自行找文档整理，不做赘述。</p><p>今天新年，祝大家新年快乐，2018，代码不出bug，新技术很快上手，妹子泡到手软，工资涨的飞快，人生乐的飞起！！！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;之前一直纠结Xcode 9之后用Jenkins导出.ipa文件失败，后经朋友指点终于成功，在此结出终级解决之法；&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="jenkins" scheme="http://charlesblog.site/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins 100次构建失败踩坑全录（二）</title>
    <link href="http://charlesblog.site/2017/12/10/Jenkins%20100%E6%AC%A1%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5%E8%B8%A9%E5%9D%91%E5%85%A8%E5%BD%95%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>http://charlesblog.site/2017/12/10/Jenkins 100次构建失败踩坑全录（二）/</id>
    <published>2017-12-10T12:53:00.000Z</published>
    <updated>2018-05-07T02:17:42.729Z</updated>
    
    <content type="html"><![CDATA[<p>接上篇，继续踩坑，下面到构建触发器环节：<br><a id="more"></a></p><ul><li><p>构建触发器<br><img src="http://static.zybuluo.com/usiege/it14w81rja3zme63xykjxy5o/image_1c0qnmug31v0hvkf1pp1kqf1bir9.png" alt="image_1c0qnmug31v0hvkf1pp1kqf1bir9.png-91.5kB"><br>能用到的发图所示，说明在下方，自行研究，需要注意的一点是图中的*号之间是有空格的；</p></li><li><p>构建环境<br>这里又有一个超时，与上面的无关，这个是构建过程中的，根据需要添加，下面那个选项是时间戳；<br><img src="http://static.zybuluo.com/usiege/pjeg3kt1s3cb0rxb2l1dfsfr/image_1c0qooi0dkg7ls9abefu71n77p.png" alt="image_1c0qooi0dkg7ls9abefu71n77p.png-38.6kB"></p></li></ul><p>接下来是Keychains和Mobile PP，必填项；<br><img src="http://static.zybuluo.com/usiege/cjtc66sg8991c5ulj3uib8dq/image_1c0qosdhm132q23k103kckp1dok16.png" alt="image_1c0qosdhm132q23k103kckp1dok16.png-8kB"></p><p>逐个击破：<br>Keychains部分<br><img src="http://static.zybuluo.com/usiege/li5lfp7spsd6c3bw435besbb/image_1c0qovfpn1n431vc7n8qonb8o51j.png" alt="image_1c0qovfpn1n431vc7n8qonb8o51j.png-83.2kB"><br>这个部分也是选择题，因为之前你已经上传了，但是这里会出现无法选择的bug，点保存刷新下页面就可以选了，Variables部分填如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;KEYCHAIN_PATH&#125; <span class="variable">$&#123;KEYCHAIN_PASSWORD&#125;</span> <span class="variable">$&#123;CODE_SIGNING_IDENTITY&#125;</span></span></span><br></pre></td></tr></table></figure></p><p>Mobile Provisioning Profiles部分<br><img src="http://static.zybuluo.com/usiege/1s0il4bxtsop1ame15pbq0ul/image_1c0qprhce18lu1vjb1pd1aakjv20.png" alt="image_1c0qprhce18lu1vjb1pd1aakjv20.png-47.6kB"><br>这个部分同上，请选择你确定的PP文件，一定要对应好：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;PROVISIONING_PROFILE&#125;</span></span><br></pre></td></tr></table></figure></p><ul><li>构建</li></ul><p>整个配置过程最重要的部分，大多数问题都出在这里，我这里目前到了Archive阶段，也就是说归档成功，然后归档结果可以用xcode进行ipa打包，具体打包还要设置一个shell脚本，网上好多，有的可以用有的不可以，所以打算研究下这个脚本，自己写一个再上传，之后会在博客中跟进，现在先继续把已完成的部分写下来；</p><p>首先是先要加一个结束后的脚本，这个脚本不做打包操作，只是设置一下环境，以及配置一下有pod依赖的情况，如下：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/bin/bash -l</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANG</span>=en_US.UTF-8</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANGUAGE</span>=en_US.UTF-8</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">LC_ALL</span>=en_US.UTF-8</span><br><span class="line"></span><br><span class="line">pod install --verbose --no-repo-update</span><br><span class="line">open LeWaiJiao.xcworkspace</span><br></pre></td></tr></table></figure></p><p><img src="http://static.zybuluo.com/usiege/rxby0iwous3ppc63wyn1c83y/image_1c0qqc2ubcfq5tvuui19m3oi89.png" alt="image_1c0qqc2ubcfq5tvuui19m3oi89.png-47.4kB"></p><p>下面的那个<strong>Pack application,build and sign</strong> .ipa项就是打ipa的功能，暂时没有搞通，后续会补上来，先跳过；</p><p><img src="http://static.zybuluo.com/usiege/eceobb4arpah1xacmv2lmxrr/image_1c0qqnucp1np81vaj3rs1l7p1otdm.png" alt="image_1c0qqnucp1np81vaj3rs1l7p1otdm.png-97.4kB"></p><p><strong>Code signing &amp; OS X keychain options</strong></p><p>下面的bundleID是你要进行打包的bundleID，info.plist是workspace下的路径，注意一下下面的Development Team ID这个ID是你的钥匙串上的证书名称，后面括号里的那一串字符，由字母和数字组成的，需要你自己做对应，下面的照着抄就行了，password填你电脑用户的密码，不要填错了；</p><p><img src="http://static.zybuluo.com/usiege/xhxhseh11fwg4wnbt8gpj95y/image_1c0qr7dli1unv1s7s1vu2ugm1fuh13.png" alt="image_1c0qr7dli1unv1s7s1vu2ugm1fuh13.png-102.7kB"></p><h1 id="贴几个Error："><a href="#贴几个Error：" class="headerlink" title="贴几个Error："></a>贴几个Error：</h1><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Code Signing <span class="literal">Error</span>: Code signing <span class="keyword">is</span> required <span class="keyword">for</span> product <span class="keyword">type</span> <span class="symbol">'Application</span>' <span class="keyword">in</span> SDK <span class="symbol">'iOS</span> <span class="number">11.1</span>'</span><br></pre></td></tr></table></figure><p>需要你在xcode中设置，然后上传到你们的Git服务器再构建：<br><img src="http://static.zybuluo.com/usiege/r85b8hxub85tfinbuzue1svp/image_1c0qs83ul1baipc04otg331geb1g.png" alt="image_1c0qs83ul1baipc04otg331geb1g.png-35.4kB"></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No <span class="keyword">global</span> development team <span class="keyword">or</span> <span class="keyword">local</span> team ID was configured.</span><br></pre></td></tr></table></figure><p>就是之前说的<strong>Development Team ID</strong>部分，填了就解决了；<br><a href="http://www.jianshu.com/p/8b2fc2da0466" target="_blank" rel="noopener">http://www.jianshu.com/p/8b2fc2da0466</a></p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcodebuild: <span class="keyword">error</span>: The flag -scheme <span class="keyword">is</span> required when specifying -archivePath <span class="keyword">but</span> <span class="keyword">not</span> -exportArchive.</span><br></pre></td></tr></table></figure><p>这个问题也是个大坑，找了好久，也是搜狗找到的：<br><a href="http://www.jianshu.com/p/8967e4e27e9b" target="_blank" rel="noopener">http://www.jianshu.com/p/8967e4e27e9b</a><br><a href="https://www.tuicool.com/articles/zQ73Q3Q" target="_blank" rel="noopener">https://www.tuicool.com/articles/zQ73Q3Q</a><br><a href="https://github.com/jenkinsci/clang-scanbuild-plugin/commit/b970f5280a9c1929e9cd9d3b4d2b76a7d6cbc0dc" target="_blank" rel="noopener">https://github.com/jenkinsci/clang-scanbuild-plugin/commit/b970f5280a9c1929e9cd9d3b4d2b76a7d6cbc0dc</a></p><p>解决方法最直接的就是指定scheme和xcode workspace file，分别填你xcode工程中的scheme和pod生成的xcworkspace的名字；<br><img src="http://static.zybuluo.com/usiege/tlotqzvjbjlqk2ms1u43w2yd/image_1c0r0aqt33tdthopme188a2kk1t.png" alt="image_1c0r0aqt33tdthopme188a2kk1t.png-87.3kB"></p><p>有些同学不知道scheme在什么地方，如下图所示：<br><img src="http://static.zybuluo.com/usiege/1y4937ijhbvifle7jfgjg3ac/image_1c0r0eai5f09qj47rs134c1upu2a.png" alt="image_1c0r0eai5f09qj47rs134c1upu2a.png-145.6kB"></p><p>如上，能保证构建可以成功在Archive过程完成，如遇其他问题，欢迎评论区讨论；<br>之后会再继续完成打包ipa以及上传平台，同时之前提过的SSH部分会持续跟近，因为SSH与本文所讨论的内容并不十分吻合，所以这里不作讨论。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接上篇，继续踩坑，下面到构建触发器环节：&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="jenkins" scheme="http://charlesblog.site/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Jenkins 100次构建失败踩坑全录（一）</title>
    <link href="http://charlesblog.site/2017/12/09/Jenkins%20100%E6%AC%A1%E6%9E%84%E5%BB%BA%E5%A4%B1%E8%B4%A5%E8%B8%A9%E5%9D%91%E5%85%A8%E5%BD%95%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://charlesblog.site/2017/12/09/Jenkins 100次构建失败踩坑全录（一）/</id>
    <published>2017-12-09T12:53:00.000Z</published>
    <updated>2018-05-07T02:17:42.729Z</updated>
    
    <content type="html"><![CDATA[<p>本文将以问题与解决方案的方式对Jenkins构建过程中的问题进行收录，后期会在评论中持续收集，如果有相同情况，请自行对照解决；<br><a id="more"></a></p><p>本文参考：<br>手把手教你利用Jenkins持续集成iOS项目<br><a href="http://www.jianshu.com/p/41ecb06ae95f" target="_blank" rel="noopener">http://www.jianshu.com/p/41ecb06ae95f</a><br>关于iOS-Jenkins进行持续集成项目部署<br><a href="http://www.jianshu.com/p/54c7daae6c94" target="_blank" rel="noopener">http://www.jianshu.com/p/54c7daae6c94</a><br>iOS持续集成：Jenkins篇<br><a href="http://www.jianshu.com/p/faf879b3d182" target="_blank" rel="noopener">http://www.jianshu.com/p/faf879b3d182</a></p><h2 id="关卡1-："><a href="#关卡1-：" class="headerlink" title="关卡1 ："></a>关卡1 ：</h2><p>安装Jenkins：首先你的电脑得有一个Java环境，接下来安装Jenkins。你可以直接去<a href="https://jenkins.io" target="_blank" rel="noopener">Jenkins入口</a>网站，查看安装方式；<br>当然你也可以使用以下方法：</p><ul><li><p>安装homebrew</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ruby -e <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span></span><br></pre></td></tr></table></figure></li><li><p>安装jenkins</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span><span class="keyword">install </span><span class="keyword">jenkins</span></span><br></pre></td></tr></table></figure></li></ul><p>安装成功后需要开启jenkins服务；</p><h2 id="关卡2-："><a href="#关卡2-：" class="headerlink" title="关卡2 ："></a>关卡2 ：</h2><p>开启Jenkins服务：确认jenkins已安装，在终端进入到jenkins安装目录下，会有一个叫做jenkins.war的文件，<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">java </span>-<span class="keyword">jar </span><span class="keyword">jenkins.war</span></span><br></pre></td></tr></table></figure></p><p>或者在终端输入：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jenkins</span></span><br></pre></td></tr></table></figure></p><p>当出现：<br><img src="http://static.zybuluo.com/usiege/uowhxmph61xngu3l2t4hxamh/image_1c0ptnl2j13mh1mn2hmk18qf7usp.png" alt="image_1c0ptnl2j13mh1mn2hmk18qf7usp.png-188.1kB"></p><p>服务已经就位，可以开始进行配置了；</p><p>这里还有两个命令用于jenkins开启和停用（Mac上）：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo launchctl load /Library/LaunchDaemons/org<span class="selector-class">.jenkins-ci</span><span class="selector-class">.plist</span></span><br><span class="line">$ sudo launchctl unload /Library/LaunchDaemons/org<span class="selector-class">.jenkins-ci</span><span class="selector-class">.plist</span></span><br></pre></td></tr></table></figure></p><p>如果是linux上也可以这样：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl status jenkins.service</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo systemctl start jenkins.service</span></span><br></pre></td></tr></table></figure></p><p>不过实际操作过程中，可能会出现停用失败的情况，我的做法是直接打开活动监视器，在里面搜java服务，强制关闭掉；这里需要注意，如果服务没有停止再进行jenkins开启是不成功的，提示会告诉你已经在用：</p><p><img src="http://static.zybuluo.com/usiege/s46xl40yzd7t5gijpwdippc9/image_1c0pu09in491qq31bqs25f1hbg26.png" alt="image_1c0pu09in491qq31bqs25f1hbg26.png-222.9kB"></p><p>如果你想查看是否jenkins在运行，使用命令查看：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ps aux | grep jenkins</span></span><br></pre></td></tr></table></figure></p><h2 id="关卡3-："><a href="#关卡3-：" class="headerlink" title="关卡3 ："></a>关卡3 ：</h2><p>安装并开启完成就可以在浏览器里输入<a href="localhost:8080" target="_blank" rel="noopener">localhost:8080</a>进行页面化配置了；<br>安装完成之后，Safari可能会自动打开，如果没有自动打开，打开浏览器，输入<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a><br><img src="http://static.zybuluo.com/usiege/fn2f1wx006r3chny2t5u9atc/image_1c0pvjgjqfbg3i01c371uhc1ves2j.png" alt="image_1c0pvjgjqfbg3i01c371uhc1ves2j.png-27.6kB"></p><p>这个时候可能会报一个错误。如果出现了这面的问题。出现这个问题的原因就是Java环境有问题，重启Java环境即可。</p><p>这个时候如果你重启电脑会发现Jenkins给你新增了一个用户，名字就叫Jenkins，不过这个时候你不知道密码。你可能会去试密码，肯定是是不对的，因为初始密码很复杂。这个时候正确做法是打开<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> 会出现下图的重设初始密码的界面。</p><p><img src="http://static.zybuluo.com/usiege/sfnjgdq201o27xta3ttqllkr/image_1c0pvl71n5dulcc413164i1hcp30.png" alt="image_1c0pvl71n5dulcc413164i1hcp30.png-30.4kB"></p><p>按照提示，找到/Users/Shared/Jenkins/Home/ 这个目录下，这个目录虽然是共享目录，但是有权限的，非Jenkins用户/secrets/目录是没有读写权限的。</p><p><img src="http://static.zybuluo.com/usiege/ltc8z86hbmzy78857uo767zr/image_1c0pvm8al1tce1iled5voi216ac3d.png" alt="image_1c0pvm8al1tce1iled5voi216ac3d.png-200.2kB"></p><p>打开initialAdminPassword文件，复制出密码，就可以填到网页上去重置密码了。如下图</p><p><img src="http://static.zybuluo.com/usiege/ub5cnhcl82hyed8j8aqghlna/image_1c0pvp2p01fon1h2mmvjs6s1fuj3q.png" alt="image_1c0pvp2p01fon1h2mmvjs6s1fuj3q.png-99.6kB"></p><p>一路安装过来，输入用户名，密码，邮件这些，就算安装完成了。</p><p>还是继续登录localhost:8080</p><p>然而这一关还没有结束：<br>写blog的时候我把自己设置的帐号注销了，然而当时设置的密码却忘记了，怎么都想不起来，怎么办呢？<br>首先我想能不能用之前给的Jenkins帐户呢，经试错，未果；<br>接下来上百度查了几种方法，有的方法很复杂，不打算用，我们只用最简单粗暴的；只要之前的帐号信息没有丢失，又可以进入系统就OK了，于是：</p><p><img src="http://static.zybuluo.com/usiege/ihh8n31m9fb1r9gomahd7l6d/image_1c0q0bnonde9a9omqa1092a1747.png" alt="image_1c0q0bnonde9a9omqa1092a1747.png-85.9kB"></p><p>注意实际操作过程中发现不是<code>/User/Shared/Jenkins/Home</code>下的config.xml，也不是<code>/User/Shared/Jenkins/Home/users</code>下的config.xml，而是<strong>你自己用户目录</strong><code>~/.jenkins/</code>下的config.xml，具体原因可能是jenkins运行的工作空间是当前用户目录下的<code>.jenkins</code>，然后就是这样：</p><p><img src="http://static.zybuluo.com/usiege/rmn1oao4inl6rvryb8ne596c/image_1c0q277tu152r9mg1dhg1edq8jp5q.png" alt="image_1c0q277tu152r9mg1dhg1edq8jp5q.png-55.9kB"></p><p>经检验，无误，可进入，但是好像遗留了一个问题，就是这样进入的话就找不到管理用户的选项了；解决问题，勾选图中黄色圈，返回系统管理，出现管理用户（还是个隐藏道具）；<br><img src="http://static.zybuluo.com/usiege/v5zxzwu4pex59s78odynkkd6/image_1c0q3ukis1vlhib71uij1729ohs67.png" alt="image_1c0q3ukis1vlhib71uij1729ohs67.png-33.1kB"></p><p><img src="http://static.zybuluo.com/usiege/bxyfaeid922e3lf7dvuz9mh8/image_1c0q419b0164pqfe25d9br1fpt74.png" alt="image_1c0q419b0164pqfe25d9br1fpt74.png-39.8kB"></p><p><img src="http://static.zybuluo.com/usiege/burf10v126vjx00u2ym0h2bn/image_1c0q42m3mvf41d8fjs21ptb1ae77h.png" alt="image_1c0q42m3mvf41d8fjs21ptb1ae77h.png-11.4kB"></p><p>搞的像是特工登录非授权帐户一样，不管怎么说，总算是攻破了，进入下一关；</p><h2 id="关卡-4："><a href="#关卡-4：" class="headerlink" title="关卡 4："></a>关卡 4：</h2><p>先不管工程构建里那一堆设置，我们先来搞一下证书Cer，钥匙Keychain，配置文件Provisioning Profiles的一些问题：<br>首先去系统管理 -&gt; 管理插件 -&gt; 可选插件，搜索并安装Keychains and Provisioning Profiles Management插件；<br>进入插件：<br><img src="http://static.zybuluo.com/usiege/kgy8eq7ug16g0o1o4eotp3bw/image_1c0qeblep1tcj4m319ap1bek783ah.png" alt="image_1c0qeblep1tcj4m319ap1bek783ah.png-31.1kB"></p><p>不要关键去填下面的空，我会告诉你这是一道有选项的题目；进入文件目录，<code>Command + shift + G</code>，写下这样的路径<code>~/资源库/Keychains</code>，</p><p><img src="http://static.zybuluo.com/usiege/ebpz8l8bnnvlrr6oi3a0423h/image_1c0qekdqp9v712rd1gefjdr1fdcbe.png" alt="image_1c0qekdqp9v712rd1gefjdr1fdcbe.png-62.2kB"></p><p>这里我们把login.keychain-db上传到Jenkins里，但是Upload并不能上传这样后缀的文件，所以需要你手动把login.keychain-db修改成login.keychain（复制后再修改，以防止其他地方会引用到带-db）；上传完成后就会在下面出现你一些信息；然后打开你的钥匙串，这个知道在什么地方吧；</p><p><img src="http://static.zybuluo.com/usiege/w9l7f921rn6he0vx1vcqmu6a/image_1c0qet898q8m118mk2s6kj1cq5eb.png" alt="image_1c0qet898q8m118mk2s6kj1cq5eb.png-131kB"></p><p>点击打包所用到的证书，将红色框中的名称复制出来，添加到identities中；</p><p><img src="http://static.zybuluo.com/usiege/zc1wu103t1woz01fp07s80b7/image_1c0qf02rofnpc3r121c1nlb1mqteo.png" alt="image_1c0qf02rofnpc3r121c1nlb1mqteo.png-42.7kB"></p><p>如果有多个，则点击Add Code Signing Identity添加；</p><p>然后是PP文件，这些文件需要我们从系统PP文件夹下复制到Jenkins资源文件夹下，如下图两个路径：<br>这个是系统PP文件目录<br><img src="http://static.zybuluo.com/usiege/peonwampxc6wa9h3i2yuhfm5/image_1c0qkdte41j1rgq81k8v1bi19f4f5.png" alt="image_1c0qkdte41j1rgq81k8v1bi19f4f5.png-144.2kB"><br>这个是Jenkins PP文件目录<br><img src="http://static.zybuluo.com/usiege/v0firte6p13gwec9a133ixi1/image_1c0qkkk833p0nt18andthn9qfi.png" alt="image_1c0qkkk833p0nt18andthn9qfi.png-79.2kB"></p><p>Provisioning Profiles Directory Path 填写成，注意替换为自己的username：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/User/</span>&#123;USERNAME&#125;<span class="regexp">/Library/</span>MobileDevice<span class="regexp">/Provisioning Profiles</span></span><br></pre></td></tr></table></figure><p>接着去你苹果帐号里去找你对应打包所需要的PP文件，然后点upload上传到Jenkins环境里；<br>以上，证书部分解决；</p><h2 id="关卡-5"><a href="#关卡-5" class="headerlink" title="关卡 5"></a>关卡 5</h2><p>创建项目过程我们会对各个需要的项进行逐个描述：<br>点新建项目，输入项目名称，选择 构建一个自由风格的软件项目，然后确定，进入配置页面。<br><img src="http://static.zybuluo.com/usiege/1ytel52lwidafke7uv5rmgb0/image_1c0ql3ppk1bht1b5ms4hcui1jpjfv.png" alt="image_1c0ql3ppk1bht1b5ms4hcui1jpjfv.png-8.2kB"></p><ul><li>General<br>这个部分的内容都很浅显，没有什么可以说的，根据需要自行填充；这里说一下GitLab connection选项，因为我自己的工程是用gitlab管理的代码，所以需要在Jenkins里下一个Gitlab的插件，然后在里面进行帐号配置，可以采用帐号密码以及SSH的方式，具体这个部分会有一个SSH的坑，先不作分析，后面会讲到，我这里先用帐号密码的方式进行构建，经检验发现SSH方式非必要；</li></ul><p><strong>Credentials</strong>在这里配置：<br><img src="http://static.zybuluo.com/usiege/f6pv0rsip2oirn32m01agp1l/image_1c0qljaq610ljc02k6g1r821fs5gc.png" alt="image_1c0qljaq610ljc02k6g1r821fs5gc.png-78.2kB"></p><ul><li>源码管理<br>这里我选的Git，<strong>Repository URL</strong>填你工程的git地址，选用帐号密码的形式应该是以http或https开头的，<strong>Credentials</strong>填你在上一步中新建好的，<br><img src="http://static.zybuluo.com/usiege/bzufeuzktht55r97i2bsem18/image_1c0qlt20313duogl2g51hp11nqsgp.png" alt="image_1c0qlt20313duogl2g51hp11nqsgp.png-73kB"><br><strong>Branch Specifier (blank for ‘any’)</strong>    填你要进行构建的分支，我这里是<code>*/release</code>；</li></ul><p>这里我们PS一个隐藏BOSS：<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">returned status code 143 jenkins</span><br><span class="line"><span class="keyword">ERROR: </span>Error fetching remote repo ‘origin’</span><br></pre></td></tr></table></figure></p><p>这个报错是工程配置结束后进行构建后提示的，我当时搞这个发现远程代码明明是已经拉取到本地的，只是在拉取过程中会发生中断，本人在进行了将近50次试错后发现这个拉取到本地的代码率是变化的，先前以为是SSH帐号的问题，于是转头花了一天的时间搞了下SSH，后来SSH搞通后发现该问题仍然存在，后来终于在经历百度，谷歌，搜狗也用上的（不得不说有时候百度搜不出来的搜狗能搜到），发现了几篇有用的，后来解决，也算是不负辛苦，后面有踩坑的伙伴多注意，前车之鉴后事之师；</p><p><a href="http://blog.sina.com.cn/s/blog_72ef7bea0102vo9w.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_72ef7bea0102vo9w.html</a><br><a href="https://issues.jenkins-ci.org/browse/JENKINS-20445" target="_blank" rel="noopener">https://issues.jenkins-ci.org/browse/JENKINS-20445</a><br><a href="https://stackoverflow.com/questions/35069079/jenkins-git-plugin-timeout-when-try-to-pull-repositoty-using-ssh" target="_blank" rel="noopener">https://stackoverflow.com/questions/35069079/jenkins-git-plugin-timeout-when-try-to-pull-repositoty-using-ssh</a></p><p>解决方案就在于这个<strong>Timeout</strong>，相信你看了这个单词就知道是怎么回事了：<br><img src="http://static.zybuluo.com/usiege/firl86lawiru1uvz1jhelb28/image_1c0qmnlafh2p1j571b4ettv1ncah6.png" alt="image_1c0qmnlafh2p1j571b4ettv1ncah6.png-74.3kB"></p><p>另顺便粘一个code 128的链接，是个与该问题相关的问题，因为这些问题关键字有的重复，所以搜出来的文章有时会误导，所以请仔细辨别：<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">returned status code 128 jenkins</span><br><span class="line"><span class="keyword">ERROR: </span>Error cloning remote repo 'origin'</span><br><span class="line">stderr: Permission denied (publickey).</span><br></pre></td></tr></table></figure></p><p><a href="http://wantcoding.com/?p=293" target="_blank" rel="noopener">http://wantcoding.com/?p=293</a><br><a href="http://www.cnblogs.com/EasonJim/p/6266892.html" target="_blank" rel="noopener">这个链接是附送的，进去多看看你会有惊喜，还有QQ群哦</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本文将以问题与解决方案的方式对Jenkins构建过程中的问题进行收录，后期会在评论中持续收集，如果有相同情况，请自行对照解决；&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="jenkins" scheme="http://charlesblog.site/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>记一次iOS上线提审</title>
    <link href="http://charlesblog.site/2017/12/07/%E8%AE%B0%E4%B8%80%E6%AC%A1iOS%E4%B8%8A%E7%BA%BF%E6%8F%90%E5%AE%A1/"/>
    <id>http://charlesblog.site/2017/12/07/记一次iOS上线提审/</id>
    <published>2017-12-07T09:50:00.000Z</published>
    <updated>2018-05-07T02:17:42.738Z</updated>
    
    <content type="html"><![CDATA[<p>公司最近的一次App提交过程中遇到的一些问题，现贴在这里，有检索到本篇的朋友们可借鉴。</p><a id="more"></a><p>首先是上传到iTunes Connect构建版本，点击以下蓝色按钮，之后会有苹果为你的代码进行检查：</p><p><img src="http://static.zybuluo.com/usiege/n72bt0t4wwh45zw5c0kjcv01/image_1bu7k3nt22m3cmearq636qua9.png" alt="image_1bu7k3nt22m3cmearq636qua9.png-14.8kB"></p><p>本人在ios11上做了提交，发现问题进行分类：</p><ol><li>第一个是第三方库存在x86_64,i386的链接库，有以下问题：</li></ol><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90087</span>: "Unsupported Architectures. The executable for LeWaiJiao.app/Frameworks/GCDWebServers.framework contains unsupported architectures '[x86_64, i386]'."</span><br></pre></td></tr></table></figure><p>PS:以下所有翻译来源于欧路词典，粘贴过来的，仅供参考；<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90209</span>: "Invalid Segment Alignment. The app binary at 'LeWaiJiao.app/Frameworks/GCDWebServers.framework/GCDWebServers' does not have proper segment alignment. Try rebuilding the app with the latest Xcode version."</span><br><span class="line">无效段对齐。应用程序二进制的“lewaijiao。应用程序/框架/ gcdwebservers。框架/ gcdwebservers”没有正确对齐。尝试用新的Xcode版本重建应用程序。</span><br></pre></td></tr></table></figure></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">ERROR ITMS-90125: "The binary is invalid. The encryption info in the LC_ENCRYPTION_INFO <span class="keyword">load</span> command <span class="keyword">is</span> either <span class="keyword">missing</span> <span class="keyword">or</span> invalid, <span class="keyword">or</span> the <span class="built_in">binary</span> <span class="keyword">is</span> already encrypted. This <span class="built_in">binary</span> does <span class="keyword">not</span> seem <span class="keyword">to</span> have been built <span class="keyword">with</span> Apple<span class="string">'s linker."</span></span><br><span class="line"><span class="string">“二进制无效。在lc_encryption_info负荷指令加密信息丢失或无效，或是已经加密的二进制。这个二进制文件似乎没有用苹果的链接器构建。”</span></span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">WARNING ITMS-90080: "The executable 'Payload/LeWaiJiao.app/Frameworks/GCDWebServers.framework' is not a Position Independent Executable. Please ensure that your <span class="keyword">build</span> settings are configured <span class="keyword">to</span> <span class="keyword">create</span> PIE executables. <span class="keyword">For</span> more information refer <span class="keyword">to</span> Technical Q&amp;A QA1788 - Building a <span class="built_in">Position</span> Independent Executable <span class="keyword">in</span> the iOS Developer Library.<span class="string">"</span></span><br><span class="line"><span class="string">“可执行的有效载荷/ lewaijiao。应用程序/框架/ gcdwebservers。框架”不是一个独立的可执行文件的位置。请确保您的构建设置配置为创建饼可执行文件。更多信息请参阅技术问答qa1788在iOS开发者库位置独立的可执行的建筑。”</span></span><br></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90362</span>: "Invalid Info.plist value. The value for the key 'MinimumOSVersion' in bundle ***.app/Frameworks/SDK.framework is invalid. The minimum value is 8.0"</span><br></pre></td></tr></table></figure><p>后面这个<strong>90362</strong>貌似是连带问题，定位的时候发现与最小版本无关，所以一同被解决了；</p><p>解决方法呢是在该工程里添加脚本处理这些被添加进来的第三方库，如下：<br><img src="http://static.zybuluo.com/usiege/mqh6ttzi6hsixpddv5nmcu03/image_1bu7kmq06140t1nmhkf11sfq1civm.png" alt="image_1bu7kmq06140t1nmhkf11sfq1civm.png-235.5kB"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">APP_PATH=<span class="string">"<span class="variable">$&#123;TARGET_BUILD_DIR&#125;</span>/<span class="variable">$&#123;WRAPPER_NAME&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script loops through the frameworks embedded in the application and</span></span><br><span class="line"><span class="comment"># removes unused architectures.</span></span><br><span class="line">find <span class="string">"<span class="variable">$APP_PATH</span>"</span> -name <span class="string">'*.framework'</span> -<span class="built_in">type</span> d | <span class="keyword">while</span> <span class="built_in">read</span> -r FRAMEWORK</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">FRAMEWORK_EXECUTABLE_NAME=$(defaults <span class="built_in">read</span> <span class="string">"<span class="variable">$FRAMEWORK</span>/Info.plist"</span> CFBundleExecutable)</span><br><span class="line">FRAMEWORK_EXECUTABLE_PATH=<span class="string">"<span class="variable">$FRAMEWORK</span>/<span class="variable">$FRAMEWORK_EXECUTABLE_NAME</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Executable is <span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span></span><br><span class="line"></span><br><span class="line">EXTRACTED_ARCHS=()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ARCH <span class="keyword">in</span> <span class="variable">$ARCHS</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Extracting <span class="variable">$ARCH</span> from <span class="variable">$FRAMEWORK_EXECUTABLE_NAME</span>"</span></span><br><span class="line">lipo -extract <span class="string">"<span class="variable">$ARCH</span>"</span> <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span> -o <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-<span class="variable">$ARCH</span>"</span></span><br><span class="line">EXTRACTED_ARCHS+=(<span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-<span class="variable">$ARCH</span>"</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Merging extracted architectures: <span class="variable">$&#123;ARCHS&#125;</span>"</span></span><br><span class="line">lipo -o <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-merged"</span> -create <span class="string">"<span class="variable">$&#123;EXTRACTED_ARCHS[@]&#125;</span>"</span></span><br><span class="line">rm <span class="string">"<span class="variable">$&#123;EXTRACTED_ARCHS[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Replacing original executable with thinned version"</span></span><br><span class="line">rm <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span></span><br><span class="line">mv <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-merged"</span> <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p><p>以上代码来源于Google，解决方法经确认iOS11 + Xcode9.0有效；</p><ol start="2"><li>项目有icon不合规定的错误<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90717</span>: "Invalid App Store Icon. The App Store Icon in the asset catalog in 'LeWaiJiao.app' can't be transparent nor contain an alpha channel."</span><br><span class="line">无效应用程序商店图标。在资产目录中的lewaijiao App Store图标，应用程序不能透明也包含alpha通道。”</span><br></pre></td></tr></table></figure></li></ol><p>该错误原因是上传的icon不符合苹果规定，公司项目存在的问题是1.使用了圆角；2.有透明alpha通道；<br>解决方法自然容易了，找设计重新做，自己解决的话第二个可以DIY，如下：</p><p><img src="http://static.zybuluo.com/usiege/xtde6py269a5m4iusbumms4p/image_1bu7l6vhrvhm51b13pjvrlc0p13.png" alt="image_1bu7l6vhrvhm51b13pjvrlc0p13.png-100.4kB"></p><p>用系统预览打开icon图片，点掉Alpha的勾，再保存就可以了；<br><img src="http://static.zybuluo.com/usiege/yql5tndy4d612fhqfsi9n4l2/image_1bu7l8bt61p6v1mp11csi15ri1dmg1g.png" alt="image_1bu7l8bt61p6v1mp11csi15ri1dmg1g.png-128.6kB"></p><ol start="3"><li>提交上传结束后又出现了一个问题</li></ol><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">App</span> Installation failed, <span class="keyword">No</span> code signature found.</span><br></pre></td></tr></table></figure><p>真机无法运行了！这个问题纯属偶然，所以继续解决；打开终端，输入</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R <span class="number">777</span> <span class="regexp">/Applications/</span>Xcode.app<span class="regexp">/Contents/</span>Developer<span class="regexp">/Platforms/i</span>PhoneOS.platform<span class="regexp">/Developer/</span>SDKs<span class="regexp">/iPhoneOS.sdk</span></span><br></pre></td></tr></table></figure><p>修改文件权限，然后修改字段属性，打开：</p><p><strong>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/SDKSettings.plist</strong></p><p>，修改 <strong>CODE_SIGNING_REQUIRED</strong> 字段为 <strong>YES</strong> ，保存；</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;公司最近的一次App提交过程中遇到的一些问题，现贴在这里，有检索到本篇的朋友们可借鉴。&lt;/p&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="iOS" scheme="http://charlesblog.site/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title>Python-django安装</title>
    <link href="http://charlesblog.site/2017/10/25/Python-django%E5%AE%89%E8%A3%85/"/>
    <id>http://charlesblog.site/2017/10/25/Python-django安装/</id>
    <published>2017-10-25T11:56:00.000Z</published>
    <updated>2018-05-07T02:17:42.731Z</updated>
    
    <content type="html"><![CDATA[<p>django<br><a id="more"></a></p><ol><li><p>发现错误<br><img src="http://static.zybuluo.com/usiege/tvcs5iet0ge1yypcquu2swdq/image_1bt9d9b27bv5glj1a0m15hr1ncn9.png" alt="image_1bt9d9b27bv5glj1a0m15hr1ncn9.png-258.7kB"><br>怀疑是pip版本的问题；</p></li><li><p>于是查了下更新pip的方法： </p></li></ol><p>查看pip版本<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip -<span class="built_in">version</span></span><br></pre></td></tr></table></figure></p><p>升级方法<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> -U pip</span><br></pre></td></tr></table></figure></p><p>如果pip出现有问题，或者你花了很长的时间想用pip安装，例如使用下面这种方式：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Django==<span class="number">1.8</span><span class="number">.16</span></span><br></pre></td></tr></table></figure></p><p>如果你刚好安装成功，那么恭喜你；如果不是，那么我们就要使用另外一种方法； </p><ol start="3"><li>下载安装</li></ol><p><a href="https://github.com/django/django/archive/master.tar.gz" target="_blank" rel="noopener">gzip压缩包</a></p><p>或者：<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/django/django.git</span><br></pre></td></tr></table></figure></p><p>下载完成之后：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf django-master<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">cd django-master</span><br><span class="line">python setup<span class="selector-class">.py</span> install</span><br></pre></td></tr></table></figure></p><p>会出现下面的问题：<br><img src="http://static.zybuluo.com/usiege/skgzjd12wfs2u973aidsrk7o/image_1bt9ib15m8juqh01adb1hlb154k9.png" alt="image_1bt9ib15m8juqh01adb1hlb154k9.png-97.5kB"><br>继续找：<br>Because you’re trying to install it on Python2, but the latest version of Django requires Python 3;<br>所以使用安装方法：<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 <span class="keyword">install</span> -e django</span><br></pre></td></tr></table></figure></p><p>这个仍然是联网安装，但是貌似<code>pytz</code>并不能连接上，vpn也不行；<br>所以:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> django</span><br><span class="line"><span class="keyword">python3</span> setup.<span class="keyword">py</span> install</span><br></pre></td></tr></table></figure></p><p>终于，你的django完成了；</p><p>续：<br>隔天使用以上的所有方法均可以，可能是十九大开会期间被墙掉了吧。<br><img src="http://static.zybuluo.com/usiege/06h0phv3szekmv2l4x2cmurb/image_1btbid9ijfnd1q2i15npd78l9p9.png" alt="image_1btbid9ijfnd1q2i15npd78l9p9.png-253.6kB"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;django&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="python" scheme="http://charlesblog.site/tags/python/"/>
    
      <category term="django" scheme="http://charlesblog.site/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>你的pod不工作了吗？</title>
    <link href="http://charlesblog.site/2017/10/17/%E4%BD%A0%E7%9A%84pod%E4%B8%8D%E5%B7%A5%E4%BD%9C%E4%BA%86%E5%90%97%EF%BC%9F/"/>
    <id>http://charlesblog.site/2017/10/17/你的pod不工作了吗？/</id>
    <published>2017-10-17T03:03:00.000Z</published>
    <updated>2018-05-07T02:17:42.735Z</updated>
    
    <content type="html"><![CDATA[<p>最近公司的项目需要添加几个依赖库，用pod更新的时候发现一直卡在了<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Setting up CocoaPods <span class="keyword">master</span> <span class="title">repo</span></span><br></pre></td></tr></table></figure></p><a id="more"></a><p>继而是漫长的等待，在这个期间我不知道它发生了什么。</p><p>在这种等待中，程序员一般会选择做一些别的事情。于是我上网验证了一下我的行为，结论告诉我：</p><p>1.我要开个VPN；</p><p>2.我需要重新安装一下pod，因为它已经不工作了；</p><p>首先要先检查一下ruby源：</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gem sources -l</span></span><br></pre></td></tr></table></figure><p>返回的结果是<a href="https://rubygems.org/，如果你在网上找到过其他源并且修改过它，并且你不确定你的源是否可以使用的话，那么请修改回来，买个VPN，这会让你节省很多不必要的劳动，你可以用以下代码修改源：" target="_blank" rel="noopener">https://rubygems.org/，如果你在网上找到过其他源并且修改过它，并且你不确定你的源是否可以使用的话，那么请修改回来，买个VPN，这会让你节省很多不必要的劳动，你可以用以下代码修改源：</a></p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#移除旧源</span></span><br><span class="line">gem sources <span class="comment">--remove 旧源址</span></span><br><span class="line"><span class="comment">#添加新源</span></span><br><span class="line">gem sources -<span class="keyword">a</span> <span class="keyword">https</span>://rubygems.org/</span><br></pre></td></tr></table></figure><p>PS:请确保你的源可用！！！</p><p>接着如果你没有安装pod，请执行：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem <span class="keyword">install</span> cocoapods</span><br></pre></td></tr></table></figure><p>如果你已经安装pod，请执行：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod <span class="built_in">setup</span></span><br></pre></td></tr></table></figure><p>这个操作结束之后，又重现了一个漫长的等待过程，那么我们要清楚它是否在认真工作，请打开另外一个终端，我们要检查一下进度：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入到pod目录</span></span><br><span class="line"><span class="keyword">cd</span> ~<span class="string">/.cocoapods</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#检查当前文件下所有文件的大小，此后如果你不放心，可以分时段检查一下</span></span><br><span class="line">du -sh *</span><br></pre></td></tr></table></figure><p>这个过程会很漫长，取决于你VPN的速度，最后我这边出结果会反馈绿色的文字，Setup completed!文件总大小是1.2G，所以还是耐心的等待吧。。。</p><p>另外还有一点，如果上述<code>pod setup</code>出现红色的错误信息，也有可能是gem没有到最新版本，那么你还需要用你的VPN更新一下gem到最新；<br><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gem <span class="keyword">update</span> --<span class="keyword">system</span></span><br></pre></td></tr></table></figure></p><p>PS:顺便记一下寻找库代码<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pod search AFNetworking</span></span><br></pre></td></tr></table></figure></p><p>这个时候会遇到这样的提示：<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[!] Unable <span class="keyword">to</span> <span class="built_in">find</span> a pod <span class="keyword">with</span> <span class="built_in">name</span>, author, summary, <span class="built_in">or</span> descriptionmatching `AFNetworking`</span><br></pre></td></tr></table></figure></p><p>你需要做如下操作，再进行搜索：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm ~<span class="regexp">/Library/</span>Caches<span class="regexp">/CocoaPods/</span>search_index.json</span><br></pre></td></tr></table></figure></p><p>最后你将如愿以偿，感谢亲人：<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">Creating</span></span> search index <span class="keyword">for</span> spec repo <span class="string">'master'</span>.. Done!</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近公司的项目需要添加几个依赖库，用pod更新的时候发现一直卡在了&lt;br&gt;&lt;figure class=&quot;highlight crmsh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Setting up CocoaPods &lt;span class=&quot;keyword&quot;&gt;master&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;repo&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="CocaoPods" scheme="http://charlesblog.site/tags/CocaoPods/"/>
    
  </entry>
  
  <entry>
    <title>git checkout 与 reset</title>
    <link href="http://charlesblog.site/2017/08/18/git%20checkout%20%E4%B8%8E%20reset/"/>
    <id>http://charlesblog.site/2017/08/18/git checkout 与 reset/</id>
    <published>2017-08-18T09:34:00.000Z</published>
    <updated>2018-05-07T02:17:42.733Z</updated>
    
    <content type="html"><![CDATA[<p>公司最近的一次App提交过程中遇到的一些问题，现贴在这里，有检索到本篇的朋友们可借鉴。<br><a id="more"></a></p><p>首先是上传到iTunes Connect构建版本，点击以下蓝色按钮，之后会有苹果为你的代码进行检查：</p><p><img src="http://static.zybuluo.com/usiege/n72bt0t4wwh45zw5c0kjcv01/image_1bu7k3nt22m3cmearq636qua9.png" alt="image_1bu7k3nt22m3cmearq636qua9.png-14.8kB"></p><p>本人在ios11上做了提交，发现问题进行分类：</p><ol><li>第一个是第三方库存在x86_64,i386的链接库，有以下问题：</li></ol><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90087</span>: "Unsupported Architectures. The executable for LeWaiJiao.app/Frameworks/GCDWebServers.framework contains unsupported architectures '[x86_64, i386]'."</span><br></pre></td></tr></table></figure><p>PS:以下所有翻译来源于欧路词典，粘贴过来的，仅供参考；<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90209</span>: "Invalid Segment Alignment. The app binary at 'LeWaiJiao.app/Frameworks/GCDWebServers.framework/GCDWebServers' does not have proper segment alignment. Try rebuilding the app with the latest Xcode version."</span><br><span class="line">无效段对齐。应用程序二进制的“lewaijiao。应用程序/框架/ gcdwebservers。框架/ gcdwebservers”没有正确对齐。尝试用新的Xcode版本重建应用程序。</span><br></pre></td></tr></table></figure></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">ERROR ITMS-90125: "The binary is invalid. The encryption info in the LC_ENCRYPTION_INFO <span class="keyword">load</span> command <span class="keyword">is</span> either <span class="keyword">missing</span> <span class="keyword">or</span> invalid, <span class="keyword">or</span> the <span class="built_in">binary</span> <span class="keyword">is</span> already encrypted. This <span class="built_in">binary</span> does <span class="keyword">not</span> seem <span class="keyword">to</span> have been built <span class="keyword">with</span> Apple<span class="string">'s linker."</span></span><br><span class="line"><span class="string">“二进制无效。在lc_encryption_info负荷指令加密信息丢失或无效，或是已经加密的二进制。这个二进制文件似乎没有用苹果的链接器构建。”</span></span><br></pre></td></tr></table></figure><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">WARNING ITMS-90080: "The executable 'Payload/LeWaiJiao.app/Frameworks/GCDWebServers.framework' is not a Position Independent Executable. Please ensure that your <span class="keyword">build</span> settings are configured <span class="keyword">to</span> <span class="keyword">create</span> PIE executables. <span class="keyword">For</span> more information refer <span class="keyword">to</span> Technical Q&amp;A QA1788 - Building a <span class="built_in">Position</span> Independent Executable <span class="keyword">in</span> the iOS Developer Library.<span class="string">"</span></span><br><span class="line"><span class="string">“可执行的有效载荷/ lewaijiao。应用程序/框架/ gcdwebservers。框架”不是一个独立的可执行文件的位置。请确保您的构建设置配置为创建饼可执行文件。更多信息请参阅技术问答qa1788在iOS开发者库位置独立的可执行的建筑。”</span></span><br></pre></td></tr></table></figure><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90362</span>: "Invalid Info.plist value. The value for the key 'MinimumOSVersion' in bundle ***.app/Frameworks/SDK.framework is invalid. The minimum value is 8.0"</span><br></pre></td></tr></table></figure><p>后面这个<strong>90362</strong>貌似是连带问题，定位的时候发现与最小版本无关，所以一同被解决了；</p><p>解决方法呢是在该工程里添加脚本处理这些被添加进来的第三方库，如下：<br><img src="http://static.zybuluo.com/usiege/mqh6ttzi6hsixpddv5nmcu03/image_1bu7kmq06140t1nmhkf11sfq1civm.png" alt="image_1bu7kmq06140t1nmhkf11sfq1civm.png-235.5kB"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">APP_PATH=<span class="string">"<span class="variable">$&#123;TARGET_BUILD_DIR&#125;</span>/<span class="variable">$&#123;WRAPPER_NAME&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This script loops through the frameworks embedded in the application and</span></span><br><span class="line"><span class="comment"># removes unused architectures.</span></span><br><span class="line">find <span class="string">"<span class="variable">$APP_PATH</span>"</span> -name <span class="string">'*.framework'</span> -<span class="built_in">type</span> d | <span class="keyword">while</span> <span class="built_in">read</span> -r FRAMEWORK</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">FRAMEWORK_EXECUTABLE_NAME=$(defaults <span class="built_in">read</span> <span class="string">"<span class="variable">$FRAMEWORK</span>/Info.plist"</span> CFBundleExecutable)</span><br><span class="line">FRAMEWORK_EXECUTABLE_PATH=<span class="string">"<span class="variable">$FRAMEWORK</span>/<span class="variable">$FRAMEWORK_EXECUTABLE_NAME</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Executable is <span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span></span><br><span class="line"></span><br><span class="line">EXTRACTED_ARCHS=()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ARCH <span class="keyword">in</span> <span class="variable">$ARCHS</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Extracting <span class="variable">$ARCH</span> from <span class="variable">$FRAMEWORK_EXECUTABLE_NAME</span>"</span></span><br><span class="line">lipo -extract <span class="string">"<span class="variable">$ARCH</span>"</span> <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span> -o <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-<span class="variable">$ARCH</span>"</span></span><br><span class="line">EXTRACTED_ARCHS+=(<span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-<span class="variable">$ARCH</span>"</span>)</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Merging extracted architectures: <span class="variable">$&#123;ARCHS&#125;</span>"</span></span><br><span class="line">lipo -o <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-merged"</span> -create <span class="string">"<span class="variable">$&#123;EXTRACTED_ARCHS[@]&#125;</span>"</span></span><br><span class="line">rm <span class="string">"<span class="variable">$&#123;EXTRACTED_ARCHS[@]&#125;</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Replacing original executable with thinned version"</span></span><br><span class="line">rm <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span></span><br><span class="line">mv <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>-merged"</span> <span class="string">"<span class="variable">$FRAMEWORK_EXECUTABLE_PATH</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></p><p>以上代码来源于Google，解决方法经确认iOS11 + Xcode9.0有效；</p><ol start="2"><li>项目有icon不合规定的错误<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line"><span class="keyword">ERROR </span>ITMS<span class="string">-90717</span>: "Invalid App Store Icon. The App Store Icon in the asset catalog in 'LeWaiJiao.app' can't be transparent nor contain an alpha channel."</span><br><span class="line">无效应用程序商店图标。在资产目录中的lewaijiao App Store图标，应用程序不能透明也包含alpha通道。”</span><br></pre></td></tr></table></figure></li></ol><p>该错误原因是上传的icon不符合苹果规定，公司项目存在的问题是1.使用了圆角；2.有透明alpha通道；<br>解决方法自然容易了，找设计重新做，自己解决的话第二个可以DIY，如下：</p><p><img src="http://static.zybuluo.com/usiege/xtde6py269a5m4iusbumms4p/image_1bu7l6vhrvhm51b13pjvrlc0p13.png" alt="image_1bu7l6vhrvhm51b13pjvrlc0p13.png-100.4kB"></p><p>用系统预览打开icon图片，点掉Alpha的勾，再保存就可以了；<br><img src="http://static.zybuluo.com/usiege/yql5tndy4d612fhqfsi9n4l2/image_1bu7l8bt61p6v1mp11csi15ri1dmg1g.png" alt="image_1bu7l8bt61p6v1mp11csi15ri1dmg1g.png-128.6kB"></p><ol start="3"><li>提交上传结束后又出现了一个问题</li></ol><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">App</span> Installation failed, <span class="keyword">No</span> code signature found.</span><br></pre></td></tr></table></figure><p>真机无法运行了！这个问题纯属偶然，所以继续解决；打开终端，输入</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R <span class="number">777</span> <span class="regexp">/Applications/</span>Xcode.app<span class="regexp">/Contents/</span>Developer<span class="regexp">/Platforms/i</span>PhoneOS.platform<span class="regexp">/Developer/</span>SDKs<span class="regexp">/iPhoneOS.sdk</span></span><br></pre></td></tr></table></figure><p>修改文件权限，然后修改字段属性，打开：</p><p><strong>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/SDKSettings.plist</strong></p><p>，修改 <strong>CODE_SIGNING_REQUIRED</strong> 字段为 <strong>YES</strong> ，保存；</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;公司最近的一次App提交过程中遇到的一些问题，现贴在这里，有检索到本篇的朋友们可借鉴。&lt;br&gt;
    
    </summary>
    
      <category term="coder" scheme="http://charlesblog.site/categories/coder/"/>
    
    
      <category term="git" scheme="http://charlesblog.site/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>雷神陨落与巨魔日衰</title>
    <link href="http://charlesblog.site/2016/09/17/%E9%9B%B7%E7%A5%9E%E9%99%A8%E8%90%BD%E4%B8%8E%E5%B7%A8%E9%AD%94%E6%97%A5%E8%A1%B0/"/>
    <id>http://charlesblog.site/2016/09/17/雷神陨落与巨魔日衰/</id>
    <published>2016-09-17T04:36:00.000Z</published>
    <updated>2018-05-07T02:17:42.738Z</updated>
    
    <content type="html"><![CDATA[<p>本篇讲述了魔古族和巨魔两大帝国的衰落，文章采用半文言体，不喜勿喷。</p><a id="more"></a><p>我们说，任何的暴虐都不会永远持续，任何的刚愎自用只会自取灭亡，任何的偏执疯狂都会招致灭鼎；雷神陨落，熊猫帝国，历史长河，匆匆而过。</p><blockquote><p>昔雷神称帝，建号魔古，灭诸国，囚天神，筑长城以御螳妖轮回，修地宫以显帝王之功，指点江山，挥斥方遒。</p></blockquote><blockquote><p>又艾泽巨魔赞达拉氏族盛极一时，其头领称祖拉瑟拉，与魔古呈鼎力之势。雷神欣喜，诚邀巨魔共谋大业，以得两族子嗣绵延。</p></blockquote><blockquote><p>巨魔之臣进言，“尝闻大陆以西，奥丹姆人杰地灵，托维尔一族据守，又有起源熔炉不熄，当取之。”两君商之，甚喜，遂派使者前去招安。</p></blockquote><p><img src="http://upload-images.jianshu.io/upload_images/1429775-57b0747bd3ab4c11.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><blockquote><p>使者一路西行，源沙漠入，有幸见此地貌——苍翠雨林，清湖瀑布，土地平旷，金塔俨然，其中生灵奇景满目皆然，人间天堂，美不胜收。然托维尔一族早知雷神背叛行径，声称不与之同流合污，拒之。</p></blockquote><blockquote><p>雷神甚怒，集两族之势欲取之。大军压境，兵临城下。托维尔自知无力抵挡，启泰坦遗物，誓不让地一寸，欲与外敌同归黄泉。雷神率众冲锋，未觉异动，行至深处，四周隆隆，地裂数尺，颠簸起伏，能量倾泄，有吞天灭地之势。雷神卒，其众皆陨，奥丹姆不复往日，周遭死迹，颓萎崩裂。托维尔之族，有幸存者，现西去山路，以魔法蔽之，隐于世。</p></blockquote><blockquote><p>至于雷神之众，自是有逃出回国者，夺雷神尸体，于帝国征服者之墓供奉。赞达拉也再无兴风作浪之能是。有道是，多行不义必自毙。双魔帝国，国力渐衰。</p></blockquote><blockquote><p>魔古末年，帝称牢非，异号“缚奴”，生平极奢。其下熊猫人康，苦于皇帝压迫，又魔古自奥丹姆之役一蹶不振，遂揭竿而起。康深谙武道，教习众人，于魔古山宝库大胜牢非。各路诸侯见势，群雄尽起。猢狲、锦鱼人、土地精、野牛人，皆于各地抗击魔古。牢非不敌众人，退守锦绣谷，盘据帝国皇土。后康乘胜追击，杀牢非，废奴制，除不公，建新国。各种族相继称王，各国之间互通有无，繁荣之相，一派详和。</p></blockquote><p><img src="http://upload-images.jianshu.io/upload_images/1429775-1922c521289b7024.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><blockquote><p>魔古虽灭，巨魔又至。熊猫帝国初建，北御巨魔，南据螳妖。然国之武力，唯初时一众武僧，一拳难敌四手，战势危机。人曰，乱世当有才杰出。英雄救世不问出处，时有熊猫人蒋，幼时救猛兽云端翔龙，好生照料，翔龙喜，为之友，蒋以罗称。战事至翡翠林，蒋携罗从天而降，杀巨魔。巨魔又至，巨魔又败。凡艾泽拉斯之战，行此不义之师，多有英雄起而灭之，此为艾泽之福，众生之福。</p></blockquote><p>魔兽世界两大帝国，终因行不义之师，使得帝国终成明日黄花，往昔的繁荣，不过成历史长河中沧海一粟。一部魔兽历史，亦是一部世界历史，历史告诫我们，并非不义之师不能存在，而是因它有悖人道，必然不能长久，必然不能受到人们颂扬。历史只会记往那些给人们带来更好生活的人和事，于是我们有了这样的词语：英雄，事迹，杰出，仁治，盛世，爱戴，歌颂……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本篇讲述了魔古族和巨魔两大帝国的衰落，文章采用半文言体，不喜勿喷。&lt;/p&gt;
    
    </summary>
    
      <category term="Azeroth" scheme="http://charlesblog.site/categories/Azeroth/"/>
    
    
  </entry>
  
  <entry>
    <title>魔古帝国的形成与始皇帝雷神</title>
    <link href="http://charlesblog.site/2016/08/28/%E9%AD%94%E5%8F%A4%E5%B8%9D%E5%9B%BD%E7%9A%84%E5%BD%A2%E6%88%90%E4%B8%8E%E5%A7%8B%E7%9A%87%E5%B8%9D%E9%9B%B7%E7%A5%9E/"/>
    <id>http://charlesblog.site/2016/08/28/魔古帝国的形成与始皇帝雷神/</id>
    <published>2016-08-28T00:38:00.000Z</published>
    <updated>2018-05-07T02:17:42.739Z</updated>
    
    <content type="html"><![CDATA[<p>本篇我们说一说魔古一族。 </p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-1a255b2ce111d74f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="魔古族"></p><a id="more"></a><p>在讲魔古一族之前，首先我们先来总结一下魔兽世界的种族形成。截止到目前，我们从最初的泰坦创世，到现在我们所能讲到的各种族，大致可以将魔兽种族体系的形成分为了三个阶段。</p><p>第一个阶段是原始物种虚空大君、泰坦、纳鲁等的出现，至于怎么出现的就不要纠结了，这个问题同“女娲是怎么来的？”一样愚蠢；<br>第二个阶段是堕落泰坦变节与上古之神腐化初生泰坦，在艾泽拉斯大陆带来了两波黑暗势力，同时泰坦团们创造第一批泰坦造物守护者群，再加上艾泽拉斯原驻元素团体、荒野众神团，将战争引入艾泽拉斯早期大陆；<br>第三个阶段是第二阶段艾泽拉斯早期战争后期，双生熔炉创造第二代泰坦造物经过内战与对外战争、血肉诅咒逐渐形成魔兽现代种族的雏形，黑暗势力在各地的变种形成虫族与恶魔等种族，艾泽拉斯原驻物种发展形成龙类、自然神、元素等。<br>本篇要讲的魔古一族就是上面说的第三阶段中所说的第二代泰坦造物中的一支。</p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-39c9660f3e20627e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="艾泽拉斯物种"></p><p> 此前我们说到在守护者内乱后，大守护者莱便消失了。魔古一族一直坚守着锦绣谷，履行泰坦们给他们守护大地的任务。因为血肉诅咒的恐慌，造成了魔古内部军阀割剧的局面。</p><p>同巨魔族一样，魔古一族同样也面临着对外战争，即螳螂妖虫族的威胁。在魔古的对内对外战争期间，锦绣谷也同时发展起来锦鱼人、猴族以及熊猫人。熊猫一族与荒野众神中的白虎雪怒、青龙玉珑、朱鹤赤精、玄牛砮皂相交甚好，称它们为至尊天神。</p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-4b31199991e5f766.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="至尊天神"></p><p>魔古一族的统一，大抵是借鉴秦始皇一统天下的路子，而且也加入了一些美国大片中的个人英雄主义。首先出现了一个类似秦始皇的人物——雷神。<br>早年雷神的父亲被他的谋臣所害，雷神出逃，然而根据编年史的说法说他并没有寻仇也未继续加入魔古军阀战争，而是陷入了自身的思索，这一点上倒是很牵强。似乎魔兽世界观中对于某位英雄的个人转变处理都是通过个人的“思考”，像小萨因为思考得出“存在即是缺陷”，大守护者莱（莱登）的思考带来自己的郁郁而终，以及我们的雷神的思考。雷神我们认为他是带有主角光环的，入地宫，遇莱登。严厉指责守护者的不作为，后被莱登带往雷霆山，在这里，雷神得知泰坦团们的死亡后，夺取了泰坦残存力量，囚禁莱登。终于，一位枭雄诞生。</p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-82a6f74832f79ed6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="雷神"></p><p>凭借着泰坦力量，雷神一统魔古，并且创立了一个强大的魔古帝国。同秦始皇那样，他成为了魔古族的第一代皇帝。<br>雷神之后相继对锦鱼人、猴族、熊猫人发动战争，继雷神在昆莱山打败了至尊天神白虎后，这三个族均被雷神打败，熊猫人就此沦为奴隶；<br>由于螳螂妖一族族众众多，难以收服，雷神下令修筑“蟠龙脊”（这不就是万里长城么）以抵御敌人；<br>雷神还在锦绣谷以北找到泰坦造物纳拉克煞引擎（纳拉克不是一条龙么？），这个机器可以制造出由血肉和岩石塑造的新物种，由这个机器生产的新物种土地精、蜥蜴人诞生；</p><p>其实从编年史来看，雷神的确是参照始皇帝来的，他在建立帝国之后的书同文、车同轨、统一度量衡以及颁布第一部成文法典，我们简直不能用像来形容。就这样，雷神开始了他在艾泽拉斯南部的帝国统治。然而他始终无法抵挡血肉诅咒带给他的恐慌，为长生不老，他开始寻求种族逆转血肉的方法……</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本篇我们说一说魔古一族。 &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1429775-1a255b2ce111d74f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;魔古族&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Azeroth" scheme="http://charlesblog.site/categories/Azeroth/"/>
    
    
  </entry>
  
  <entry>
    <title>巨魔与虫族的世纪之战</title>
    <link href="http://charlesblog.site/2016/08/26/%E5%B7%A8%E9%AD%94%E4%B8%8E%E8%99%AB%E6%97%8F%E7%9A%84%E4%B8%96%E7%BA%AA%E4%B9%8B%E6%88%98/"/>
    <id>http://charlesblog.site/2016/08/26/巨魔与虫族的世纪之战/</id>
    <published>2016-08-26T00:33:00.000Z</published>
    <updated>2018-05-07T02:17:42.736Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://upload-images.jianshu.io/upload_images/1429775-134a3bc6a48cb352.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>根据魔兽世界编年史的记录，巨魔一族永恒之井周围最早的原生物种。我们先来回顾一下永恒之井的产生，艾泽拉斯中心地带被最厉害的上古之神亚煞极占据，神父阿曼苏尔将其扯出，在破碎的泰坦身体处流出一道能量翔，这翔营养比较丰富，时间一长，周围自然而然的少不了吃翔的物种。<br><a id="more"></a></p><p>魔兽历史时间线黑门前一万六千年，艾泽拉斯原驻民在永恒之井的滋润下逐渐兴盛。巨魔就是这其中的一支。这个物种的有两个特点，第一，食人，第二，巫毒魔法。它们的信仰是荒野众神“洛阿”。集网友们的猜测与推断，巨魔的早期物种原型应该是南美印第安人，俗称玛雅人。而上面的两个特点是支撑这个观点的依据，后面我们会专门分析一下艾泽拉斯早期物种及其原型的猜想。</p><p>我们继续说回巨魔。早期的巨魔总结来说就是对内战争和对外战争的结合。我们说一个种族的强大是通过内部矛盾的发生来保持的，内部的竞争促进了各部族强壮的发育。巨魔一族在战争中逐渐崛起的部族分别是赞达拉，古拉巴什，阿曼尼和达卡莱。这四个部族我们在魔兽世界的前几个版本中都有接触过，其中赞达拉是在熊猫人大陆一个强悍的种族，古拉巴什在卡利姆多的祖尔法拉克，阿曼尼分布在祖阿曼和祖尔格拉布，而达卡莱则是在北极。</p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-14f0a671b878b7c5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>人们常说，不作就不会死。这四个部族本来大家打的挺和谐，你争我抢的也分不出个胜负。可偏偏族内有巫师玩起通灵术，玩着玩着就玩出火，把恶魔给唤醒了。还记得跟守护者提尔打架的基希克斯吗？这个家伙就是上古神的小弟克瑟拉基大将，当初被洛肯派来追杀提尔未果，就跑到巨魔的地盘睡起觉来。结果就被巨魔人给吵醒了，基希克斯很生气，说：爬虫们，是什么样的祸事在这样早的时候发生，打断了老子的安睡？于是就把之前被提尔打散的亚基召唤回来，建立起个根据地叫做阿兹亚基（老子垃圾？）。</p><p>俗话说“兄弟隙于内，外御其辱”，巨魔眼看这外来物种甚是强大，各部族联合起来组成巨魔联盟，顺带着把他们大神洛阿请出来，一众人就跟基希克斯开干。说到底这临时组起来的队伍就是不行，基希克斯这回是彻底把自己给玩死了。树倒猢孙散，小弟一见老大死了，就转而去投靠别的老大。</p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-ef6eb5cedcaadb4a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>赞达拉巨魔头领心想，这亚基也忒不行，打打就完蛋，打完这又要分地盘，不行得想办法给其他几个族支开。其他几个部族的头领也想自己不如赞达拉强，在这跟他争争不过，不如去别地占个山头去。于是大家开了个会，一致同意将这些跑的亚基赶尽杀绝，其实是明着分地盘。达莱卡向北追击，占据了北方冰封的土地；古拉巴什一族向西南进发，控制了原囚禁上古之神克苏恩的安其拉堡垒附近的大部分区域；阿曼尼一族则是去向了东北方基希克斯老巢，在那里建立起了圣城祖尔阿曼；剩下的赞达拉则继续在中部圣城祖尔达萨发布指令，起着联系各部族的作用。后期这个中心据点的作用逐渐被淡化，各巨魔在新领地形成了不同的种族特色与文化，赞达拉部族也退回了山地。 至于黑暗巨魔我们这里还没有涉及到，这个分支比较复杂，总体来看是部族间融合的结果。</p><p><img src="http://upload-images.jianshu.io/upload_images/1429775-dd1611d508252c55.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p><p>这里顺道介绍下战败的亚基虫族的命运。亚基的四散也形成了不同的虫族分类，在北方的虫族由于受到尤格隆萨囚牢的影响，慢慢演化成奈幽虫族，在地底建立了强大的阿兹奥奈幽帝国；西南方虫族定居了安其拉神殿，受克苏恩的影响被改造成其拉虫人；东南方是古神亚煞极死去的地方，在这个地方定居下来的虫族在这里筑起了虫巢，叫做曼提维斯。 这就是魔兽世界巨魔和亚基虫两大种族的早期战争与分化过程。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://upload-images.jianshu.io/upload_images/1429775-134a3bc6a48cb352.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;根据魔兽世界编年史的记录，巨魔一族永恒之井周围最早的原生物种。我们先来回顾一下永恒之井的产生，艾泽拉斯中心地带被最厉害的上古之神亚煞极占据，神父阿曼苏尔将其扯出，在破碎的泰坦身体处流出一道能量翔，这翔营养比较丰富，时间一长，周围自然而然的少不了吃翔的物种。&lt;br&gt;
    
    </summary>
    
      <category term="Azeroth" scheme="http://charlesblog.site/categories/Azeroth/"/>
    
    
  </entry>
  
  <entry>
    <title>World of WarCarft插件的构成</title>
    <link href="http://charlesblog.site/2016/08/25/wow%E6%8F%92%E4%BB%B6%E7%9A%84%E6%9E%84%E6%88%90/"/>
    <id>http://charlesblog.site/2016/08/25/wow插件的构成/</id>
    <published>2016-08-25T03:21:00.000Z</published>
    <updated>2018-05-07T02:17:42.734Z</updated>
    
    <content type="html"><![CDATA[<p>今天来说一说wow插件是个什么鬼？<br><a id="more"></a></p><p>插件是魔兽世界开放的第三个接口，有朋友会问，什么是第三方？这个是软件业的一个术语，简单的说，就是游戏当中能让我们自己来定制DIY的部分，比方说对话界面，还有一些数据显示之类的功能。</p><p>wow的插件全部保存在<em>World of Warcraft/Interface/AddOns</em>目录下，在这个目录下会有一些暴雪自带的功能插件，它们均是以<em>Blizzard_</em>开头的，我们自己做的插件可以随意命名，不同插件可以分别放在不同的文件夹下面（我们在做插件的过程中，强烈建议用英文命名，避免因为中文导致插件无法被识别的问题）。<a href="http://www.townlong-yak.com/framexml/" target="_blank" rel="noopener">http://www.townlong-yak.com/framexml/</a>这个网址可以下载暴雪自带插件。</p><p>说一下插件的构成，打开插件目录，你会发现大致会有三种类型文件，分别是toc文件，xml文件和lua文件。</p><h2 id="toc文件"><a href="#toc文件" class="headerlink" title="toc文件"></a>toc文件</h2><p>这个文件是一个必要文件，它的名字与你的插件文件夹名字同名，只不过带了一个后缀toc，如果不同名的话，打开魔兽客户端将会无法识别你的插件；</p><p>注意！！！这个文件的每行开头不能有空格，每行仅作一个说明。</p><p>用文本工具打开toc文件，内容说明分三种类型：</p><h3 id="以-开头的数据"><a href="#以-开头的数据" class="headerlink" title="以##开头的数据"></a>以##开头的数据</h3><p>用来进行插件描述，一般会有插件名称，作者名称，功能描述等；它的基本格式是</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 标签名：标签值</span></span></span><br></pre></td></tr></table></figure><p>标签的名字可以随便写，但是有一些wow自带的标签名我们进行一下解释：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Interface:</span>标记插件可用在的wow游戏版本，当该值小于低于当前游戏版本插件不会被加载；</span><br><span class="line"><span class="string">Title:</span>插件名称，这个会被显示在游戏选择人物的插件列表里；</span><br><span class="line">Title-<span class="string">zhCN:</span>插件的中文显示，如果想要在其他语言中显示，则修改-后面的就可以了；下面的Notes也是如此；</span><br><span class="line"><span class="string">Notes:</span>插件列表中，鼠标移到插件名上时显示的信息；</span><br><span class="line">RequiredDeps, Dependencies, 或者任意以 <span class="string">"Dep"</span> 开始的字符串：表示我们当前的插件必须需要加载的其他插件；</span><br><span class="line"><span class="string">OptionalDeps:</span>与上面的对照，这里的插件是可选的；</span><br><span class="line"><span class="string">LoadOnDemand:</span>值为<span class="number">1</span>时，表示这个插件不会在游戏开始就加载，而是在需要的时候才加载；</span><br><span class="line"><span class="string">LoadWith:</span>如果上面的值为<span class="number">1</span>时，本条所描述的插件会随着本插件一起加载；</span><br><span class="line"><span class="string">LoadManagers:</span>本条中所描述的插件如果都不存在的话，则会自动加载本插件；如果有一个存在，则按LoadOnDemand值为<span class="number">1</span>处理；</span><br><span class="line"><span class="string">SavedVariables:</span>一些以逗号分割的变量名称，这些变量会被保存在硬盘上，下次加载时可以被读取到；</span><br><span class="line"><span class="string">SavedVariablesPerCharacter:</span>与上面的标签是相同的作用，不过该标签只用于保存不同角色的不同配置；</span><br><span class="line"><span class="string">DefaultState:</span>本插件默认开启状态，值为disabled/enabled；</span><br><span class="line"><span class="string">Author:</span>作者名字</span><br><span class="line"><span class="string">Version:</span>插件的版本号</span><br></pre></td></tr></table></figure><p>另外你可以定义自己的标签，以上中最重要的就是前两个，尽量不要出错；</p><h3 id="本插件需要加载的代码文件"><a href="#本插件需要加载的代码文件" class="headerlink" title="本插件需要加载的代码文件"></a>本插件需要加载的代码文件</h3><p>列出需要加载的代码类文件，只支持lua和xml两种格式，这里的文件需要给出以当前目录为根目录的文件完整路径，就是说如果你插件目录下有一个<code>myaddon.lua</code>的文件则需要添加：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">myaddon</span><span class="selector-class">.lua</span></span><br></pre></td></tr></table></figure><p>而如果你插件目录下有一个子文件夹<em>MyAddon</em>，而该目录下有一个<code>myaddon2.lua</code>的话，则需要添加：</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyAddon/myaddon2.<span class="keyword">lua</span></span><br></pre></td></tr></table></figure><h3 id="以-开头的文件"><a href="#以-开头的文件" class="headerlink" title="以#开头的文件"></a>以#开头的文件</h3><p>这些是注释文本，在toc中可以随便添加，主要用作插件制作者自己记录，这些不会被插件加载；</p><h2 id="XML文件"><a href="#XML文件" class="headerlink" title="XML文件"></a>XML文件</h2><p>xml文件主要用于插件的界面制作，以及事件绑定，事件绑定通俗的讲就是你对插件做某些操作（按一个按钮之类的）游戏中会出现的事件，这些事件会以一个方法的形式出现在lua文件中，你可以把你自己想做的事情写在这个方法中，如果你学过些编程，应该知道我们这里说的方法就是lua函数；</p><p>在你插件的根目录下会有一个叫做<strong>Bindings.xml</strong>的文件，这个文件会被游戏客户端自动读取，不必写在toc文件中；</p><p>我们来看一个该文件的例子：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;Bindings&gt; </span><br><span class="line">    &lt;Binding <span class="built_in">name</span>=<span class="string">"CUBE_CODE"</span> header=<span class="string">"CUBE"</span>&gt; </span><br><span class="line">      <span class="keyword">if</span> IGAS.UIParent.Cube_Main <span class="keyword">then</span> </span><br><span class="line">         IGAS.UIParent.Cube_Main.Visible = <span class="keyword">not</span> IGAS.UIParent.Cube_Main.Visible </span><br><span class="line">      <span class="keyword">end</span> </span><br><span class="line">    &lt;/Binding&gt; </span><br><span class="line">    &lt;Binding <span class="built_in">name</span>=<span class="string">"CUBE_DEBUG"</span>&gt; </span><br><span class="line">      <span class="keyword">if</span> IGAS.UIParent.Cube_Debug <span class="keyword">then</span> </span><br><span class="line">         IGAS.UIParent.Cube_Debug.Visible = <span class="keyword">not</span> IGAS.UIParent.Cube_Debug.Visible </span><br><span class="line">      <span class="keyword">end</span> </span><br><span class="line">    &lt;/Binding&gt; </span><br><span class="line">&lt;/Bindings&gt;</span><br></pre></td></tr></table></figure><p>我们暂时先不要管这些代码的意思，只需要知道这个文件设置了界面元素与游戏事件的绑定，而绑定的事件是由Lua文件完成的；<strong>Bindings.xml</strong>文件绑定了一个与插件名同名的lua文件，并且还将界面上的元素与该文件所描述的事件绑定在了一起：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- Binding Text </span><br><span class="line">_G<span class="selector-class">.BINDING_HEADER_CUBE</span> = L[<span class="string">"Cube"</span>] </span><br><span class="line">_G<span class="selector-class">.BINDING_NAME_CUBE_CODE</span> = L[<span class="string">"Simple Dev Tool"</span>] </span><br><span class="line">_G<span class="selector-class">.BINDING_NAME_CUBE_DEBUG</span> = L[<span class="string">"Simple Debug Tool"</span>]</span><br></pre></td></tr></table></figure><p>我们现在先不要管他们是怎么联系起来的，具体我们在之后的写代码过程中会慢慢讲到，现在只要理解一点，xml会定义我们的界面，并且还可以设置界面元素与事件的绑定，而绑定的事件会交由lua文件处理；</p><p>我们还可以加载其他的xml和lua文件，如下例：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Ui</span> <span class="attr">xmlns</span>=<span class="string">"http://www.blizzard.com/wow/ui/"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.blizzard.com/wow/ui/..\FrameXML\UI.xsd"</span>&gt;</span> </span><br><span class="line">   <span class="comment">&lt;!-- Init --&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">Script</span> <span class="attr">file</span> = <span class="string">"IGAS_Toolkit.lua"</span>/&gt;</span><span class="undefined"> </span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="handlebars"><span class="xml">   <span class="comment">&lt;!-- Modules --&gt;</span> </span></span></span><br><span class="line"><span class="handlebars"><span class="xml">   <span class="tag">&lt;<span class="name">Include</span> <span class="attr">file</span> = <span class="string">"Modules\AutoRepair\AutoRepair.xml"</span>/&gt;</span> </span></span></span><br><span class="line"><span class="handlebars"><span class="xml">   <span class="tag">&lt;<span class="name">Include</span> <span class="attr">file</span> = <span class="string">"Modules\AutoSell\AutoSell.xml"</span>/&gt;</span> </span></span></span><br><span class="line"><span class="handlebars"><span class="xml"><span class="tag">&lt;/<span class="name">Ui</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure><p>其中<strong>&lt;</strong> <strong>/&gt;</strong>这间的就是xml文件的标签，标签的类型会由<strong>&lt;</strong>后面的名称标识，如上<code>Script</code>这个标签用于加载lua文件，而<code>Include</code>用于加载其他的xml文件；</p><h2 id="lua文件"><a href="#lua文件" class="headerlink" title="lua文件"></a>lua文件</h2><p>Lua是wow插件逻辑的主要语言，做插件前需要先熟悉一下lua的语法，感兴趣的不防去知乎下搜索一些学习的建议，找一些入门的资料，在我的公众号给我留言，我们可以一起学习探讨下；这里我们给一些简短的片断，目的是了解一下它的作用；</p><p>假设我们现在做一个插件，名为DHAddon（想想DH是不是恶魔猎手的缩写呀？Devil Hunter?），插件里有两个Lua文件devil.lua hunter.lua;</p><p>wow加载它们的方式，类似下面的代码：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- Load DHAddon </span><br><span class="line">local DHAddon = &#123;&#125; </span><br><span class="line"></span><br><span class="line">f = loadfile(<span class="string">"devil.lua"</span>) </span><br><span class="line"><span class="function"><span class="title">f</span><span class="params">( <span class="string">"DHAddon"</span>, DHAddon )</span></span> </span><br><span class="line"></span><br><span class="line">f = loadfile(<span class="string">"hunter.lua"</span>) </span><br><span class="line"><span class="function"><span class="title">f</span><span class="params">( <span class="string">"DHAddon"</span>, DHAddon )</span></span></span><br></pre></td></tr></table></figure><p>loadfile就是加载文件，文件名称用字符串表示（lua语法“”表示字符串）；加载的结果保存在f中；</p><p>devil.lua:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local addonName, addon = ... </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(addonName .. <span class="string">" is loaded."</span>)</span></span> </span><br><span class="line"></span><br><span class="line">addon<span class="selector-class">.DHAddon</span> = <span class="number">123</span></span><br></pre></td></tr></table></figure><p>hunter.lua:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">local addonName, addon = <span class="built_in">..</span>. </span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span>( <span class="string">"DHAddon is "</span> <span class="built_in">..</span> addon.DHAddon )</span><br></pre></td></tr></table></figure><p>不出意外的话，运行结果会是：</p><p>DHAddon is loaded.<br>DHAddon is 123</p><p>另外上面的两个lua文件也可以下面这么写，其中有好多lua的内容，暂不解释原因，贴在这里之后了解到了再来回顾：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插件第一个Lua文件使用，这行代码确保以下的代码以addon为环境，而不是以_G为环境， </span></span><br><span class="line"><span class="comment">-- 并且在addon环境中可以访问_G的任意变量，访问的变量值也将存储到addon中，便于下次直接访问 </span></span><br><span class="line"><span class="comment">-- 下面的代码定义的全局变量都将保存在addon表中，而非_G </span></span><br><span class="line"><span class="built_in">setfenv</span>(<span class="number">1</span>, <span class="built_in">setmetatable</span>(<span class="built_in">select</span>(<span class="number">2</span>, ...), &#123; <span class="built_in">__index</span> = <span class="function"><span class="keyword">function</span><span class="params">(self,  key)</span></span> <span class="keyword">local</span> v = <span class="built_in">_G</span>[key]; <span class="built_in">rawset</span>(self, key, v); <span class="keyword">return</span> v <span class="keyword">end</span> &#125;)) </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">testA</span><span class="params">()</span></span> </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"devil case A"</span>) </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 插件的其他lua文件仅需要设置运行环境 </span><br><span class="line"><span class="function"><span class="title">setfenv</span><span class="params">(<span class="number">1</span>, select(<span class="number">2</span>, ...)</span></span>) </span><br><span class="line"></span><br><span class="line">-- devil<span class="selector-class">.lua</span> 中定义的函数可以被直接调用 </span><br><span class="line"><span class="function"><span class="title">testA</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure><p>插件的构成就说这么多，好多东西不是很懂，慢慢深入了解就好了；本篇就到这了，有兴趣的可以关注公众号“艾泽拉斯日常”，我们一同来探讨…</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天来说一说wow插件是个什么鬼？&lt;br&gt;
    
    </summary>
    
      <category term="wower" scheme="http://charlesblog.site/categories/wower/"/>
    
    
      <category term="addons" scheme="http://charlesblog.site/tags/addons/"/>
    
      <category term="wow" scheme="http://charlesblog.site/tags/wow/"/>
    
      <category term="toc" scheme="http://charlesblog.site/tags/toc/"/>
    
  </entry>
  
</feed>
