<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="Nothing is true,every is permitted.">
<meta property="og:type" content="website">
<meta property="og:title" content="NOTHING">
<meta property="og:url" content="http://uwuneng.com/index.html">
<meta property="og:site_name" content="NOTHING">
<meta property="og:description" content="Nothing is true,every is permitted.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NOTHING">
<meta name="twitter:description" content="Nothing is true,every is permitted.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://uwuneng.com/"/>





  <title>NOTHING</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NOTHING</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">NOTHING IS EVERYTHING.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2018/05/03/你一定不知道Swift源码怎么看？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/03/你一定不知道Swift源码怎么看？/" itemprop="url">你一定不知道Swift源码怎么看？</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-03T23:19:00+08:00">
                2018-05-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我想你一定是在开玩笑。<br>源码怎么看，打开看呗！说这话的时候请收下我的轻蔑，哈哈。不过就这个问题我今天在知乎搜索了一通。不要问我为什么在知乎搜索，鬼知道知乎什么都有。<br>那么，请收下我的提问：</p>
<blockquote>
<p><a href="https://www.zhihu.com/question/38215419" target="_blank" rel="noopener">如何阅读Swift源码</a></p>
</blockquote>
<p>知乎果然没有让我失望，结果教程如下；</p>
<blockquote>
<p><a href="http://swift.gg/2016/12/30/how-to-read-the-swift-standard-libray-source/" target="_blank" rel="noopener"># <a href="http://swift.gg/2016/12/30/how-to-read-the-swift-standard-libray-source/" title="如何阅读 Swift 标准库中的源码" target="_blank" rel="noopener">如何阅读 Swift 标准库中的源码</a>
</a></p>
</blockquote>
<p>顺便提一下，这次搜索还让我发现了一个比较不错的swift网站，有心的同学请收下：<a href="http://swift.gg" target="_blank" rel="noopener">swift.gg</a></p>
<p>于是今天搞了下源码的编译，并了解到一个叫做 <em>GYB</em> 的东西，这个东西今天先放一下。源碼編譯的過程無非就是用 <em>brew</em> 下了一些命令行軟件，然後使用 <em>build</em> 腳本跑一下過程，在此也不多說。但是今天的重點當然是我們要從源碼出發搞一些事情。<br>续：今天又build，发现也并没有得出什么重要的东西，只是把gyb文件生成为swift文件，其他过程不知道它经历了什么，对我想看源码没有任何作用，还跑了整整一个下午；对于只是想看代码的同学，还是用官网给出的gyb.py脚本做处理吧；</p>
<ol>
<li>hashable</li>
</ol>
<p>前两天写Dictionary时发现想用枚举做key，自定义一个Dictionary，value是#selector，但是在写的过程中发现说key值需要遵循hashable协议。可以看源码来理解一下。<br>首先要找到Hashable文件，发现swift的标准核心库被放在 <strong>stdlib/public/core</strong> 下，有一个 <strong>Hashable.swift</strong> 文件，打开文件先是一大段的描述，大体内容就是hashable协议作用的场景，以及给出了一个小例子；</p>
<p>一个Hash类型，提供了一个 hashValue 的属性，它是一个整型常量， 如果有两个相同类型的a，b，如果 a == b，那么 a.hashValue == b.hashValue；但是反过来，如果两个hash值相同，并不表示a 就一定等于 b；<br>还有一点非常重要，就是在两次不同的程序执行中hash值并不保证相等，所以不要把hash值用在你的程序中；<br>Hashable协议可用于struct, enum, class，它继承于 Equatable，所以遵循Hashable协议需要同时实现Hashable协议方法，以及 Equatable 协议方法；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/// A point in an x-y coordinate system.</span><br><span class="line">    struct GridPoint &#123;</span><br><span class="line">        var x: Int</span><br><span class="line">        var y: Int</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     extension GridPoint: Hashable &#123;</span><br><span class="line">         var hashValue: Int &#123;</span><br><span class="line">            return x.hashValue ^ y.hashValue &amp;* 16777619</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static func == (lhs: GridPoint, rhs: GridPoint) -&gt; Bool &#123;</span><br><span class="line">            return lhs.x == rhs.x &amp;&amp; lhs.y == rhs.y</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">       var tappedPoints: Set = [GridPoint(x: 2, y: 3), GridPoint(x: 4, y: 1)]</span><br><span class="line">       let nextTap = GridPoint(x: 0, y: 1)</span><br><span class="line">       if tappedPoints.contains(nextTap) &#123;</span><br><span class="line">          print(&quot;Already tapped at (\(nextTap.x), \(nextTap.y)).&quot;)</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">          tappedPoints.insert(nextTap)</span><br><span class="line">          print(&quot;New tap detected at (\(nextTap.x), \(nextTap.y)).&quot;)</span><br><span class="line">       &#125;</span><br><span class="line">      // Prints &quot;New tap detected at (0, 1).&quot;)</span><br></pre></td></tr></table></figure>
<p>在实现的代码里有一些奇怪的符号，暂时还有点摸不清头脑，有些是一些编译符号，大体能看懂点意思，但有些像<code>@_silgen_name(&quot;_swift_stdlib_Hashable_isEqual_indirect&quot;)</code>就完全看不懂，回头找人再请教；<br>这里还要说的一个就是一个<code>UnsafePointer&lt;T&gt;</code>:</p>
<blockquote>
<p>在 Swift 中，指针都使用一个特殊的类型来表示，那就是 UnsafePointer<t>。遵循了 Cocoa 的一贯不可变原则，UnsafePointer<t> 也是不可变的。当然对应地，它还有一个可变变体，UnsafeMutablePointer<t>。绝大部分时间里，C 中的指针都会被以这两种类型引入到 Swift 中：C 中 const 修饰的指针对应 UnsafePointer (最常见的应该就是 C 字符串的 const char * 了)，而其他可变的指针则对应 UnsafeMutablePointer。除此之外，Swift 中存在表示一组连续数据指针的 UnsafeBufferPointer<t>，表示非完整结构的不透明指针 COpaquePointer 等等。另外你可能已经注意到了，能够确定指向内容的指针类型都是泛型的 struct，我们可以通过这个泛型来对指针指向的类型进行约束以提供一定安全性。</t></t></t></t></p>
</blockquote>
<p>需要具体了解的看这篇：<a href="https://onevcat.com/2015/01/swift-pointer/" target="_blank" rel="noopener">UnsafePointe<t></t></a></p>
<p>顺便吐槽句哈，apple的代码也还有这种东西，也不知道是修改过的没有；<br><img src="https://upload-images.jianshu.io/upload_images/1429775-225ee3ef5a38e747.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="FIXME"></p>
<ol start="2">
<li>Equatable</li>
</ol>
<ul>
<li>它是一种可用于值比较的类型；</li>
<li>在序列和集合操作中，可以将一个遵循了<code>Equatable</code>协议的对象传递给<code>contaions(_:)</code>方法，来确定是否包含，用法如下：</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> students = [<span class="string">"Nora"</span>, <span class="string">"Fern"</span>, <span class="string">"Ryan"</span>, <span class="string">"Rainer"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nameToCheck = <span class="string">"Ryan"</span></span><br><span class="line"><span class="keyword">if</span> students.<span class="built_in">contains</span>(nameToCheck) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"<span class="subst">\(nameToCheck)</span> is signed up!"</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"No record of <span class="subst">\(nameToCheck)</span>."</span>)</span><br><span class="line">&#125;</span><br><span class="line">   <span class="comment">// Prints "Ryan is signed up!"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// Conforming to the Equatable Protocol</span></span><br></pre></td></tr></table></figure>
<ul>
<li>本地类型继承自<code>Equatable</code>协议需要注意：<ol>
<li>对于一个<code>struct</code>类型，它的所有存储属性都需要遵循<code>Equatable</code>协议；</li>
<li>对于一个<code>enum</code>类型，它的所有关联值都需要遵循<code>Equatable</code>协议；</li>
<li>如果上述标准不符合，需要在扩展中实现<code>==</code>静态方法；<br>例如：</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class StreetAddress &#123;</span><br><span class="line">    let number: String</span><br><span class="line">    let street: String</span><br><span class="line">    let unit: String?</span><br><span class="line">    init(_ number: String, _ street: String, unit: String? = nil) &#123;</span><br><span class="line">        self.number = number</span><br><span class="line">        self.street = street</span><br><span class="line">        self.unit = unit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension StreetAddress: Equatable &#123;</span><br><span class="line">    static func == (lhs: StreetAddress, rhs: StreetAddress) -&gt; Bool &#123;</span><br><span class="line">        return</span><br><span class="line">            lhs.number == rhs.number &amp;&amp;</span><br><span class="line">            lhs.street == rhs.street &amp;&amp;</span><br><span class="line">            lhs.unit == rhs.unit</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let addresses = [StreetAddress(&quot;1490&quot;, &quot;Grove Street&quot;),</span><br><span class="line">                 StreetAddress(&quot;2119&quot;, &quot;Maple Avenue&quot;),</span><br><span class="line">                 StreetAddress(&quot;1400&quot;, &quot;16th Street&quot;)]</span><br><span class="line">let home = StreetAddress(&quot;1400&quot;, &quot;16th Street&quot;)</span><br><span class="line">print(addresses[0] == home)</span><br><span class="line">// Prints &quot;false&quot;</span><br><span class="line">print(addresses.contains(home))</span><br><span class="line">// Prints &quot;true&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>另外我在这个实现里面看到了以前数学课知识的身影：</li>
</ul>
<ul>
<li><code>a == a</code> is always <code>true</code> (Reflexivity)   # 自反性</li>
<li><code>a == b</code> implies <code>b == a</code> (Symmetry)  # 对称性</li>
<li><code>a == b</code> and <code>b == c</code> implies <code>a == c</code> (Transitivity)  # 传递性<br>所以我们定义的<code>==</code>(两对象相等)完全取决于我们自己实现的静态方法：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class IntegerRef: Equatable &#123;</span><br><span class="line">    let value: Int</span><br><span class="line">    init(_ value: Int) &#123;</span><br><span class="line">        self.value = value</span><br><span class="line">    &#125;</span><br><span class="line">    static func == (lhs: IntegerRef, rhs: IntegerRef) -&gt; Bool &#123;</span><br><span class="line">        return lhs.value == rhs.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">let a = IntegerRef(100)</span><br><span class="line">let b = IntegerRef(100)</span><br><span class="line">print(a == a, a == b, separator: &quot;, &quot;)</span><br><span class="line">// Prints &quot;true, true&quot;</span><br></pre></td></tr></table></figure>
<p>而不相等的定义则完全是，自实现的相等操作取反：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">extension Equatable &#123;</span><br><span class="line">  /// Returns a Boolean value indicating whether two values are not equal.</span><br><span class="line">  ///</span><br><span class="line">  /// Inequality is the inverse of equality. For any values `a` and `b`, `a != b`</span><br><span class="line">  /// implies that `a == b` is `false`.</span><br><span class="line">  ///</span><br><span class="line">  /// This is the default implementation of the not-equal-to operator (`!=`)</span><br><span class="line">  /// for any type that conforms to `Equatable`.</span><br><span class="line">  ///</span><br><span class="line">  /// - Parameters:</span><br><span class="line">  ///   - lhs: A value to compare.</span><br><span class="line">  ///   - rhs: Another value to compare.</span><br><span class="line">  @inlinable // FIXME(sil-serialize-all)</span><br><span class="line">  @_transparent</span><br><span class="line">  public static func != (lhs: Self, rhs: Self) -&gt; Bool &#123;</span><br><span class="line">    return !(lhs == rhs)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个实现是已经定义好的！！!</p>
<ul>
<li><code>==</code>与<code>===</code>的区别<br>看一下这两者的区别：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public protocol Equatable &#123;</span><br><span class="line">  /// Returns a Boolean value indicating whether two values are equal.</span><br><span class="line">  ///</span><br><span class="line">  /// Equality is the inverse of inequality. For any values `a` and `b`,</span><br><span class="line">  /// `a == b` implies that `a != b` is `false`.</span><br><span class="line">  ///</span><br><span class="line">  /// - Parameters:</span><br><span class="line">  ///   - lhs: A value to compare.</span><br><span class="line">  ///   - rhs: Another value to compare.</span><br><span class="line">  static func == (lhs: Self, rhs: Self) -&gt; Bool</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@inlinable // FIXME(sil-serialize-all)</span><br><span class="line">public func === (lhs: AnyObject?, rhs: AnyObject?) -&gt; Bool &#123;</span><br><span class="line">  switch (lhs, rhs) &#123;</span><br><span class="line">  case let (l?, r?):</span><br><span class="line">    return ObjectIdentifier(l) == ObjectIdentifier(r)</span><br><span class="line">  case (nil, nil):</span><br><span class="line">    return true</span><br><span class="line">  default:</span><br><span class="line">    return false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从以上可以看出，<code>==</code>只是由实现好的静态函数决定，而<code>===</code>则是可以判断两个对象是否完全相等，这有点像判断两个指针相等一样，同样，我们要注意，如果两个可选对象都是nil，则也是<code>===</code>的；</p>
<ol start="3">
<li>搞清楚两个问题</li>
</ol>
<ul>
<li><p>UTC 与 GMT<br>UTC(Coordinated Universal Time)标准时间参照，协调时间时，世界标准时间;<br>GMT(Greenwich Mean Time)时区，即格林尼治时间，位于本初子午线的标界处时间，世界计算时间和经度的起点，GMT是个时区，等同于世界时，所以GMT = UTC + 0，我们国家所在时间均以北京时间计算，北京位于东八区，所以时区为GMT + 8；</p>
</li>
<li><p>Locale<br>网上找了一圈，最后还是swift源码文档里给出的解释最靠谱：<code>Locale</code>封装了有关语言，文化和技术规范和标准的信息。由语言环境封装的信息示例包括，用于数字中小数点分隔符的符号以及格式化日期的方式。区域设置通常用于根据用户的习俗和偏好提供，格式化和解释信息。它们经常与格式化程序一起使用。虽然可以使用很多语言环境，但通常使用与当前用户关联的语言环境。<br>语言环境跟系统的环境设置有关，会涉及到操作系统语言环境设置，个人理解就是一个国际化的东西。<br>区域设置中的概念 LANGID &amp; LCID：<br><img src="https://upload-images.jianshu.io/upload_images/1429775-04ff650284a51b6c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="LANGID &amp; LCID"></p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2018/05/03/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/03/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-03T15:14:45+08:00">
                2018-05-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2018/04/27/本行三件事：猎龙 训龙 调教龙/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/27/本行三件事：猎龙 训龙 调教龙/" itemprop="url">本行三件事：猎龙 训龙 调教龙</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-27T20:45:00+08:00">
                2018-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="第一件："><a href="#第一件：" class="headerlink" title="第一件："></a>第一件：</h2><p>今天在<strong>Nothing</strong>项目中添加了一个小的功能，就是按压屏幕出现一个有弹出效果的<em>Label</em>，涉及到的点；</p>
<ol>
<li>thereis</li>
</ol>
<ul>
<li>touches<br>我们知道，UIResponder处理函数，根据不同的触摸状态会调用不同的函数，以下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-(void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event;</span><br><span class="line"></span><br><span class="line">-(void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event;</span><br><span class="line"></span><br><span class="line">-(void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event;</span><br><span class="line"></span><br><span class="line">-(void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>注意第四个取消函数，调用时机是触摸被取消，一定要注意是被取消，自己主动点击然后结束这不叫取消，举个例子如在触摸过程中被来电打断，这种情况才算；<br>回调中可以通过<em>UITouch</em>来操作点击次数和手指数，<em>UIEvent</em>可以操作屏幕点信息，这样就把手指与屏幕的交互处理完成。</p>
<ul>
<li>transform<br>这里出现了一个现象，原代码如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//进入时的设置</span><br><span class="line">        //向x y轴方向平移 0 0</span><br><span class="line">        self.transform = CGAffineTransform(translationX: 0, y: 0) //(1)</span><br><span class="line">        self.transform = CGAffineTransform(rotationAngle: 0) // (2)</span><br><span class="line">        </span><br><span class="line">        self.transform = CGAffineTransform(scaleX: 0.1, y: 0.1) //(3)</span><br><span class="line">        //transform scale 改变中间不能添加其他变换</span><br><span class="line">        //动画播放</span><br><span class="line">        UIView.animate(withDuration: 0.5, delay: 0, options: .curveEaseOut, animations: &#123;</span><br><span class="line">            self.transform = CGAffineTransform(scaleX: 1, y: 1)</span><br><span class="line">        &#125;, completion: nil) //(4)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>如上代码<em>(2)</em>如果放在<em>(3)</em>和<em>(4)</em>的中间，则动画会不执行，直接形成动画后的结果，天知道这其中发生了什么，怕是动画函数做了某些优化，如果你知道，还请赐教。</p>
<ul>
<li>Another Problem<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIView.animate(withDuration: 1, delay: 0, </span><br><span class="line">usingSpringWithDamping: 0.5, </span><br><span class="line">initialSpringVelocity: 0.5, options: .curveEaseIn, animations: &#123;</span><br><span class="line">           self.transform = CGAffineTransform(scaleX: 1, y: 1)</span><br><span class="line">&#125;, completion: nil)</span><br><span class="line">// 抗阻尼 以及 弹簧 的问题</span><br><span class="line">// 涉及到了一些物理知识，不细究</span><br><span class="line">// 只是贴出这个api 注意用法</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li>仿射变换</li>
</ol>
<p><a href="http://www.fuzihao.org/blog/2014/10/23/%E4%BB%BF%E5%B0%84%E7%A9%BA%E9%97%B4%E4%B8%8E%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2/" target="_blank" rel="noopener">仿射空间和仿射变换</a><br>关于仿射变换的先看这篇文章了解一下吧，它是计算机图形学中一个很重要的概念，简单的理解就是线性变换加上平移变换，当然看到这里你得先知道什么是线性变换和平移变换，好了，这个概念先不多说了。</p>
<ol start="3">
<li>currying function</li>
</ol>
<p>经过了一系列的实验，最终得出了一个函数链的方案，虽然跟柯里化没有什么关系，代码如下，细细品味一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public func maybe(noDate: NODate, _ some: () -&gt; ()) -&gt; ThereIs &#123;</span><br><span class="line">        switch noDate &#123;</span><br><span class="line">        case let .April(date):</span><br><span class="line">            let myDate = date.toDate()</span><br><span class="line">            let currentDate = Date()</span><br><span class="line">            if let myDate = myDate &#123;</span><br><span class="line">                if myDate.compare(currentDate) == .orderedSame &#123;</span><br><span class="line">                    some()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return self</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>其实也没有多么深奥，只是函数在调用外部传进的闭包后又返回了自身，然而，就是一个这样简单的设计，在调用时你会发现是多么的便利；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_ = thereis?.maybe(noDate: dates[0]) &#123;</span><br><span class="line">                self.noLabel.appear()</span><br><span class="line">            &#125;</span><br><span class="line">            .maybe(noDate: dates[1]) &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<p>上图中的<em>maybe</em>函数可以无限调用，这样根据传进来的参数可以实现一个小功能，如果将本方法的类似方法分散在不同的函数中调用，那么我们可以用传进不同参数来区分调用的时机，这样可以将某一次的逻辑调用统一在一个地方处理，说的有点绕，用一张图来理一下思路：<br><img src="https://upload-images.jianshu.io/upload_images/1429775-e58a9faeb3c885d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="maybe函数思维导图"></p>
<h2 id="第二件"><a href="#第二件" class="headerlink" title="第二件"></a>第二件</h2><p>此时我面前有一个作业，叫做文献综述，今天跟老铁聊天中发现自己在面对困难问题时拖延的问题。朋友说当你有一大堆的事情不知道做哪件时，挑最难的那件事情做。<br>于是把每天最棘手的问题做为首要，比方说难做的作业，比方说写一篇文章。<br><img src="http://upload-images.jianshu.io/upload_images/1429775-1aea7d4c63680f89.jpg" alt="轻课听力"><br>上图是昨晚在轻课群的口语练习，留作复习用。</p>
<h2 id="第三件"><a href="#第三件" class="headerlink" title="第三件"></a>第三件</h2><p>已经很久没有写日志了，这么些年断断续续的，从来没把它当作一个习惯来做。在github上看到一个学习库，有所启发，想来该培养一个习惯来让自己保持一个学习的状态。完成的并不一定要完美，完成就好，记录下心情，记录下问题，记录下昨天那个“愚蠢”的自己。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2018/04/17/朴素贝叶斯使用Python进行文本分类/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/17/朴素贝叶斯使用Python进行文本分类/" itemprop="url">朴素贝叶斯使用Python进行文本分类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-17T23:08:00+08:00">
                2018-04-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>从文本中创建词向量bayes.py</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#!usr/bin/python</span><br><span class="line">#-*-encoding:utf-8-*-</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">该函数返回实验样本，该样本被切分成词条集合；</span><br><span class="line">第二个变量返回类别，该类别由人工标注，用于训练程序以便自动检查侮辱性留言；</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def loadDataSet():</span><br><span class="line">	postingList = [</span><br><span class="line">		[&apos;my&apos;,&apos;dog&apos;,&apos;has&apos;,&apos;flea&apos;,&apos;problems&apos;,&apos;help&apos;,&apos;please&apos;],</span><br><span class="line">		[&apos;maybe&apos;,&apos;not&apos;,&apos;take&apos;,&apos;him&apos;,&apos;to&apos;,&apos;dog&apos;,&apos;park&apos;,&apos;stupid&apos;],</span><br><span class="line">		[&apos;my&apos;,&apos;dalmation&apos;,&apos;is&apos;,&apos;so&apos;,&apos;cute&apos;,&apos;I&apos;,&apos;love&apos;,&apos;him&apos;],</span><br><span class="line">		[&apos;stop&apos;,&apos;posting&apos;,&apos;stupid&apos;,&apos;worthless&apos;,&apos;garbage&apos;],</span><br><span class="line">		[&apos;mr&apos;,&apos;licks&apos;,&apos;ate&apos;,&apos;my&apos;,&apos;steak&apos;,&apos;how&apos;,&apos;to&apos;,&apos;stop&apos;,&apos;him&apos;],</span><br><span class="line">		[&apos;quit&apos;,&apos;buying&apos;,&apos;worthless&apos;,&apos;dog&apos;,&apos;food&apos;,&apos;stupid&apos;]</span><br><span class="line">	]</span><br><span class="line">	classVec = [0, 1, 0, 1, 0, 1] # 1代表侮辱性文字 0代表正常</span><br><span class="line">	return postingList, classVec</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def createVocabList(dataSet):</span><br><span class="line">	vocabSet = set([])	#创建一个空集</span><br><span class="line">	for document in dataSet:</span><br><span class="line">		vocabSet = vocabSet | set(document) #创建两集合并集</span><br><span class="line">	return list(vocabSet)</span><br><span class="line"></span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">该函数输入参数为词汇表及某个文档，输出的是文档向量，向量每一元素为1or0，分别表示词汇表中的单词在输入文档中是否出现</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">def setOfWords2Vec(vocabList, inputSet):</span><br><span class="line">	returnVec = [0] * len(vocabList)</span><br><span class="line">	for word in inputSet:</span><br><span class="line">		if word in vocabList:</span><br><span class="line">			returnVec[vocabList.index(word)] = 1</span><br><span class="line">		else:</span><br><span class="line">			print(&quot;the word: %s is not in my Vocabulary!&quot; % word)</span><br><span class="line">	return returnVec</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/usiege/08jgn0fh17i3tesytmd39qsl/image_1cb7dhd105761rg11lkq1mgjpt19.png" alt="image_1cb7dhd105761rg11lkq1mgjpt19.png-132.9kB"></p>
<ol start="2">
<li>朴素贝叶斯训练函数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#朴素贝叶斯训练函数</span><br><span class="line">def trainNB0(trainMatrix, trainCategory):</span><br><span class="line">	numTrainDocs = len(trainMatrix)</span><br><span class="line">	numWords = len(trainMatrix[0])</span><br><span class="line"></span><br><span class="line">	#</span><br><span class="line">	pAbusive = sum(trainCategory)/float(numTrainDocs) </span><br><span class="line"></span><br><span class="line">	#某词出现次数</span><br><span class="line">	p0Num = zeros(numWords)</span><br><span class="line">	p1Num = zeros(numWords)</span><br><span class="line">	#在所有的文档中，出现某词的文档的总词数</span><br><span class="line">	p0Denom = 0.0</span><br><span class="line">	p1Denom = 0.0</span><br><span class="line"></span><br><span class="line">	for i in range(numTrainDocs):</span><br><span class="line">		if trainCategory[i] == 1:</span><br><span class="line">			p1Num += trainMatrix[i]</span><br><span class="line">			p1Denom += sum(trainMatrix[i])</span><br><span class="line">		else:</span><br><span class="line">			p0Num += trainMatrix[i]</span><br><span class="line">			p0Denom += sum(trainMatrix[i])</span><br><span class="line"></span><br><span class="line">	p1Vect = p1Num/p1Denom</span><br><span class="line">	p0Vect = p0Num/p0Denom</span><br><span class="line"></span><br><span class="line">	return p0Vect, p1Vect, pAbusive</span><br></pre></td></tr></table></figure>
<p><img src="http://static.zybuluo.com/usiege/41wgod8054yss08dj5zcae5d/image_1cb7gr8l6tli1gq8515ev19i013.png" alt="image_1cb7gr8l6tli1gq8515ev19i013.png-368.4kB"></p>
<p><img src="http://static.zybuluo.com/usiege/vw73jzr2d42s7l5us6duu8d8/image_1cb7gs04bmv319kp11841cvq73i1g.png" alt="image_1cb7gs04bmv319kp11841cvq73i1g.png-125.3kB"></p>
<ol start="3">
<li>修改分类器</li>
</ol>
<ul>
<li><p>Problem1:计算多个概率的乘积以获得文档属于某个类别概率，如果其中有一个概率值为0，那最后乘积也为0；为降低这种影响，可以将所有词出现初始化为1，并将分母初始化为2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p0Num = ones(numWords); </span><br><span class="line">p1Num = ones(numWords)</span><br><span class="line">p0Denom = 2.0;	</span><br><span class="line">p1Denom = 2.0</span><br></pre></td></tr></table></figure>
</li>
<li><p>Problem2: 下溢出，太多很小的数相乘会造成下溢出，解决办法是取自然对数，把乘法转换成加法，通过求对数避免下溢出或者浮点数舍入导致错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    p1Vect = log(p1Num/p1Denom)</span><br><span class="line">	p0Vect = log(p0Num/p0Denom)</span><br><span class="line">```   </span><br><span class="line"></span><br><span class="line">4. 分类器编写</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>#构建朴素贝叶斯分类函数<br>def classityNB(vec2Classify, p0Vec, p1Vec, pClass1):<br>    p1 = sum(vec2Classify <em> p1Vec) + log(pClass1)<br>    p0 = sum(vec2Classify </em> p0Vec) + log(1.0 - pClass1)<br>    if p1 &gt; p0:<br>        return 1;<br>    else:<br>        return 0;</p>
<p>def testingNB():<br>    listOPosts, listClasses = loadDataSet()<br>    myVocabList = createVocabList(listOPosts)<br>    trainMat = []<br>    for postinDoc in listOPosts:<br>        trainMat.append(setOfWords2Vec(myVocabList, postinDoc))<br>    p0V, p1V, pAb = trainNB0(array(trainMat), array(listClasses))</p>
<pre><code>testEntry = [&apos;love&apos;, &apos;my&apos;, &apos;dalmation&apos;]
thisDoc = array(setOfWords2Vec(myVocabList, testEntry))
print(testEntry, &apos;classified as:&apos;, classityNB(thisDoc, p0V, p1V, pAb))

testEntry = [&apos;stupid&apos;, &apos;garbage&apos;]
thisDoc = array(setOfWords2Vec(myVocabList, testEntry))
print(testEntry, &apos;classified as:&apos;, classityNB(thisDoc, p0V, p1V, pAb))    
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通过训练器分类得出结果：</span><br><span class="line">![image_1cba21hoeuca2kt17n5bdu3e9p.png-38.4kB][4]</span><br><span class="line"></span><br><span class="line">5. 文档词袋模型</span><br></pre></td></tr></table></figure>
<p>#文档词袋模型<br>def bagofWords2VecMN(vocabList, inputSet):<br>    returnVec = [0] * len(vocabList)<br>    for word in inputSet:<br>        if word in vocabList:<br>            returnVec[vocabList.index(word)] += 1<br>    return returnVec<br><code>`</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2018/01/07/MGJRouter代码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/07/MGJRouter代码分析/" itemprop="url">MGJRouter代码分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-07T17:21:00+08:00">
                2018-01-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天来聊聊组件化，之前一直听说大厂在搞，什么淘宝架构，什么蘑菇街，既然谈到了架构的问题，那必属重中之重。接下来分析一下蘑菇街开源的代码，自己做个总结。</p>
<h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>类书本的文章个人感觉还是写不来的，再搬到自己写的东西这来也不合适，所以直接上一链接，通过链接文章大致可了解下它的前身后世，产生原因，以及整体宏观架构设计，而我接下来要做的是细化，以及转化，便于自己吸收<br>———&gt; <a href="https://www.jianshu.com/p/67a6004f6930" target="_blank" rel="noopener">组件化架构漫谈</a></p>
<ol>
<li>话不多说，先看入口：</li>
</ol>
<p><img src="http://static.zybuluo.com/usiege/f0dci325k3jmmrh2l9uy51s4/image_1c25qj3m5ejq111g1v5lvkgjek9.png" alt="image_1c25qj3m5ejq111g1v5lvkgjek9.png-7.7kB"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@interface MGJRouter ()</span><br><span class="line">/**</span><br><span class="line"> *  保存了所有已注册的 URL</span><br><span class="line"> *  结构类似 @&#123;@&quot;beauty&quot;: @&#123;@&quot;:id&quot;: &#123;@&quot;_&quot;, [block copy]&#125;&#125;&#125;</span><br><span class="line"> */</span><br><span class="line">@property (nonatomic) NSMutableDictionary *routes;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">+ (instancetype)sharedInstance</span><br><span class="line">&#123;</span><br><span class="line">    static MGJRouter *instance = nil;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        instance = [[self alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return instance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>很明显，蘑菇街架构（以下简称MGJ）通过该单例作管理，统一进行调配，而该单例仅有一个变量，就是<strong>routes</strong>，实际上它仅仅是管理了一个字典的结构，具体字典内有哪些内容，我们慢慢看；</p>
<ol start="2">
<li>回调Block的定义</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> *  routerParameters 里内置的几个参数会用到上面定义的 string</span><br><span class="line"> */</span><br><span class="line">typedef void (^MGJRouterHandler)(NSDictionary *routerParameters);</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *  需要返回一个 object，配合 objectForURL: 使用</span><br><span class="line"> */</span><br><span class="line">typedef id (^MGJRouterObjectHandler)(NSDictionary *routerParameters);</span><br></pre></td></tr></table></figure>
<p>上面这两个block定义是MGJ注册URL的回调，一个带返回值，另一个不带，在这里我们说一下<strong>带返回值的block用法</strong>；如下举例 ——&gt;<br><img src="http://static.zybuluo.com/usiege/xn1r7ergmr6xr6msy2p5tyrh/WX20180107-134538@2x.png" alt="WX20180107-134538@2x.png-37.5kB"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">//声明</span><br><span class="line">typedef UIViewController *(^ViewControllerHandler)();</span><br><span class="line"></span><br><span class="line">//作参数</span><br><span class="line">@interface DemoListViewController : UIViewController</span><br><span class="line">+ (void)registerWithTitle:(NSString *)title handler:(ViewControllerHandler)handler;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//定义</span><br><span class="line">@implementation DemoListViewController</span><br><span class="line">+ (void)registerWithTitle:(NSString *)title handler:(ViewControllerHandler)handler</span><br><span class="line">&#123;</span><br><span class="line">    UIViewController* vc = handler()</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">//在别处调用</span><br><span class="line">@implementation DemoDetailViewController</span><br><span class="line">[DemoListViewController registerWithTitle:@&quot;基本使用&quot; handler:^UIViewController *&#123;</span><br><span class="line">        return DemoDetailViewController();</span><br><span class="line">&#125;];</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></p>
<p>如上，我们把<code>ViewControllerHandler</code>的运行延迟到了实际调用的时刻，并且我们可以在这个handler的实现中带入很多信息；</p>
<ol start="3">
<li>MGJ数据结构管理</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">extern NSString *const MGJRouterParameterURL;</span><br><span class="line">extern NSString *const MGJRouterParameterCompletion;</span><br><span class="line">extern NSString *const MGJRouterParameterUserInfo;</span><br><span class="line">//*************************************************</span><br><span class="line">static NSString * const MGJ_ROUTER_WILDCARD_CHARACTER = @&quot;~&quot;;  //这是一个占位符</span><br><span class="line">static NSString *specialCharacters = @&quot;/?&amp;.&quot;;</span><br><span class="line"></span><br><span class="line">NSString *const MGJRouterParameterURL = @&quot;MGJRouterParameterURL&quot;;</span><br><span class="line">NSString *const MGJRouterParameterCompletion = @&quot;MGJRouterParameterCompletion&quot;;</span><br><span class="line">NSString *const MGJRouterParameterUserInfo = @&quot;MGJRouterParameterUserInfo&quot;;</span><br></pre></td></tr></table></figure>
<p>从这里我们可以看出，MGJ的路由管理，实际上是一个解析url以及对应的管理，我们举几个URL来看一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@&quot;mgj://&quot;</span><br><span class="line">@&quot;mgj://foo/bar/none/exists&quot;</span><br><span class="line">@&quot;mgj://foo/bar&quot; </span><br><span class="line">@&quot;mgj://category/家居&quot;</span><br><span class="line">@&quot;mgj://category/travel&quot;</span><br><span class="line">@&quot;mgj://search/:query&quot;</span><br><span class="line">@&quot;mgj://detail&quot;</span><br><span class="line">@&quot;mgj://search/:keyword&quot;</span><br><span class="line">@&quot;mgj://search_top_bar&quot;</span><br></pre></td></tr></table></figure></p>
<p>通过上面的URL我们可以看出，路由的管理实际上就是url的解析过程，下面我们来具体看一下解析过程；</p>
<ol start="4">
<li>URL解析</li>
</ol>
<ul>
<li>route url</li>
</ul>
<p><img src="http://static.zybuluo.com/usiege/wr5j4jwfcaov7yfmx3u82nyk/WX20180107-150437@2x.png" alt="WX20180107-150437@2x.png-59.1kB"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray*)pathComponentsFromURL:(NSString*)URL</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableArray *pathComponents = [NSMutableArray array];</span><br><span class="line">    if ([URL rangeOfString:@&quot;://&quot;].location != NSNotFound) &#123;</span><br><span class="line">        NSArray *pathSegments = [URL componentsSeparatedByString:@&quot;://&quot;];</span><br><span class="line">        // 如果 URL 包含协议，那么把协议作为第一个元素放进去</span><br><span class="line">        [pathComponents addObject:pathSegments[0]];</span><br><span class="line">        </span><br><span class="line">        // 如果只有协议，那么放一个占位符</span><br><span class="line">        URL = pathSegments.lastObject;</span><br><span class="line">        if (!URL.length) &#123;</span><br><span class="line">            [pathComponents addObject:MGJ_ROUTER_WILDCARD_CHARACTER];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    for (NSString *pathComponent in [[NSURL URLWithString:URL] pathComponents]) &#123;</span><br><span class="line">        if ([pathComponent isEqualToString:@&quot;/&quot;]) continue;</span><br><span class="line">        if ([[pathComponent substringToIndex:1] isEqualToString:@&quot;?&quot;]) break;</span><br><span class="line">        [pathComponents addObject:pathComponent];</span><br><span class="line">    &#125;</span><br><span class="line">    return [pathComponents copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>key-value<br><img src="http://static.zybuluo.com/usiege/j23e7t541u0wcoohza0ktqmb/WX20180107-151956@2x.png" alt="WX20180107-151956@2x.png-111.8kB"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableDictionary *)addURLPattern:(NSString *)URLPattern</span><br><span class="line">&#123;</span><br><span class="line">    NSArray *pathComponents = [self pathComponentsFromURL:URLPattern];</span><br><span class="line"></span><br><span class="line">    NSMutableDictionary* subRoutes = self.routes;</span><br><span class="line">    </span><br><span class="line">    for (NSString* pathComponent in pathComponents) &#123;</span><br><span class="line">        if (![subRoutes objectForKey:pathComponent]) &#123;</span><br><span class="line">            subRoutes[pathComponent] = [[NSMutableDictionary alloc] init];</span><br><span class="line">        &#125;</span><br><span class="line">        subRoutes = subRoutes[pathComponent];</span><br><span class="line">    &#125;</span><br><span class="line">    return subRoutes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>核心url解析</p>
</li>
</ul>
<p><img src="http://static.zybuluo.com/usiege/cbn7v2xkwlfy3c19m322o7mg/WX20180107-160319@2x.png" alt="WX20180107-160319@2x.png-147.8kB"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableDictionary *)extractParametersFromURL:(NSString *)url</span><br><span class="line">&#123;</span><br><span class="line">    NSMutableDictionary* parameters = [NSMutableDictionary dictionary];</span><br><span class="line">    </span><br><span class="line">    parameters[MGJRouterParameterURL] = url;</span><br><span class="line">    </span><br><span class="line">    NSMutableDictionary* subRoutes = self.routes;</span><br><span class="line">    NSArray* pathComponents = [self pathComponentsFromURL:url];</span><br><span class="line">    </span><br><span class="line">    BOOL found = NO;</span><br><span class="line">    // borrowed from HHRouter(https://github.com/Huohua/HHRouter)</span><br><span class="line">    for (NSString* pathComponent in pathComponents) &#123;</span><br><span class="line">        </span><br><span class="line">        // 对 key 进行排序，这样可以把 ~ 放到最后</span><br><span class="line">        NSArray *subRoutesKeys =[subRoutes.allKeys sortedArrayUsingComparator:^NSComparisonResult(NSString *obj1, NSString *obj2) &#123;</span><br><span class="line">            return [obj1 compare:obj2];</span><br><span class="line">        &#125;];</span><br><span class="line">        </span><br><span class="line">        for (NSString* key in subRoutesKeys) &#123;</span><br><span class="line">            if ([key isEqualToString:pathComponent] || [key isEqualToString:MGJ_ROUTER_WILDCARD_CHARACTER]) &#123;</span><br><span class="line">                found = YES;</span><br><span class="line">                subRoutes = subRoutes[key];</span><br><span class="line">                break;</span><br><span class="line">            &#125; else if ([key hasPrefix:@&quot;:&quot;]) &#123;</span><br><span class="line">                found = YES;</span><br><span class="line">                subRoutes = subRoutes[key];</span><br><span class="line">                NSString *newKey = [key substringFromIndex:1];</span><br><span class="line">                NSString *newPathComponent = pathComponent;</span><br><span class="line">                // 再做一下特殊处理，比如 :id.html -&gt; :id</span><br><span class="line">                if ([self.class checkIfContainsSpecialCharacter:key]) &#123;</span><br><span class="line">                    NSCharacterSet *specialCharacterSet = [NSCharacterSet characterSetWithCharactersInString:specialCharacters];</span><br><span class="line">                    NSRange range = [key rangeOfCharacterFromSet:specialCharacterSet];</span><br><span class="line">                    if (range.location != NSNotFound) &#123;</span><br><span class="line">                        // 把 pathComponent 后面的部分也去掉</span><br><span class="line">                        newKey = [newKey substringToIndex:range.location - 1];</span><br><span class="line">                        NSString *suffixToStrip = [key substringFromIndex:range.location];</span><br><span class="line">                        newPathComponent = [newPathComponent stringByReplacingOccurrencesOfString:suffixToStrip withString:@&quot;&quot;];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                parameters[newKey] = newPathComponent;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        // 如果没有找到该 pathComponent 对应的 handler，则以上一层的 handler 作为 fallback</span><br><span class="line">        if (!found &amp;&amp; !subRoutes[@&quot;_&quot;]) &#123;</span><br><span class="line">            return nil;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // Extract Params From Query.</span><br><span class="line">    NSArray&lt;NSURLQueryItem *&gt; *queryItems = [[NSURLComponents alloc] initWithURL:[[NSURL alloc] initWithString:url] resolvingAgainstBaseURL:false].queryItems;</span><br><span class="line">    </span><br><span class="line">    for (NSURLQueryItem *item in queryItems) &#123;</span><br><span class="line">        parameters[item.name] = item.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (subRoutes[@&quot;_&quot;]) &#123;</span><br><span class="line">        parameters[@&quot;block&quot;] = [subRoutes[@&quot;_&quot;] copy];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return parameters;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">+ (void)openURL:(NSString *)URL withUserInfo:(NSDictionary *)userInfo completion:(void (^)(id result))completion</span><br><span class="line">&#123;</span><br><span class="line">    URL = [URL stringByAddingPercentEscapesUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">    NSMutableDictionary *parameters = [[self sharedInstance] extractParametersFromURL:URL];</span><br><span class="line">    </span><br><span class="line">    [parameters enumerateKeysAndObjectsUsingBlock:^(id key, NSString *obj, BOOL *stop) &#123;</span><br><span class="line">        if ([obj isKindOfClass:[NSString class]]) &#123;</span><br><span class="line">            parameters[key] = [obj stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    if (parameters) &#123;</span><br><span class="line">        MGJRouterHandler handler = parameters[@&quot;block&quot;];</span><br><span class="line">        if (completion) &#123;</span><br><span class="line">            parameters[MGJRouterParameterCompletion] = completion;</span><br><span class="line">        &#125;</span><br><span class="line">        if (userInfo) &#123;</span><br><span class="line">            parameters[MGJRouterParameterUserInfo] = userInfo;</span><br><span class="line">        &#125;</span><br><span class="line">        //所以注册路由时的回调是在这里才调用到的</span><br><span class="line">        //也就是openURL响应了register的回调</span><br><span class="line">        if (handler) &#123;</span><br><span class="line">            [parameters removeObjectForKey:@&quot;block&quot;];</span><br><span class="line">            handler(parameters);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>后续？</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2018/01/06/Swift Currying（柯里化）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/06/Swift Currying（柯里化）/" itemprop="url">Swift Currying(柯里化)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-01-06T16:34:00+08:00">
                2018-01-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>函数式编程思想</li>
</ol>
<p>先举一个小例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">func addOne(count: Int) -&gt; Int &#123;</span><br><span class="line">    return count + 1</span><br><span class="line">&#125;</span><br><span class="line">//上面这个代码我们是返回一个加和，和是使参数增加1；</span><br><span class="line">//一个更加灵活的方法，我们可以取消上面的硬编码1；</span><br><span class="line"></span><br><span class="line">func add(count: Int, addition: Int) -&gt; Int &#123;</span><br><span class="line">    return count + addition</span><br><span class="line">&#125;</span><br><span class="line">//然而这个函数还并不是那么友好，我们用另外一种方法实现看一下：</span><br><span class="line">func add(_ addition: Int) -&gt; (Int) -&gt; Int &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        count in </span><br><span class="line">        return count + addition</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//调用一下以上方法，看看有什么区别：</span><br><span class="line">let number = add(count: 10, addition: 2)    //函数2</span><br><span class="line"></span><br><span class="line">let add2 = add(2)           //函数3</span><br><span class="line">let number = add2(10)</span><br><span class="line"></span><br><span class="line">let number = add(2)(10)     //函数3调用连起来是</span><br><span class="line">//是不是觉得这种调用方式很熟悉，有点类似于</span><br><span class="line">//classname.property.subproperty，点语法链</span><br></pre></td></tr></table></figure></p>
<p>显然这种编程方式更加灵活，所展现的内容更加直观，可以减少函数写N多的参数；当然函数式编程有的可不只是这些，更多内容不在本篇所讨论之内；</p>
<p>基于上例我们来写一个方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">func greaterThan(_ comparer: Int) -&gt; (Int) -&gt; Bool &#123;</span><br><span class="line">    return &#123; $0 &gt; comparer &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">let compareResult = greaterThan(10)(11)</span><br></pre></td></tr></table></figure></p>
<p>很明显下面这个式子的调用直观的表达了参数10和参数11的大小；</p>
<ol start="2">
<li>target-action例子</li>
</ol>
<p>我们来看国外网上的一个例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">protocol TargetAction &#123;</span><br><span class="line">    func performAction()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct TargetActionWrapper&lt;T: AnyObject&gt;: TargetAction &#123;</span><br><span class="line">    weak var target: T?</span><br><span class="line">    let action: (T) -&gt; () -&gt; (Void)</span><br><span class="line">    </span><br><span class="line">    func performAction() -&gt; (Void) &#123;</span><br><span class="line">        if let t = target &#123;</span><br><span class="line">            action(t)()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//</span><br><span class="line">enum ControlEvent &#123;</span><br><span class="line">    case TouchUpInside</span><br><span class="line">    case ValueChanged</span><br><span class="line">    // ...</span><br><span class="line">&#125;              </span><br><span class="line"></span><br><span class="line">class Control &#123;</span><br><span class="line"></span><br><span class="line">    var actions = [ControlEvent: TargetAction]()</span><br><span class="line">    </span><br><span class="line">    convenience init&lt;T: AnyObject&gt;(_ target: T, action: @escaping (T) -&gt; () -&gt; (Void), controlEvent: ControlEvent) &#123;</span><br><span class="line">        actions[controlEvent] = TargetActionWrapper(</span><br><span class="line">            target: target, action: action)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func setTarget&lt;T: AnyObject&gt;(target: T, action: @escaping (T) -&gt; () -&gt; (Void), controlEvent: ControlEvent) &#123;</span><br><span class="line">            </span><br><span class="line">            actions[controlEvent] = TargetActionWrapper(target: target, action: action)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func removeTargetForControlEvent(controlEvent: ControlEvent) &#123;</span><br><span class="line">        actions[controlEvent] = nil</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func performActionForControlEvent(controlEvent: ControlEvent) &#123;</span><br><span class="line">        actions[controlEvent]?.performAction()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//我们来使用一下我们的模板</span><br><span class="line"></span><br><span class="line">func viewDidLoad() &#123;</span><br><span class="line">    Control().setTarget(self, action: ViewController.tapAction, controlEvent: .touchUpInside)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func tapAction() &#123;</span><br><span class="line">    print(&quot;单击了&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//如果我们不是用实例方法调用而是自定义构造函数的话</span><br><span class="line">//我们能看到更好的表现方式</span><br><span class="line"></span><br><span class="line">func viewDidLoad() &#123;</span><br><span class="line">    Control.init(self, action: ViewController.tapAction controlEvent: .touchUpInside)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//当然这个便利构造函数的例子用在这里并不是很合逻辑，但是我们只是想展现一下柯里化的内容</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2017/12/12/Jenkins 构建之脚本篇/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/12/Jenkins 构建之脚本篇/" itemprop="url">Jenkins 构建之脚本篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-12T20:53:00+08:00">
                2017-12-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前一直纠结Xcode 9之后用Jenkins导出.ipa文件失败，后经朋友指点终于成功，在此结出终级解决之法；</p>
<p>大致思路是这样的：Jenkins在网页中的配置大多会在之后进行整理，最终在终端生成shell脚本，然后每完成一项就会在构建结果中显示成功，如有一步错，则整个构建过程将会失败，所以这就解释了之前构建一直卡在了Achiver成功之后。</p>
<p>基于上面的思路，则弃用之前的Jenkins配置，取消Jenkins项目中构建过程，Xcode配置全部清空，使用脚本配置，以下我会具体贴出，并适当讲解：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash -l</span><br><span class="line">export LANG=en_US.UTF-8</span><br><span class="line">export LANGUAGE=en_US.UTF-8</span><br><span class="line">export LC_ALL=en_US.UTF-8</span><br><span class="line"></span><br><span class="line">#以下PROJECT_NAME为项目工程名称</span><br><span class="line">pod install --verbose --no-repo-update</span><br><span class="line">open PROJECT_NAME.xcworkspace</span><br><span class="line"></span><br><span class="line">#以下USER_NAME为用户名</span><br><span class="line">project_path=&quot;/Users/USER_NAME/.jenkins/workspace/PROJECT_NAME&quot;</span><br><span class="line"></span><br><span class="line">#指定项目地址</span><br><span class="line">workspace_path=&quot;$project_path/PROJECT_NAME.xcworkspace&quot;</span><br><span class="line"></span><br><span class="line">#取当前时间字符串添加到文件夹结尾</span><br><span class="line">now=$(date +&quot;%Y_%m_%d_%H_%M_%S&quot;)</span><br><span class="line"></span><br><span class="line">#指定项目的scheme名称</span><br><span class="line">scheme=&quot;PROJECT_NAME&quot;</span><br><span class="line">#指定要打包的配置名</span><br><span class="line">configuration=&quot;Release&quot;</span><br><span class="line">#指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development, 和developer-id，即xcodebuild的method参数</span><br><span class="line">export_method=&apos;enterprise&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#指定输出路径</span><br><span class="line">output_path=&quot;$project_path/build/PROJECT_NAME&#123;now&#125;&quot;</span><br><span class="line">#指定输出归档文件地址</span><br><span class="line">archive_path=&quot;$output_path/PROJECT_NAME.xcarchive&quot;</span><br><span class="line">#指定输出ipa名称</span><br><span class="line">ipa_name=&quot;PROJECT_NAME&#123;now&#125;.ipa&quot;</span><br><span class="line"></span><br><span class="line">#指定输出ipa地址</span><br><span class="line">ipa_path=&quot;$output_path/$&#123;ipa_name&#125;&quot;</span><br><span class="line">#指定打包配置</span><br><span class="line">export_plist_path=&quot;$project_path/ExportOptions.plist&quot;</span><br><span class="line">#获取执行命令时的commit message</span><br><span class="line">#commit_msg=&quot;$(cat $project_path/build_log.txt)&quot;</span><br><span class="line"></span><br><span class="line">#输出设定的变量值</span><br><span class="line">echo &quot;===workspace path: $&#123;workspace_path&#125;===&quot;</span><br><span class="line">echo &quot;===archive path: $&#123;archive_path&#125;===&quot;</span><br><span class="line">echo &quot;===ipa path: $&#123;ipa_path&#125;===&quot;</span><br><span class="line">echo &quot;===export method: $&#123;export_method&#125;===&quot;</span><br><span class="line">#echo &quot;===commit msg: $&#123;commit_msg&#125;===&quot;</span><br><span class="line"></span><br><span class="line">#先清空前一次build</span><br><span class="line">xcodebuild clean -workspace $&#123;workspace_path&#125; -scheme $&#123;scheme&#125; -configuration $&#123;configuration&#125;</span><br><span class="line"></span><br><span class="line">#归档</span><br><span class="line">xcodebuild archive -workspace $&#123;workspace_path&#125; -scheme $&#123;scheme&#125; -archivePath $&#123;archive_path&#125;</span><br><span class="line"></span><br><span class="line">#导出</span><br><span class="line">xcodebuild -exportArchive -archivePath $&#123;archive_path&#125; -exportPath $&#123;output_path&#125; -exportOptionsPlist $&#123;export_plist_path&#125;</span><br></pre></td></tr></table></figure>
<p>依此上秘法，会获得Xcode 9下构建成功之案例，.ipa文件也会导出，至于之后上传到平台上，请到各平台下自行找文档整理，不做赘述。</p>
<p>今天新年，祝大家新年快乐，2018，代码不出bug，新技术很快上手，妹子泡到手软，工资涨的飞快，人生乐的飞起！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2017/12/10/Jenkins 100次构建失败踩坑全录（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/10/Jenkins 100次构建失败踩坑全录（二）/" itemprop="url">Jenkins 100次构建失败踩坑全录（二）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-10T20:53:00+08:00">
                2017-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>接上篇，继续踩坑，下面到构建触发器环节：</p>
<ul>
<li><p>构建触发器<br><img src="http://static.zybuluo.com/usiege/it14w81rja3zme63xykjxy5o/image_1c0qnmug31v0hvkf1pp1kqf1bir9.png" alt="image_1c0qnmug31v0hvkf1pp1kqf1bir9.png-91.5kB"><br>能用到的发图所示，说明在下方，自行研究，需要注意的一点是图中的*号之间是有空格的；</p>
</li>
<li><p>构建环境<br>这里又有一个超时，与上面的无关，这个是构建过程中的，根据需要添加，下面那个选项是时间戳；<br><img src="http://static.zybuluo.com/usiege/pjeg3kt1s3cb0rxb2l1dfsfr/image_1c0qooi0dkg7ls9abefu71n77p.png" alt="image_1c0qooi0dkg7ls9abefu71n77p.png-38.6kB"></p>
</li>
</ul>
<p>接下来是Keychains和Mobile PP，必填项；<br><img src="http://static.zybuluo.com/usiege/cjtc66sg8991c5ulj3uib8dq/image_1c0qosdhm132q23k103kckp1dok16.png" alt="image_1c0qosdhm132q23k103kckp1dok16.png-8kB"></p>
<p>逐个击破：<br>Keychains部分<br><img src="http://static.zybuluo.com/usiege/li5lfp7spsd6c3bw435besbb/image_1c0qovfpn1n431vc7n8qonb8o51j.png" alt="image_1c0qovfpn1n431vc7n8qonb8o51j.png-83.2kB"><br>这个部分也是选择题，因为之前你已经上传了，但是这里会出现无法选择的bug，点保存刷新下页面就可以选了，Variables部分填如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;KEYCHAIN_PATH&#125; $&#123;KEYCHAIN_PASSWORD&#125; $&#123;CODE_SIGNING_IDENTITY&#125;</span><br></pre></td></tr></table></figure></p>
<p>Mobile Provisioning Profiles部分<br><img src="http://static.zybuluo.com/usiege/1s0il4bxtsop1ame15pbq0ul/image_1c0qprhce18lu1vjb1pd1aakjv20.png" alt="image_1c0qprhce18lu1vjb1pd1aakjv20.png-47.6kB"><br>这个部分同上，请选择你确定的PP文件，一定要对应好：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;PROVISIONING_PROFILE&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>构建</li>
</ul>
<p>整个配置过程最重要的部分，大多数问题都出在这里，我这里目前到了Archive阶段，也就是说归档成功，然后归档结果可以用xcode进行ipa打包，具体打包还要设置一个shell脚本，网上好多，有的可以用有的不可以，所以打算研究下这个脚本，自己写一个再上传，之后会在博客中跟进，现在先继续把已完成的部分写下来；</p>
<p>首先是先要加一个结束后的脚本，这个脚本不做打包操作，只是设置一下环境，以及配置一下有pod依赖的情况，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash -l</span><br><span class="line">export LANG=en_US.UTF-8</span><br><span class="line">export LANGUAGE=en_US.UTF-8</span><br><span class="line">export LC_ALL=en_US.UTF-8</span><br><span class="line"></span><br><span class="line">pod install --verbose --no-repo-update</span><br><span class="line">open LeWaiJiao.xcworkspace</span><br></pre></td></tr></table></figure></p>
<p><img src="http://static.zybuluo.com/usiege/rxby0iwous3ppc63wyn1c83y/image_1c0qqc2ubcfq5tvuui19m3oi89.png" alt="image_1c0qqc2ubcfq5tvuui19m3oi89.png-47.4kB"></p>
<p>下面的那个<strong>Pack application,build and sign</strong> .ipa项就是打ipa的功能，暂时没有搞通，后续会补上来，先跳过；</p>
<p><img src="http://static.zybuluo.com/usiege/eceobb4arpah1xacmv2lmxrr/image_1c0qqnucp1np81vaj3rs1l7p1otdm.png" alt="image_1c0qqnucp1np81vaj3rs1l7p1otdm.png-97.4kB"></p>
<p><strong>Code signing &amp; OS X keychain options</strong></p>
<p>下面的bundleID是你要进行打包的bundleID，info.plist是workspace下的路径，注意一下下面的Development Team ID这个ID是你的钥匙串上的证书名称，后面括号里的那一串字符，由字母和数字组成的，需要你自己做对应，下面的照着抄就行了，password填你电脑用户的密码，不要填错了；</p>
<p><img src="http://static.zybuluo.com/usiege/xhxhseh11fwg4wnbt8gpj95y/image_1c0qr7dli1unv1s7s1vu2ugm1fuh13.png" alt="image_1c0qr7dli1unv1s7s1vu2ugm1fuh13.png-102.7kB"></p>
<h1 id="贴几个Error："><a href="#贴几个Error：" class="headerlink" title="贴几个Error："></a>贴几个Error：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Code Signing Error: Code signing is required for product type &apos;Application&apos; in SDK &apos;iOS 11.1&apos;</span><br></pre></td></tr></table></figure>
<p>需要你在xcode中设置，然后上传到你们的Git服务器再构建：<br><img src="http://static.zybuluo.com/usiege/r85b8hxub85tfinbuzue1svp/image_1c0qs83ul1baipc04otg331geb1g.png" alt="image_1c0qs83ul1baipc04otg331geb1g.png-35.4kB"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">No global development team or local team ID was configured.</span><br></pre></td></tr></table></figure>
<p>就是之前说的<strong>Development Team ID</strong>部分，填了就解决了；<br><a href="http://www.jianshu.com/p/8b2fc2da0466" target="_blank" rel="noopener">http://www.jianshu.com/p/8b2fc2da0466</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcodebuild: error: The flag -scheme is required when specifying -archivePath but not -exportArchive.</span><br></pre></td></tr></table></figure>
<p>这个问题也是个大坑，找了好久，也是搜狗找到的：<br><a href="http://www.jianshu.com/p/8967e4e27e9b" target="_blank" rel="noopener">http://www.jianshu.com/p/8967e4e27e9b</a><br><a href="https://www.tuicool.com/articles/zQ73Q3Q" target="_blank" rel="noopener">https://www.tuicool.com/articles/zQ73Q3Q</a><br><a href="https://github.com/jenkinsci/clang-scanbuild-plugin/commit/b970f5280a9c1929e9cd9d3b4d2b76a7d6cbc0dc" target="_blank" rel="noopener">https://github.com/jenkinsci/clang-scanbuild-plugin/commit/b970f5280a9c1929e9cd9d3b4d2b76a7d6cbc0dc</a></p>
<p>解决方法最直接的就是指定scheme和xcode workspace file，分别填你xcode工程中的scheme和pod生成的xcworkspace的名字；<br><img src="http://static.zybuluo.com/usiege/tlotqzvjbjlqk2ms1u43w2yd/image_1c0r0aqt33tdthopme188a2kk1t.png" alt="image_1c0r0aqt33tdthopme188a2kk1t.png-87.3kB"></p>
<p>有些同学不知道scheme在什么地方，如下图所示：<br><img src="http://static.zybuluo.com/usiege/1y4937ijhbvifle7jfgjg3ac/image_1c0r0eai5f09qj47rs134c1upu2a.png" alt="image_1c0r0eai5f09qj47rs134c1upu2a.png-145.6kB"></p>
<p>如上，能保证构建可以成功在Archive过程完成，如遇其他问题，欢迎评论区讨论；<br>之后会再继续完成打包ipa以及上传平台，同时之前提过的SSH部分会持续跟近，因为SSH与本文所讨论的内容并不十分吻合，所以这里不作讨论。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2017/12/09/Jenkins 100次构建失败踩坑全录（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/09/Jenkins 100次构建失败踩坑全录（一）/" itemprop="url">Jenkins 100次构建失败踩坑全录（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-09T20:53:00+08:00">
                2017-12-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文将以问题与解决方案的方式对Jenkins构建过程中的问题进行收录，后期会在评论中持续收集，如果有相同情况，请自行对照解决；</p>
<p>本文参考：<br>手把手教你利用Jenkins持续集成iOS项目<br><a href="http://www.jianshu.com/p/41ecb06ae95f" target="_blank" rel="noopener">http://www.jianshu.com/p/41ecb06ae95f</a><br>关于iOS-Jenkins进行持续集成项目部署<br><a href="http://www.jianshu.com/p/54c7daae6c94" target="_blank" rel="noopener">http://www.jianshu.com/p/54c7daae6c94</a><br>iOS持续集成：Jenkins篇<br><a href="http://www.jianshu.com/p/faf879b3d182" target="_blank" rel="noopener">http://www.jianshu.com/p/faf879b3d182</a></p>
<h2 id="关卡1-："><a href="#关卡1-：" class="headerlink" title="关卡1 ："></a>关卡1 ：</h2><p>安装Jenkins：首先你的电脑得有一个Java环境，接下来安装Jenkins。你可以直接去<a href="https://jenkins.io" target="_blank" rel="noopener">Jenkins入口</a>网站，查看安装方式；<br>当然你也可以使用以下方法：</p>
<ul>
<li><p>安装homebrew</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装jenkins</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install jenkins</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>安装成功后需要开启jenkins服务；</p>
<h2 id="关卡2-："><a href="#关卡2-：" class="headerlink" title="关卡2 ："></a>关卡2 ：</h2><p>开启Jenkins服务：确认jenkins已安装，在终端进入到jenkins安装目录下，会有一个叫做jenkins.war的文件，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar jenkins.war</span><br></pre></td></tr></table></figure></p>
<p>或者在终端输入：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jenkins</span><br></pre></td></tr></table></figure></p>
<p>当出现：<br><img src="http://static.zybuluo.com/usiege/uowhxmph61xngu3l2t4hxamh/image_1c0ptnl2j13mh1mn2hmk18qf7usp.png" alt="image_1c0ptnl2j13mh1mn2hmk18qf7usp.png-188.1kB"></p>
<p>服务已经就位，可以开始进行配置了；</p>
<p>这里还有两个命令用于jenkins开启和停用（Mac上）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo launchctl load /Library/LaunchDaemons/org.jenkins-ci.plist</span><br><span class="line">$ sudo launchctl unload /Library/LaunchDaemons/org.jenkins-ci.plist</span><br></pre></td></tr></table></figure></p>
<p>如果是linux上也可以这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl status jenkins.service</span><br><span class="line">$ sudo systemctl start jenkins.service</span><br></pre></td></tr></table></figure></p>
<p>不过实际操作过程中，可能会出现停用失败的情况，我的做法是直接打开活动监视器，在里面搜java服务，强制关闭掉；这里需要注意，如果服务没有停止再进行jenkins开启是不成功的，提示会告诉你已经在用：</p>
<p><img src="http://static.zybuluo.com/usiege/s46xl40yzd7t5gijpwdippc9/image_1c0pu09in491qq31bqs25f1hbg26.png" alt="image_1c0pu09in491qq31bqs25f1hbg26.png-222.9kB"></p>
<p>如果你想查看是否jenkins在运行，使用命令查看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ps aux | grep jenkins</span><br></pre></td></tr></table></figure></p>
<h2 id="关卡3-："><a href="#关卡3-：" class="headerlink" title="关卡3 ："></a>关卡3 ：</h2><p>安装并开启完成就可以在浏览器里输入<a href="localhost:8080" target="_blank" rel="noopener">localhost:8080</a>进行页面化配置了；<br>安装完成之后，Safari可能会自动打开，如果没有自动打开，打开浏览器，输入<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a><br><img src="http://static.zybuluo.com/usiege/fn2f1wx006r3chny2t5u9atc/image_1c0pvjgjqfbg3i01c371uhc1ves2j.png" alt="image_1c0pvjgjqfbg3i01c371uhc1ves2j.png-27.6kB"></p>
<p>这个时候可能会报一个错误。如果出现了这面的问题。出现这个问题的原因就是Java环境有问题，重启Java环境即可。</p>
<p>这个时候如果你重启电脑会发现Jenkins给你新增了一个用户，名字就叫Jenkins，不过这个时候你不知道密码。你可能会去试密码，肯定是是不对的，因为初始密码很复杂。这个时候正确做法是打开<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> 会出现下图的重设初始密码的界面。</p>
<p><img src="http://static.zybuluo.com/usiege/sfnjgdq201o27xta3ttqllkr/image_1c0pvl71n5dulcc413164i1hcp30.png" alt="image_1c0pvl71n5dulcc413164i1hcp30.png-30.4kB"></p>
<p>按照提示，找到/Users/Shared/Jenkins/Home/ 这个目录下，这个目录虽然是共享目录，但是有权限的，非Jenkins用户/secrets/目录是没有读写权限的。</p>
<p><img src="http://static.zybuluo.com/usiege/ltc8z86hbmzy78857uo767zr/image_1c0pvm8al1tce1iled5voi216ac3d.png" alt="image_1c0pvm8al1tce1iled5voi216ac3d.png-200.2kB"></p>
<p>打开initialAdminPassword文件，复制出密码，就可以填到网页上去重置密码了。如下图</p>
<p><img src="http://static.zybuluo.com/usiege/ub5cnhcl82hyed8j8aqghlna/image_1c0pvp2p01fon1h2mmvjs6s1fuj3q.png" alt="image_1c0pvp2p01fon1h2mmvjs6s1fuj3q.png-99.6kB"></p>
<p>一路安装过来，输入用户名，密码，邮件这些，就算安装完成了。</p>
<p>还是继续登录localhost:8080</p>
<p>然而这一关还没有结束：<br>写blog的时候我把自己设置的帐号注销了，然而当时设置的密码却忘记了，怎么都想不起来，怎么办呢？<br>首先我想能不能用之前给的Jenkins帐户呢，经试错，未果；<br>接下来上百度查了几种方法，有的方法很复杂，不打算用，我们只用最简单粗暴的；只要之前的帐号信息没有丢失，又可以进入系统就OK了，于是：</p>
<p><img src="http://static.zybuluo.com/usiege/ihh8n31m9fb1r9gomahd7l6d/image_1c0q0bnonde9a9omqa1092a1747.png" alt="image_1c0q0bnonde9a9omqa1092a1747.png-85.9kB"></p>
<p>注意实际操作过程中发现不是<code>/User/Shared/Jenkins/Home</code>下的config.xml，也不是<code>/User/Shared/Jenkins/Home/users</code>下的config.xml，而是<strong>你自己用户目录</strong><code>~/.jenkins/</code>下的config.xml，具体原因可能是jenkins运行的工作空间是当前用户目录下的<code>.jenkins</code>，然后就是这样：</p>
<p><img src="http://static.zybuluo.com/usiege/rmn1oao4inl6rvryb8ne596c/image_1c0q277tu152r9mg1dhg1edq8jp5q.png" alt="image_1c0q277tu152r9mg1dhg1edq8jp5q.png-55.9kB"></p>
<p>经检验，无误，可进入，但是好像遗留了一个问题，就是这样进入的话就找不到管理用户的选项了；解决问题，勾选图中黄色圈，返回系统管理，出现管理用户（还是个隐藏道具）；<br><img src="http://static.zybuluo.com/usiege/v5zxzwu4pex59s78odynkkd6/image_1c0q3ukis1vlhib71uij1729ohs67.png" alt="image_1c0q3ukis1vlhib71uij1729ohs67.png-33.1kB"></p>
<p><img src="http://static.zybuluo.com/usiege/bxyfaeid922e3lf7dvuz9mh8/image_1c0q419b0164pqfe25d9br1fpt74.png" alt="image_1c0q419b0164pqfe25d9br1fpt74.png-39.8kB"></p>
<p><img src="http://static.zybuluo.com/usiege/burf10v126vjx00u2ym0h2bn/image_1c0q42m3mvf41d8fjs21ptb1ae77h.png" alt="image_1c0q42m3mvf41d8fjs21ptb1ae77h.png-11.4kB"></p>
<p>搞的像是特工登录非授权帐户一样，不管怎么说，总算是攻破了，进入下一关；</p>
<h2 id="关卡-4："><a href="#关卡-4：" class="headerlink" title="关卡 4："></a>关卡 4：</h2><p>先不管工程构建里那一堆设置，我们先来搞一下证书Cer，钥匙Keychain，配置文件Provisioning Profiles的一些问题：<br>首先去系统管理 -&gt; 管理插件 -&gt; 可选插件，搜索并安装Keychains and Provisioning Profiles Management插件；<br>进入插件：<br><img src="http://static.zybuluo.com/usiege/kgy8eq7ug16g0o1o4eotp3bw/image_1c0qeblep1tcj4m319ap1bek783ah.png" alt="image_1c0qeblep1tcj4m319ap1bek783ah.png-31.1kB"></p>
<p>不要关键去填下面的空，我会告诉你这是一道有选项的题目；进入文件目录，<code>Command + shift + G</code>，写下这样的路径<code>~/资源库/Keychains</code>，</p>
<p><img src="http://static.zybuluo.com/usiege/ebpz8l8bnnvlrr6oi3a0423h/image_1c0qekdqp9v712rd1gefjdr1fdcbe.png" alt="image_1c0qekdqp9v712rd1gefjdr1fdcbe.png-62.2kB"></p>
<p>这里我们把login.keychain-db上传到Jenkins里，但是Upload并不能上传这样后缀的文件，所以需要你手动把login.keychain-db修改成login.keychain（复制后再修改，以防止其他地方会引用到带-db）；上传完成后就会在下面出现你一些信息；然后打开你的钥匙串，这个知道在什么地方吧；</p>
<p><img src="http://static.zybuluo.com/usiege/w9l7f921rn6he0vx1vcqmu6a/image_1c0qet898q8m118mk2s6kj1cq5eb.png" alt="image_1c0qet898q8m118mk2s6kj1cq5eb.png-131kB"></p>
<p>点击打包所用到的证书，将红色框中的名称复制出来，添加到identities中；</p>
<p><img src="http://static.zybuluo.com/usiege/zc1wu103t1woz01fp07s80b7/image_1c0qf02rofnpc3r121c1nlb1mqteo.png" alt="image_1c0qf02rofnpc3r121c1nlb1mqteo.png-42.7kB"></p>
<p>如果有多个，则点击Add Code Signing Identity添加；</p>
<p>然后是PP文件，这些文件需要我们从系统PP文件夹下复制到Jenkins资源文件夹下，如下图两个路径：<br>这个是系统PP文件目录<br><img src="http://static.zybuluo.com/usiege/peonwampxc6wa9h3i2yuhfm5/image_1c0qkdte41j1rgq81k8v1bi19f4f5.png" alt="image_1c0qkdte41j1rgq81k8v1bi19f4f5.png-144.2kB"><br>这个是Jenkins PP文件目录<br><img src="http://static.zybuluo.com/usiege/v0firte6p13gwec9a133ixi1/image_1c0qkkk833p0nt18andthn9qfi.png" alt="image_1c0qkkk833p0nt18andthn9qfi.png-79.2kB"></p>
<p>Provisioning Profiles Directory Path 填写成，注意替换为自己的username：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/User/&#123;USERNAME&#125;/Library/MobileDevice/Provisioning Profiles</span><br></pre></td></tr></table></figure>
<p>接着去你苹果帐号里去找你对应打包所需要的PP文件，然后点upload上传到Jenkins环境里；<br>以上，证书部分解决；</p>
<h2 id="关卡-5"><a href="#关卡-5" class="headerlink" title="关卡 5"></a>关卡 5</h2><p>创建项目过程我们会对各个需要的项进行逐个描述：<br>点新建项目，输入项目名称，选择 构建一个自由风格的软件项目，然后确定，进入配置页面。<br><img src="http://static.zybuluo.com/usiege/1ytel52lwidafke7uv5rmgb0/image_1c0ql3ppk1bht1b5ms4hcui1jpjfv.png" alt="image_1c0ql3ppk1bht1b5ms4hcui1jpjfv.png-8.2kB"></p>
<ul>
<li>General<br>这个部分的内容都很浅显，没有什么可以说的，根据需要自行填充；这里说一下GitLab connection选项，因为我自己的工程是用gitlab管理的代码，所以需要在Jenkins里下一个Gitlab的插件，然后在里面进行帐号配置，可以采用帐号密码以及SSH的方式，具体这个部分会有一个SSH的坑，先不作分析，后面会讲到，我这里先用帐号密码的方式进行构建，经检验发现SSH方式非必要；</li>
</ul>
<p><strong>Credentials</strong>在这里配置：<br><img src="http://static.zybuluo.com/usiege/f6pv0rsip2oirn32m01agp1l/image_1c0qljaq610ljc02k6g1r821fs5gc.png" alt="image_1c0qljaq610ljc02k6g1r821fs5gc.png-78.2kB"></p>
<ul>
<li>源码管理<br>这里我选的Git，<strong>Repository URL</strong>填你工程的git地址，选用帐号密码的形式应该是以http或https开头的，<strong>Credentials</strong>填你在上一步中新建好的，<br><img src="http://static.zybuluo.com/usiege/bzufeuzktht55r97i2bsem18/image_1c0qlt20313duogl2g51hp11nqsgp.png" alt="image_1c0qlt20313duogl2g51hp11nqsgp.png-73kB"><br><strong>Branch Specifier (blank for ‘any’)</strong>    填你要进行构建的分支，我这里是<code>*/release</code>；</li>
</ul>
<p>这里我们PS一个隐藏BOSS：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">returned status code 143 jenkins</span><br><span class="line">ERROR: Error fetching remote repo ‘origin’</span><br></pre></td></tr></table></figure></p>
<p>这个报错是工程配置结束后进行构建后提示的，我当时搞这个发现远程代码明明是已经拉取到本地的，只是在拉取过程中会发生中断，本人在进行了将近50次试错后发现这个拉取到本地的代码率是变化的，先前以为是SSH帐号的问题，于是转头花了一天的时间搞了下SSH，后来SSH搞通后发现该问题仍然存在，后来终于在经历百度，谷歌，搜狗也用上的（不得不说有时候百度搜不出来的搜狗能搜到），发现了几篇有用的，后来解决，也算是不负辛苦，后面有踩坑的伙伴多注意，前车之鉴后事之师；</p>
<p><a href="http://blog.sina.com.cn/s/blog_72ef7bea0102vo9w.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_72ef7bea0102vo9w.html</a><br><a href="https://issues.jenkins-ci.org/browse/JENKINS-20445" target="_blank" rel="noopener">https://issues.jenkins-ci.org/browse/JENKINS-20445</a><br><a href="https://stackoverflow.com/questions/35069079/jenkins-git-plugin-timeout-when-try-to-pull-repositoty-using-ssh" target="_blank" rel="noopener">https://stackoverflow.com/questions/35069079/jenkins-git-plugin-timeout-when-try-to-pull-repositoty-using-ssh</a></p>
<p>解决方案就在于这个<strong>Timeout</strong>，相信你看了这个单词就知道是怎么回事了：<br><img src="http://static.zybuluo.com/usiege/firl86lawiru1uvz1jhelb28/image_1c0qmnlafh2p1j571b4ettv1ncah6.png" alt="image_1c0qmnlafh2p1j571b4ettv1ncah6.png-74.3kB"></p>
<p>另顺便粘一个code 128的链接，是个与该问题相关的问题，因为这些问题关键字有的重复，所以搜出来的文章有时会误导，所以请仔细辨别：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">returned status code 128 jenkins</span><br><span class="line">ERROR: Error cloning remote repo &apos;origin&apos;</span><br><span class="line">stderr: Permission denied (publickey).</span><br></pre></td></tr></table></figure></p>
<p><a href="http://wantcoding.com/?p=293" target="_blank" rel="noopener">http://wantcoding.com/?p=293</a><br><a href="http://www.cnblogs.com/EasonJim/p/6266892.html" target="_blank" rel="noopener">这个链接是附送的，进去多看看你会有惊喜，还有QQ群哦</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://uwuneng.com/2017/12/07/记一次iOS上线提审/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Charles">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NOTHING">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/07/记一次iOS上线提审/" itemprop="url">记一次iOS上线提审</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-12-07T17:50:00+08:00">
                2017-12-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/coder/" itemprop="url" rel="index">
                    <span itemprop="name">coder</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>公司最近的一次App提交过程中遇到的一些问题，现贴在这里，有检索到本篇的朋友们可借鉴。</p>
<p>首先是上传到iTunes Connect构建版本，点击以下蓝色按钮，之后会有苹果为你的代码进行检查：</p>
<p><img src="http://static.zybuluo.com/usiege/n72bt0t4wwh45zw5c0kjcv01/image_1bu7k3nt22m3cmearq636qua9.png" alt="image_1bu7k3nt22m3cmearq636qua9.png-14.8kB"></p>
<p>本人在ios11上做了提交，发现问题进行分类：</p>
<ol>
<li>第一个是第三方库存在x86_64,i386的链接库，有以下问题：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">ERROR ITMS-90087: &quot;Unsupported Architectures. The executable for LeWaiJiao.app/Frameworks/GCDWebServers.framework contains unsupported architectures &apos;[x86_64, i386]&apos;.&quot;</span><br></pre></td></tr></table></figure>
<p>PS:以下所有翻译来源于欧路词典，粘贴过来的，仅供参考；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">ERROR ITMS-90209: &quot;Invalid Segment Alignment. The app binary at &apos;LeWaiJiao.app/Frameworks/GCDWebServers.framework/GCDWebServers&apos; does not have proper segment alignment. Try rebuilding the app with the latest Xcode version.&quot;</span><br><span class="line">无效段对齐。应用程序二进制的“lewaijiao。应用程序/框架/ gcdwebservers。框架/ gcdwebservers”没有正确对齐。尝试用新的Xcode版本重建应用程序。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">ERROR ITMS-90125: &quot;The binary is invalid. The encryption info in the LC_ENCRYPTION_INFO load command is either missing or invalid, or the binary is already encrypted. This binary does not seem to have been built with Apple&apos;s linker.&quot;</span><br><span class="line">“二进制无效。在lc_encryption_info负荷指令加密信息丢失或无效，或是已经加密的二进制。这个二进制文件似乎没有用苹果的链接器构建。”</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">WARNING ITMS-90080: &quot;The executable &apos;Payload/LeWaiJiao.app/Frameworks/GCDWebServers.framework&apos; is not a Position Independent Executable. Please ensure that your build settings are configured to create PIE executables. For more information refer to Technical Q&amp;A QA1788 - Building a Position Independent Executable in the iOS Developer Library.&quot;</span><br><span class="line">“可执行的有效载荷/ lewaijiao。应用程序/框架/ gcdwebservers。框架”不是一个独立的可执行文件的位置。请确保您的构建设置配置为创建饼可执行文件。更多信息请参阅技术问答qa1788在iOS开发者库位置独立的可执行的建筑。”</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR ITMS-90362: &quot;Invalid Info.plist value. The value for the key &apos;MinimumOSVersion&apos; in bundle ***.app/Frameworks/SDK.framework is invalid. The minimum value is 8.0&quot;</span><br></pre></td></tr></table></figure>
<p>后面这个<strong>90362</strong>貌似是连带问题，定位的时候发现与最小版本无关，所以一同被解决了；</p>
<p>解决方法呢是在该工程里添加脚本处理这些被添加进来的第三方库，如下：<br><img src="http://static.zybuluo.com/usiege/mqh6ttzi6hsixpddv5nmcu03/image_1bu7kmq06140t1nmhkf11sfq1civm.png" alt="image_1bu7kmq06140t1nmhkf11sfq1civm.png-235.5kB"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">APP_PATH=&quot;$&#123;TARGET_BUILD_DIR&#125;/$&#123;WRAPPER_NAME&#125;&quot;</span><br><span class="line"></span><br><span class="line"># This script loops through the frameworks embedded in the application and</span><br><span class="line"># removes unused architectures.</span><br><span class="line">find &quot;$APP_PATH&quot; -name &apos;*.framework&apos; -type d | while read -r FRAMEWORK</span><br><span class="line">do</span><br><span class="line">FRAMEWORK_EXECUTABLE_NAME=$(defaults read &quot;$FRAMEWORK/Info.plist&quot; CFBundleExecutable)</span><br><span class="line">FRAMEWORK_EXECUTABLE_PATH=&quot;$FRAMEWORK/$FRAMEWORK_EXECUTABLE_NAME&quot;</span><br><span class="line">echo &quot;Executable is $FRAMEWORK_EXECUTABLE_PATH&quot;</span><br><span class="line"></span><br><span class="line">EXTRACTED_ARCHS=()</span><br><span class="line"></span><br><span class="line">for ARCH in $ARCHS</span><br><span class="line">do</span><br><span class="line">echo &quot;Extracting $ARCH from $FRAMEWORK_EXECUTABLE_NAME&quot;</span><br><span class="line">lipo -extract &quot;$ARCH&quot; &quot;$FRAMEWORK_EXECUTABLE_PATH&quot; -o &quot;$FRAMEWORK_EXECUTABLE_PATH-$ARCH&quot;</span><br><span class="line">EXTRACTED_ARCHS+=(&quot;$FRAMEWORK_EXECUTABLE_PATH-$ARCH&quot;)</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;Merging extracted architectures: $&#123;ARCHS&#125;&quot;</span><br><span class="line">lipo -o &quot;$FRAMEWORK_EXECUTABLE_PATH-merged&quot; -create &quot;$&#123;EXTRACTED_ARCHS[@]&#125;&quot;</span><br><span class="line">rm &quot;$&#123;EXTRACTED_ARCHS[@]&#125;&quot;</span><br><span class="line"></span><br><span class="line">echo &quot;Replacing original executable with thinned version&quot;</span><br><span class="line">rm &quot;$FRAMEWORK_EXECUTABLE_PATH&quot;</span><br><span class="line">mv &quot;$FRAMEWORK_EXECUTABLE_PATH-merged&quot; &quot;$FRAMEWORK_EXECUTABLE_PATH&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure></p>
<p>以上代码来源于Google，解决方法经确认iOS11 + Xcode9.0有效；</p>
<ol start="2">
<li>项目有icon不合规定的错误<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">iTunes Store Operation Failed</span><br><span class="line">ERROR ITMS-90717: &quot;Invalid App Store Icon. The App Store Icon in the asset catalog in &apos;LeWaiJiao.app&apos; can&apos;t be transparent nor contain an alpha channel.&quot;</span><br><span class="line">无效应用程序商店图标。在资产目录中的lewaijiao App Store图标，应用程序不能透明也包含alpha通道。”</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>该错误原因是上传的icon不符合苹果规定，公司项目存在的问题是1.使用了圆角；2.有透明alpha通道；<br>解决方法自然容易了，找设计重新做，自己解决的话第二个可以DIY，如下：</p>
<p><img src="http://static.zybuluo.com/usiege/xtde6py269a5m4iusbumms4p/image_1bu7l6vhrvhm51b13pjvrlc0p13.png" alt="image_1bu7l6vhrvhm51b13pjvrlc0p13.png-100.4kB"></p>
<p>用系统预览打开icon图片，点掉Alpha的勾，再保存就可以了；<br><img src="http://static.zybuluo.com/usiege/yql5tndy4d612fhqfsi9n4l2/image_1bu7l8bt61p6v1mp11csi15ri1dmg1g.png" alt="image_1bu7l8bt61p6v1mp11csi15ri1dmg1g.png-128.6kB"></p>
<ol start="3">
<li>提交上传结束后又出现了一个问题</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">App Installation failed, No code signature found.</span><br></pre></td></tr></table></figure>
<p>真机无法运行了！这个问题纯属偶然，所以继续解决；打开终端，输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 777 /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk</span><br></pre></td></tr></table></figure>
<p>修改文件权限，然后修改字段属性，打开：</p>
<p><strong>/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS.sdk/SDKSettings.plist</strong></p>
<p>，修改 <strong>CODE_SIGNING_REQUIRED</strong> 字段为 <strong>YES</strong> ，保存；</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Charles</p>
              <p class="site-description motion-element" itemprop="description">Nothing is true,every is permitted.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/usiege" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.jianshu.com/u/8a7d7e6876ab" target="_blank" title="Jianshu">
                      
                        <i class="fa fa-fw fa-globe"></i>Jianshu</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/jianin45" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-globe"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/jianin45" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-globe"></i>Weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://blog.sina.com.cn/tjfcg45" target="_blank" title="Blog">
                      
                        <i class="fa fa-fw fa-globe"></i>Blog</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Charles</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
